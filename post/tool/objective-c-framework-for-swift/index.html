<!DOCTYPE html>















<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  
  <title>Move Objective-C frameworks for Swift - Aha Edmond</title>

  
  
  <meta name="description" content="å¼•è¨€ Swift ä½œä¸º Objective-C çš„æ›¿ä»£è€…ï¼Œè‹¹æœæ¯å¹´éƒ½ä¸ºå…¶æŠ•å…¥äº†å¤§é‡çš„èµ„æºã€‚éšç€ Swift ABI ç¨³å®šï¼Œå›½å†…å¤§å‚ä¹Ÿå¼€å§‹æŠ•å…¥äººåŠ›æ¨å¹¿ Swiftã€‚è¯šå¦‚è‹¹æœæ‰€è¨€ï¼Œä»–ä»¬åº”è¯¥æ˜¯æ‹¥æœ‰ Objective-C framework æ•°" />
  <meta name="author" content="åœŸåœŸEdmondæœ¨" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://looseyi.github.io/app.min.css" />

  

  
  <link rel="preload" as="image" href="https://looseyi.github.io/theme.png" />

  
  <link rel="preload" as="image" href="https://looseyi.github.io/twitter.svg" />
  
  <link rel="preload" as="image" href="https://looseyi.github.io/github.svg" />
  

  
  <link rel="icon" href="https://looseyi.github.io/favicon.ico" />
  <link rel="apple-touch-icon" href="https://looseyi.github.io/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.82.1" />

  
  
  <link
    rel="alternate"
    type="application/rss&#43;xml"
    href="https://looseyi.github.io/post/tool/objective-c-framework-for-swift/index.xml"
    title="Aha Edmond"
  />
  

  
  
  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-62789092-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
  
  <meta property="og:title" content="Move Objective-C frameworks for Swift" />
<meta property="og:description" content="å¼•è¨€ Swift ä½œä¸º Objective-C çš„æ›¿ä»£è€…ï¼Œè‹¹æœæ¯å¹´éƒ½ä¸ºå…¶æŠ•å…¥äº†å¤§é‡çš„èµ„æºã€‚éšç€ Swift ABI ç¨³å®šï¼Œå›½å†…å¤§å‚ä¹Ÿå¼€å§‹æŠ•å…¥äººåŠ›æ¨å¹¿ Swiftã€‚è¯šå¦‚è‹¹æœæ‰€è¨€ï¼Œä»–ä»¬åº”è¯¥æ˜¯æ‹¥æœ‰ Objective-C framework æ•°" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://looseyi.github.io/post/tool/objective-c-framework-for-swift/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-13T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-11-13T00:00:00&#43;00:00" />


  
  <meta itemprop="name" content="Move Objective-C frameworks for Swift">
<meta itemprop="description" content="å¼•è¨€ Swift ä½œä¸º Objective-C çš„æ›¿ä»£è€…ï¼Œè‹¹æœæ¯å¹´éƒ½ä¸ºå…¶æŠ•å…¥äº†å¤§é‡çš„èµ„æºã€‚éšç€ Swift ABI ç¨³å®šï¼Œå›½å†…å¤§å‚ä¹Ÿå¼€å§‹æŠ•å…¥äººåŠ›æ¨å¹¿ Swiftã€‚è¯šå¦‚è‹¹æœæ‰€è¨€ï¼Œä»–ä»¬åº”è¯¥æ˜¯æ‹¥æœ‰ Objective-C framework æ•°"><meta itemprop="datePublished" content="2021-11-13T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2021-11-13T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="3229">
<meta itemprop="keywords" content="iOS&#39;,Swift,Framework," />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Move Objective-C frameworks for Swift"/>
<meta name="twitter:description" content="å¼•è¨€ Swift ä½œä¸º Objective-C çš„æ›¿ä»£è€…ï¼Œè‹¹æœæ¯å¹´éƒ½ä¸ºå…¶æŠ•å…¥äº†å¤§é‡çš„èµ„æºã€‚éšç€ Swift ABI ç¨³å®šï¼Œå›½å†…å¤§å‚ä¹Ÿå¼€å§‹æŠ•å…¥äººåŠ›æ¨å¹¿ Swiftã€‚è¯šå¦‚è‹¹æœæ‰€è¨€ï¼Œä»–ä»¬åº”è¯¥æ˜¯æ‹¥æœ‰ Objective-C framework æ•°"/>

  
  
</head>


  <body class="not-ready" data-menu="true">
    <header class="header">
  
  <p class="logo">
    <a class="site-name" href="https://looseyi.github.io/">Aha Edmond</a><a class="btn-dark"></a>
  </p>
  

  <script>
    let bodyClx = document.body.classList;
    let btnDark = document.querySelector('.btn-dark');
    let sysDark = window.matchMedia('(prefers-color-scheme: dark)');
    let darkVal = localStorage.getItem('dark');

    let setDark = (isDark) => {
      bodyClx[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark ? 'yes' : 'no');
    };

    setDark(darkVal ? darkVal === 'yes' : sysDark.matches);
    requestAnimationFrame(() => bodyClx.remove('not-ready'));

    btnDark.addEventListener('click', () => setDark(!bodyClx.contains('dark')));
    sysDark.addEventListener('change', (event) => setDark(event.matches));
  </script>

  
  
  <nav class="menu">
    
    <a class="" href="/">Home</a>
    
  </nav>
  

  
  <nav class="social">
    
    <a
      class="twitter"
      style="--url: url(./twitter.svg)"
      href="https://twitter.com/looseyi"
      target="_blank"
    ></a>
    
    <a
      class="github"
      style="--url: url(./github.svg)"
      href="https://github.com/looseyi"
      target="_blank"
    ></a>
    
  </nav>
  
</header>


    <main class="main">
			

<article class="post-single">
  <header class="post-title">
    <p>
      <time>2021-11-13</time>
      
      <span>åœŸåœŸEdmondæœ¨</span>
      
    </p>
    <h1>Move Objective-C frameworks for Swift</h1>
  </header>
  <section class="post-content"><h1 id="å¼•è¨€">å¼•è¨€</h1>
<p>Swift ä½œä¸º Objective-C çš„æ›¿ä»£è€…ï¼Œè‹¹æœæ¯å¹´éƒ½ä¸ºå…¶æŠ•å…¥äº†å¤§é‡çš„èµ„æºã€‚éšç€ Swift ABI ç¨³å®šï¼Œå›½å†…å¤§å‚ä¹Ÿå¼€å§‹æŠ•å…¥äººåŠ›æ¨å¹¿ Swiftã€‚è¯šå¦‚è‹¹æœæ‰€è¨€ï¼Œä»–ä»¬åº”è¯¥æ˜¯æ‹¥æœ‰ Objective-C framework æ•°é‡æœ€å¤šçš„å…¬å¸äº†ï¼Œä»–ä»¬ä¸€ç›´åœ¨æŒç»­æ›´æ–°å…¶ Objective-C framework çš„ interface ä½¿å…¶å¯¹ Swfit å‹å¥½ï¼Œæ›´æœ‰ç”šè€…æ˜¯ç›´æ¥é‡å†™ã€‚åŒæ—¶ä¹Ÿæä¾›äº†å¾ˆå¤šçº¯ Swift çš„åŸç”Ÿæ¡†æ¶ï¼Œå¦‚ Combineã€CoreMLã€SPMã€RealityKit ç­‰ã€‚</p>
<p>è€Œä»Šå¤©æˆ‘ä»¬è¦è®¨è®ºçš„æ˜¯ï¼Œè¦å¦‚ä½•æ”¹é€  Objective-C frameork ä½¿å…¶æ›´å‹å¥½çš„æ”¯æŒ Swift APIã€‚</p>
<blockquote>
<p>æœ¬æ–‡ä¸»è¦ç¿»è¯‘è‡ª SDWebImage 6.0 ææ¡ˆï¼š<a href="https://github.com/SDWebImage/SDWebImage/issues/2980">Rewriten Swift API with the overlay framework instead of Objective-C exported one</a>ï¼Œæ„Ÿè°¢ä½œè€… <a href="https://github.com/dreampiggy">@Dreampiggy</a>ã€‚</p>
</blockquote>
<h1 id="èƒŒæ™¯">èƒŒæ™¯</h1>
<p>å¯¹æ™®é€š iOS å¼€å‘è€…è€Œè¨€ï¼Œè®©ç°æœ‰çš„ Objective-C æ¡†æ¶æ›´å¥½çš„æ”¯æŒ Swift ä¹Ÿæ˜¯æˆ‘ä»¬æ— æ³•ç»•å¼€çš„é—®é¢˜ä¹‹ä¸€ã€‚å°½ç®¡ Swift ç¼–è¯‘å™¨åœ¨è½¬æ¢ Objective-C æ¥å£æ—¶åšäº†å¾ˆå¤šä¸é”™çš„ä¼˜åŒ–å·¥ä½œï¼Œä½†ä»æ—§æ— æ³•æ»¡è¶³æ‰€æœ‰å¼€å‘è€…çš„éœ€æ±‚ã€‚</p>
<blockquote>
<p>Tips: WWDC20 æœ‰ä¸“é—¨ <a href="https://developer.apple.com/videos/play/wwdc2020/10680/">Session-10680</a> æ¥è®¨è®º Refine Objective-C frameworks for Swiftï¼Œä¹Ÿæ¨èçœ‹<a href="https://www.sketchk.xyz/2020/07/02/WWDC20-10680-Refine-Objective-C-frameworks-for-Swift/">sketchk.xyz æ–‡ç« </a>ã€‚</p>
</blockquote>
<p>ä»¥ SDWebImage 5.0 çš„ Objective-C ä»£ç ä¸ºä¾‹ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objective-c" data-lang="objective-c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>[imageView sd_setImageWithURL:url placeholderImage:<span style="color:#b58900">nil</span> options:<span style="color:#2aa198">0</span> context:@{SDWebImageContextQueryCacheType: @(SDImageCacheTypeMemory)} progress:<span style="color:#b58900">nil</span> completion:<span style="color:#719e07">^</span>(UIImage <span style="color:#719e07">*</span>image, NSError <span style="color:#719e07">*</span>error, SDImageCacheType cacheType, NSURL <span style="color:#719e07">*</span>url) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>  <span style="color:#586e75">// do something with result
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span style="color:#586e75"></span>    <span style="color:#719e07">if</span> (error) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>        NSLog(<span style="color:#2aa198">@&#34;%@&#34;</span>, error);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span>    } <span style="color:#719e07">else</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span>       <span style="color:#586e75">// do with image
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span><span style="color:#586e75"></span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8</span>}];
</code></pre></div><p>å¯¹äºè¿™æ ·çš„ APIï¼Œclang ç¼–è¯‘å™¨å¯ä»¥å°†å…¶è½¬æ¢æˆå¦‚ä¸‹çš„ Swift å½¢å¼çš„ä»£ç ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>imageView.sd_setImage(with: url, placeholderImage:<span style="color:#cb4b16">nil</span> options:[] context:[.queryCacheType : SDImageCacheType.memory.rawValue] progress:<span style="color:#cb4b16">nil</span>) { image, error, cacheType, url <span style="color:#719e07">in</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>  <span style="color:#586e75">// do something with result</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>  <span style="color:#719e07">if</span> <span style="color:#268bd2">let</span> <span style="color:#268bd2">error</span> = error {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>      <span style="color:#268bd2">print</span>(error)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span>  } <span style="color:#719e07">else</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span>      <span style="color:#268bd2">let</span> <span style="color:#268bd2">image</span> = image!
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8</span>}
</code></pre></div><p>ç›¸æ¯”äºçº¯ Swift APIï¼Œå®ƒè¿˜æ˜¯å°‘äº†ä¸€äº› Swifty çš„å‘³é“ã€‚ä¸€ä¸ªç®€æ´ä¼˜é›… Swift API è®¾è®¡åº”è¯¥èƒ½å¤Ÿå……åˆ†çš„åˆ©ç”¨å…¶è¯­æ³•ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li><a href="https://docs.swift.org/swift-book/LanguageGuide/Functions.html">Default Parameters</a></li>
<li><a href="https://docs.swift.org/swift-book/LanguageGuide/Enumerations.html">Enum with Associated Values</a></li>
<li><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0235-add-result.md">Result Type</a></li>
</ul>
<p>å®ƒçœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>imageView.sd.setImage(with: url, options: [.queryCacheType(.memory)] { result
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>    <span style="color:#719e07">switch</span> result {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>    <span style="color:#719e07">case</span> .success(<span style="color:#268bd2">let</span> <span style="color:#268bd2">value</span>):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>        <span style="color:#268bd2">let</span> <span style="color:#268bd2">image</span> = value.image
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span>        <span style="color:#268bd2">let</span> <span style="color:#268bd2">data</span> = value.data
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span>    <span style="color:#719e07">case</span> .failure(<span style="color:#268bd2">let</span> <span style="color:#268bd2">error</span>):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span>        <span style="color:#268bd2">print</span>(error)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">9</span>}
</code></pre></div><p>æ³¨æ„ï¼š<code>options</code> å‚æ•°åœ¨è¿™é‡Œæ˜¯ä»¥å…³è”ç±»å‹æšä¸¾æ¥å£°æ˜ï¼Œå®ƒå°† <code>SDWebImageOptions</code> å’Œ <code>SDWebImageContext</code> ç»“åˆåˆ°ä¸€èµ·ã€‚è€Œåœ¨ Objective-C ä¸­æˆ‘ä»¬å°±æ— æ³•åšåˆ°è¿™æ ·çš„æ•ˆæœã€‚ä½ çŸ¥é“çš„ Objective-C æ˜¯ C è¯­è¨€çš„è¶…é›†ï¼Œè€Œ<strong>åœ¨ C è¯­è¨€ä¸­ Int ç±»å‹çš„æšä¸¾æ˜¯æ— æ³•ç»‘å®šå¯¹è±¡çš„</strong>ã€‚</p>
<h1 id="å¯é€‰æ–¹æ¡ˆ">å¯é€‰æ–¹æ¡ˆ</h1>
<p>æƒ³è¦ä¸ºç°æœ‰çš„ Objective-C framework æä¾›ä¼˜é›…çš„ Swift APIï¼Œæˆ‘ä»¬æœ‰å“ªäº›è·¯å¾„å‘¢ ï¼Ÿ</p>
<h2 id="0x01-åˆ©ç”¨-ns_swift_name-ä¿®æ”¹-objective-c-çš„-public-interface">0x01 åˆ©ç”¨ <code>NS_SWIFT_NAME</code> ä¿®æ”¹ Objective-C çš„ Public Interface</h2>
<p><code>NS_SWIFT_NAME</code> èƒ½å¤Ÿè§£å†³é‡å‘½åçš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°† <code>SDImageCache</code> é‡å‘½åä¸º <code>SDWebImage.ImageCache</code> ä»¥æ­¤æ¥å»é™¤å…¶å‰ç¼€ <strong>SD</strong>:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objective-c" data-lang="objective-c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>NS_SWIFT_NAME(SDWebImage.ImageCache)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span style="color:#719e07">@interface</span> <span style="color:#268bd2">SDImageCache</span> : <span style="color:#268bd2">NSObject</span>
</code></pre></div><p>ç„¶è€Œï¼Œé‡å‘½åçš„æ–¹å¼æ— æ³•è§£å†³éœ€è¦å°† <code>SDWebImageOptions</code> å’Œ <code>SDWebImageContext</code> ç»“åˆä¸º Swift æä¾›çš„æšä¸¾ç»“æ„ï¼Œå¦‚ <code>SDWebImage.ImageOptions</code>ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span style="color:#268bd2">enum</span> <span style="color:#268bd2">ImageOptions</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>	<span style="color:#719e07">case</span> queryCacheType(SDImageCacheType)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>	<span style="color:#719e07">case</span> priority(SDImageQueryPriority)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>	...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span>}
</code></pre></div><h2 id="0x02-overlay-framework--é‡å†™æ—§-swift-api">0x02 Overlay Framework &amp; é‡å†™æ—§ Swift API</h2>
<p>é€šè¿‡åˆ›å»ºçš„ overlay framework æ¥æä¾› Swfit å‹å¥½çš„ APIã€‚Swift ç¤¾åŒºæœ‰è¯´æ˜ Apple æ˜¯å¦‚ä½•å®ç° <a href="https://forums.swift.org/t/how-apple-sdk-overlays-work/11317">ä¼ é€é—¨</a>ã€‚</p>
<p>å¯¹äºç¨³å®šçš„å•†ä¸šåŒ–äº§å“è€Œè¨€ï¼Œå¦‚æœæ¨å€’é‡æ¥ç›´æ¥ç”¨ Swift æ¥æ–°å†™å†…éƒ¨ç»„ä»¶ï¼Œå…¶å¼€å‘æˆæœ¬å’Œæ½œåœ¨çš„é£é™©éƒ½æ˜¯éœ€è¦åˆç†è¯„ä¼°çš„ã€‚å› æ­¤ï¼Œèƒ½å¤Ÿæä¾› Swift å‹å¥½çš„ API å±‚ä¹Ÿä¸å¤±ä¸ºä¸€ä¸ªåˆç†æ–¹æ¡ˆã€‚</p>
<p>æˆ‘ä»¬ä»¥ SDWebImage ä¸ºä¾‹ã€‚</p>
<p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåç§°ä¸º <code>SwiftWebImage</code> (åå­—å¾…å®š) çš„ frameworkï¼Œå†…éƒ¨åŒ…å«äº†ä¸€ä¸ªåä¸º <code>SDWebImage.swift</code> çš„æ–‡ä»¶ä¸”å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>@_exported <span style="color:#268bd2">import</span> <span style="color:#268bd2">SDWebImage</span>
</code></pre></div><p>åˆ©ç”¨ <a href="https://forums.swift.org/t/exported-and-fixing-import-visibility/9415">@_exported</a> å…³é”®å­—æ¥æ‰©å±• import æ¡†æ¶çš„å¯è§æ€§ï¼Œè¿™æ ·å°±ä¸éœ€è¦åœ¨æ¯ä¸ªä½¿ç”¨ SD çš„åœ°æ–¹è¿›è¡Œ importã€‚</p>
<p>æ¥ç€å°†åŸæœ‰ Objective-C çš„å…¬å…± API æ ‡è®°ä¸º @unavailableï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>@available(<span style="color:#719e07">*</span>, unavailable, renamed: <span style="color:#2aa198">&#34;SwiftWebImage.ImageOptions&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span style="color:#268bd2">public</span> <span style="color:#268bd2">struct</span> <span style="color:#268bd2">SDWebImageOptions</span> {}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>@available(<span style="color:#719e07">*</span>, unavailable, renamed: <span style="color:#2aa198">&#34;SwiftWebImage.ImageOptions&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span style="color:#268bd2">public</span> <span style="color:#268bd2">struct</span> <span style="color:#268bd2">SDWebImageContext</span> {}
</code></pre></div><p>æœ€ç»ˆï¼Œé‡å†™çš„ Swift API å°†é€šè¿‡è°ƒç”¨åŸæœ‰ SDWebImage çš„ API æ¥å®Œæˆé€»è¾‘ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#586e75">/// Wrapper for SDWebImage compatible types. </span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span style="color:#268bd2">public</span> <span style="color:#268bd2">struct</span> <span style="color:#268bd2">SDWebImageWrapper</span>&lt;Base&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">let</span> <span style="color:#268bd2">base</span>: Base
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">init</span>(<span style="color:#cb4b16">_</span> base: Base) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>        <span style="color:#cb4b16">self</span>.base = base
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span><span style="color:#268bd2">extension</span> <span style="color:#268bd2">SDWebImageCompatible</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>    <span style="color:#586e75">/// Gets a namespace holder for SDWebImage compatible types.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">var</span> <span style="color:#268bd2">sd</span>: SDWebImageWrapper&lt;<span style="color:#cb4b16">Self</span>&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>        <span style="color:#268bd2">get</span> { <span style="color:#719e07">return</span> SDWebImageWrapper(<span style="color:#cb4b16">self</span>) }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>        <span style="color:#268bd2">set</span> { }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span><span style="color:#268bd2">extension</span> <span style="color:#268bd2">UIImageView</span> : SDWebImageCompatible {}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span><span style="color:#268bd2">public</span> <span style="color:#268bd2">protocol</span> <span style="color:#268bd2">ImageResource</span> {}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span><span style="color:#268bd2">extension</span> <span style="color:#268bd2">URL</span> : ImageResource {}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span><span style="color:#268bd2">extension</span> <span style="color:#268bd2">SDWebImageWrapper</span> <span style="color:#719e07">where</span> Base: UIImageView {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span>    @discardableResult
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">func</span> <span style="color:#268bd2">setImage</span>(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span>        with resource: ImageResource?,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span>        placeholder: UIImage? = <span style="color:#cb4b16">nil</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28</span>        options: ImageOptions? = <span style="color:#cb4b16">nil</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29</span>        progress: LoaderProgressBlock? = <span style="color:#cb4b16">nil</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30</span>        completion: ((Result&lt;ImageResult, ImageError&gt;) -&gt; <span style="color:#b58900">Void</span>)? = <span style="color:#cb4b16">nil</span>) -&gt; CombinedOperation? {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31</span>            <span style="color:#586e75">// convert the `ImageOptions` into the actual `SDWebImage` and `SDWebImageContext`</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32</span>            <span style="color:#586e75">// finally call the exist `sd_setImage(with:) API</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33</span>        }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">34</span>}
</code></pre></div><p>å½“ç”¨æˆ·å¼•å…¥ <code>SwiftWebImage</code> framework æ—¶ï¼Œæ—§çš„ Swift API å°†è¢«æ ‡è®°ä¸ºä¸å¯ç”¨ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±èƒ½æ„‰å¿«çš„ä½¿ç”¨æ–° API äº†ã€‚</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span style="color:#268bd2">import</span> <span style="color:#268bd2">SwiftWebIamge</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span style="color:#268bd2">import</span> <span style="color:#268bd2">SDWebImage</span> <span style="color:#586e75">// This will be overlayed and not visible, actuallly you don&#39;t need to import this</span>
</code></pre></div><p>å¦å¤–ï¼Œè¿™é‡Œé€šè¿‡ <code>SDWebImageWrapper</code> å®ç°äº† Swift NameSpace å½¢å¼çš„ extensionã€‚<code>SDWebImageWrapper</code> ä½œä¸ºè£…é¥°å™¨å°†å¯¹åŸç±»å‹è¿›è¡Œå°è£…ï¼Œç„¶åæˆ‘ä»¬å†å¯¹ <code>SDWebImageWrapper</code> è¿›è¡Œè‡ªå®šä¹‰æ–¹æ³•çš„æ‰©å±•ï¼Œä»è€Œé¿å…äº†å‘½åå†²çªçš„é—®é¢˜ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹ç³»ç»Ÿåº“ä¸­çš„å·²æœ‰ç±»å‹ä½œè‡ªå®šä¹‰æ‰©å±•ã€‚</p>
<h2 id="0x03-overlay-framework-naming">0x03 Overlay framework naming</h2>
<p>æˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šåƒè‹¹æœæä¾›çš„æ ‡å‡†åº“ <code>Network.framework</code>,  å®ƒåœ¨ Swift Runtime æ—¶èƒ½å¤Ÿæä¾›ä¸€ç§ <code>overlay framework</code> å…¶åç§°ä¸åŸæœ‰ framework ä¸€æ ·ï¼ŒåŒä¸º <code>Network</code>ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨ï¼š</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span style="color:#268bd2">import</span> <span style="color:#268bd2">Network</span>
</code></pre></div><p>å…¶èƒŒåï¼Œæˆ‘ä»¬ import çš„å¹¶é <code>Network.framework</code>, è€Œæ˜¯ <code>libSwiftNetwork.dylib</code> åŠå…¶å¯¹åº”çš„ moduleã€‚</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#268bd2">import</span> <span style="color:#268bd2">SwiftNetwork</span> <span style="color:#586e75">// Actually what you do</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span style="color:#586e75">// The libSwiftNetwork has this:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>@<span style="color:#268bd2">_exported</span> <span style="color:#268bd2">import</span> <span style="color:#268bd2">Network</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>@available(<span style="color:#719e07">*</span>, unavailable, renamed: <span style="color:#2aa198">&#34;Network.NWInterface&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span><span style="color:#268bd2">typealias</span> nw_interface_t = OS_nw_interface
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span><span style="color:#268bd2">public</span> <span style="color:#268bd2">class</span> <span style="color:#268bd2">NWInterface</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>    <span style="color:#586e75">// ...Call C API for internal implementations</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>}
</code></pre></div><p>SDWebImage ä¹Ÿæƒ³é‡‡ç”¨è¿™æ ·çš„æ–¹æ¡ˆï¼Œå¦‚æ­¤å°±ä¸ç”¨å°† <code>import SDWebImage</code> æ›¿æ¢ä¸º <code>import SwiftWebImage</code>ï¼Œç„¶è€Œäº‹ä¸æ„¿è¿ï¼Œæ¯•ç«Ÿæˆ‘ä»¬åŒæ—¶æ”¯æŒäº† 3 ç§åŒ…ç®¡ç†æ–¹å¼ï¼š</p>
<ul>
<li>CocoaPods: æ”¯æŒè‡ªå®šä¹‰çš„ script phaseï¼Œ<code>prepare_script</code> æ¥å®Œæˆ <code>module name</code> çš„æ›¿æ¢ï¼›</li>
<li>Carthage: æ”¯æŒåœ¨ Xcode Project ä¸­è‡ªå®šä¹‰ Build Phaseï¼›</li>
<li>SwiftPM: ä¸å…è®¸åœ¨ä¸€ä¸ª module name ä¸‹åŒæ—¶å£°æ˜ä¸¤ä¸ª frameworkï¼›</li>
</ul>
<p>åŒæ—¶ï¼Œå¯¹ç°æœ‰çš„ SDWebImage 5.0 ç”¨æˆ·ï¼Œå¦‚æœä»–ä»¬ä¸æ„¿æ„æ›´æ–°ä¸ºæ–°çš„ Swifty APIï¼Œä»å¯ä»¥é€šè¿‡  <code>import SDWebImage</code> æ¥ä½¿ç”¨åŸæœ‰ Objective-C ç”Ÿæˆçš„ APIã€‚</p>
<p>ä»¥é‡å‘½åçš„æ–¹å¼æä¾›ä¸åŒäº <code>SDWebImage</code> åç§°çš„  overlay framework å¯ä»¥æ”¯æŒè¿™æ ·çš„æ“ä½œã€‚</p>
<p>ä»€ä¹ˆæ„æ€å‘¢ ï¼Ÿæ„å‘³ç€ä½ çš„é¡¹ç›®ä¸­å¯åŒæ—¶å­˜åœ¨ä¸¤ç§ä¸åŒçš„ Swift APIï¼Œå®ƒå–å†³äºä½ å¯¼å…¥çš„ frameworkã€‚</p>
<ul>
<li>ä¸ä½¿ç”¨ overlay framework</li>
</ul>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span style="color:#268bd2">import</span> <span style="color:#268bd2">SDWebImage</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span style="color:#268bd2">let</span> <span style="color:#268bd2">imageCache</span> = SDImageCache.shared
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>imageView.sd_setImage(with: url, options: [], context: [.imageScaleFactor : <span style="color:#2aa198">3</span>])
</code></pre></div><ul>
<li>ä½¿ç”¨ overlay framework</li>
</ul>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span style="color:#268bd2">import</span> <span style="color:#268bd2">SwiftWebImage</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span style="color:#268bd2">let</span> <span style="color:#268bd2">imageCache</span> = ImageCache.shared
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>imageView.sd.setImage(with: url, options: [.scaleFactor(<span style="color:#2aa198">3</span>)])
</code></pre></div><p>æ¯•ç«Ÿï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ Swift æ˜¯æœ‰ name space éš”ç¦»çš„ã€‚</p>
<h2 id="0x04-æ”¾å¼ƒ-objective-c-ç”¨æˆ·--ç”¨-swift-é‡å†™">0x04 æ”¾å¼ƒ Objective-C ç”¨æˆ· &amp; ç”¨ Swift é‡å†™</h2>
<p>ä½œä¸ºä¸ªäººæ„è§ï¼Œè¿™å¹¶éä¸€ä¸ªå¥½ä¸»æ„ã€‚åœ¨ iOS ç¤¾åŒºä¸­å·²ç»æœ‰å¾ˆå¤šå¾ˆæ£’çš„çº¯ Swift çš„å›¾ç‰‡åŠ è½½æ¡†æ¶ï¼Œå¦‚ <a href="https://github.com/onevcat/Kingfisher">Kingfisher</a>, <a href="https://github.com/kean/Nuke">Nuke</a> ç­‰ã€‚</p>
<p>å¤§å®¶éƒ½æœ‰ä¸€äº›å…±é€šçš„è®¾è®¡å’Œè§£å†³æ–¹æ¡ˆã€‚å¦‚æœå®Œå…¨é‡å†™å°†éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å’Œå•æµ‹æ¥ä¿è¯åŠŸèƒ½çš„ç¨³å®šæ€§ã€‚å†µä¸”ï¼Œä»ç„¶æœ‰å¾ˆå¤š Objective-C é¡¹ç›®å’Œç”¨æˆ·åœ¨ä½¿ç”¨ SDWebImage 5.0ã€‚å°¤å…¶åœ¨å›½å†…ï¼Œ80% ä»¥ä¸Šé‡‡ç”¨ Objective-C çš„å…¬å¸éƒ½åœ¨ä½¿ç”¨ SDWebImage (éä¸ªäºº)ã€‚ä»–ä»¬ä¸­è¿˜æœ‰å¤§é‡ä½¿ç”¨ Swift ä¸ Objective-C æ··ç¼–ã€‚æ”¾å¼ƒè¿™äº›ç”¨æˆ·å€¼å¾—æ·±æ€ï¼</p>
<p>å¯¹äºç°é˜¶æ®µè€Œè¨€ï¼Œä¸è®ºæ˜¯é€‰æ‹© Objective-C æˆ–è€… Swift éƒ½æ˜¯å®ç°ç»†èŠ‚ï¼Œè€Œé‡‡ç”¨ Swift å¯èƒ½æœ‰çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šä¸èµåŒï¼Œåœ¨ Kingfisher å’Œ Nuke ä¸­åŒæ ·æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œè¿™å¹¶éè¯­è¨€å±‚é¢å¯ä»¥è§£å†³çš„ã€‚ å½“ç„¶ï¼ŒSwift æä¾›äº†ä¸¥æ ¼çš„ Optioanl ç±»å‹æ¥é¿å…ä¸€äº›å¸¸è§çš„é”™è¯¯ï¼Œå¦‚ null æ£€æŸ¥ã€‚å¦å¤–ï¼ŒSwift 5.5 ä¸­æä¾›çš„ Actor ä¹Ÿèƒ½ä»ä¸€å®šç¨‹åº¦ä¸Šè§„é¿å¹¶éå¸¦æ¥çš„é—®é¢˜ï¼›</li>
<li>**æ€§èƒ½ï¼š**å¯¹äºå›¾ç‰‡åŠ è½½æ¡†æ¶è€Œè¨€å…¶æ€§èƒ½ç“¶é¢ˆå¹¶éç”± Objective-C runtime çš„æ¶ˆæ¯å‘é€æ¶æ„å†³å®šçš„ï¼Œè€Œæ˜¯ç”±ä¸€äº›è°ƒåº¦é˜Ÿåˆ—ã€å›¾ç‰‡è§£ç ç­‰å…¶ä»–é—®é¢˜çš„ã€‚è¿™äº›ä¹Ÿå¹¶é Swift èƒ½è§£å†³çš„ï¼›</li>
<li>**ç»´æŠ¤ï¼š**ä½œä¸ºä¸»è¦åŸå› ï¼Œå¯¹äº iOS ç¨‹åºå‘˜çš„æ–°æ‰‹æ¥è¯´ï¼Œä»–ä»¬å¯èƒ½ä¸å¤ªäº†è§£ä¸€äº› Objective-C çš„æœ€ä½³å®è·µå’Œè‰¯å¥½çš„ä»£ç è§„èŒƒï¼Œè€Œç”¨ Swift å®ç°çš„è¯å¯ä»¥å¸å¼•æ›´å¤šä¼˜ç§€æ–°äººä¸º SDWebImage è´¡çŒ®ï¼›</li>
</ul>
<p>å› æ­¤ï¼Œç°é˜¶æ®µè€Œè¨€ï¼Œæˆ‘ä»¬ä»…éœ€è¦æä¾› Swift å‹å¥½çš„ API å³å¯ï¼Œå†…æ ¸ä»ä»¥ Objective-C å®ç°ã€‚æ¯•ç«Ÿ SDWebImage ç»è¿‡è¿™ä¹ˆå¤šå¹´çš„è¿­ä»£ï¼Œå¯é æ€§ä¸ç¨³å®šæ€§éƒ½æœ‰å¾ˆå¥½çš„ä¿è¯ã€‚</p>
<h1 id="å¼€æºå®è·µ">å¼€æºå®è·µ</h1>
<p>åœ¨ææ¡ˆçš„è®¨è®ºä¸­ï¼Œä¹Ÿæåˆ°äº†ä¼˜ç§€å¤§å‚çš„ä¸€äº›å®è·µã€‚ä»–ä»¬çš„åšæ³•ä¹Ÿæ˜¯å€¼å¾—æˆ‘ä»¬è€ƒè™‘çš„ã€‚</p>
<h2 id="facebook-ios-sdk">facebook-ios-sdk</h2>
<p>facebook å®¶æä¾›çš„ <a href="https://github.com/facebook/facebook-ios-sdk">facebook-ios-sdk</a>ï¼Œä»–ä»¬ä¸º Swift ç”¨æˆ·æä¾›äº†æ–°çš„ç¬¦åˆ Swift ç‰¹æ€§çš„ Swift Moduleï¼Œä¸è¿‡å®ƒåŸºäºåŸæœ‰çš„ Objective-C framework æ¥åŒ…è£…çš„äº§ç‰©ã€‚å› æ­¤ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å…¶é€‰æ‹©æ¥ import ä¸åŒçš„ frameworkã€‚æ˜¾ç„¶åƒ facebook-ios-sdk å¤æ‚çš„ frameworkï¼Œä»–ä»¬é€‰æ‹©äº†æˆæœ¬ç›¸å¯¹è¾ƒä½çš„ <code>Overlay Framework</code> æ–¹æ¡ˆã€‚å¦‚å‰é¢æåˆ°ç”¨ Swift é‡å†™ä¹Ÿæœªèƒ½æ˜¾è‘—æé«˜æ€§èƒ½æˆ–è€…å®‰å…¨æ€§ï¼Œæ¯•ç«Ÿä»–ä»¬å·²é€šè¿‡ä½¿ç”¨è¾ƒä½çš„ C API å’Œçº¿ç¨‹å®‰å…¨é”è§£å†³äº†ï¼Œè¿™åœ¨ Swift è¯­è¨€å±‚é¢æ— æ³•è§£å†³çš„ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ç‰ˆæœ¬ <code>v12.0.0</code> çš„ <a href="https://github.com/facebook/facebook-ios-sdk/blob/main/Package.swift">Package.swift</a> çš„ä»¥äº§ç‰©ä¹‹ä¸€ <code>FacebookCore</code> æ¥ä¸¾ä¾‹ã€‚</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#268bd2">import</span> <span style="color:#268bd2">PackageDescription</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span><span style="color:#268bd2">let</span> <span style="color:#268bd2">conditionalCompilationFlag</span> = <span style="color:#2aa198">&#34;FBSDK_SWIFT_PACKAGE&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span><span style="color:#268bd2">let</span> <span style="color:#268bd2">package</span> = Package(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>    name: <span style="color:#2aa198">&#34;Facebook&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>    products: [
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>        .library(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>            name: <span style="color:#2aa198">&#34;FacebookCore&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>            targets: [<span style="color:#2aa198">&#34;FacebookCore&#34;</span>, <span style="color:#2aa198">&#34;FBSDKCoreKit&#34;</span>]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>        ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>	     ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>    ],
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>    targets: [
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>        .target(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>            name: <span style="color:#2aa198">&#34;FBSDKCoreKit_Basics&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>        ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>        .target(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>            name: <span style="color:#2aa198">&#34;LegacyCore&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span>            dependencies: [<span style="color:#2aa198">&#34;FBSDKCoreKit_Basics&#34;</span>, <span style="color:#2aa198">&#34;FBAEMKit&#34;</span>],
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span>            path: <span style="color:#2aa198">&#34;FBSDKCoreKit/FBSDKCoreKit&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span>            exclude: [<span style="color:#2aa198">&#34;Swift&#34;</span>], ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span>        ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span>        .target(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span>            name: <span style="color:#2aa198">&#34;FacebookCore&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span>            dependencies: [<span style="color:#2aa198">&#34;LegacyCore&#34;</span>], ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span>        ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28</span>        .target(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29</span>            name: <span style="color:#2aa198">&#34;FBSDKCoreKit&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30</span>            dependencies: [<span style="color:#2aa198">&#34;LegacyCore&#34;</span>, <span style="color:#2aa198">&#34;FacebookCore&#34;</span>], ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31</span>        ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32</span>    ]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33</span>)
</code></pre></div><blockquote>
<p>Tipsï¼šæ–°æä¾›çš„ FacebookCore framework ä»…æ”¯æŒ SPMï¼Œå°šæœªæ”¯æŒ CocoaPods æ–¹å¼å¼•å…¥ã€‚</p>
</blockquote>
<h3 id="framework-products">framework products</h3>
<p>çœ‹æ„å»ºäº§ç‰© library FacebookCore ä½œä¸ºæ ¸å¿ƒ SDKï¼Œå®ƒæä¾›äº†ä¸¤ç§å¯å¯¼å…¥ module äº§ç‰©ï¼Œ<code>FacebookCore</code> å’Œ <code>FBSDKCoreKit</code> ã€‚æ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸¤ç§ä¸åŒçš„å‰ç¼€ <code>Facebook</code> å’Œ <code>FB</code>ã€‚<code>Facebook</code> ä»£è¡¨çš„åˆ™æ˜¯æ–°æä¾›çš„ Swift frameworkï¼Œè€Œ <code>FB</code> åˆ™ä»£è¡¨çš„æ˜¯åŸæœ‰çš„ Objective-C frameworkã€‚</p>
<p>è¿™é‡ŒæŒ‰è¯­è¨€å°† FacebookCore åˆ†æˆ Objective-C ä¸ Swift ä¸¤ä¸ª target ä¹Ÿæ˜¯ä¸å¾—å·²è€Œä¸ºä¹‹ï¼Œå› ä¸º <a href="https://forums.swift.org/t/using-a-swift-package-in-a-mixed-swift-and-objective-c-project/27348">SPM ç›®å‰ä»ä¸æ”¯æŒ å¤šè¯­è¨€æ··ç¼–</a>ã€‚å¦å¤–ä¸ºäº†æ›´å¥½å¤ç”¨ç¼–è¯‘äº§ç‰©ï¼Œä»–ä»¬å¯¹å…¬ç”¨é€»è¾‘è¿›è¡ŒäºŒæ¬¡æ‹†åˆ†ï¼Œå‰¥ç¦»å‡º <code>LegacyCore</code> targetã€‚</p>
<p>FacebookCore å°†é€šè¿‡ overlay framework æ¥æä¾›é¢å‘ Swift å‹å¥½çš„ APIï¼Œæœ€åç”¨æˆ·ä¹Ÿå°†è¢«åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p>
<ol>
<li>å¼•å…¥ <code>FacebookCore</code> æ¥ä½¿ç”¨å®Œå–„ Swift API çš„ Swift ç”¨æˆ·ï¼›</li>
<li>å¼•å…¥ <code>FBSDKCoreKit</code> æ¥ä½¿ç”¨ç”± Objective-C æ¥å£ç¿»è¯‘è¿‡æ¥çš„ Swift ç”¨æˆ·ï¼›</li>
<li>å¼•å…¥ <code>FBSDKCoreKit</code> çš„ Objective-C ç”¨æˆ·ï¼›</li>
</ol>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>è¦è¯´ä½¿ç”¨ Swift ä¼˜ç‚¹çš„è¯ï¼Œå¯¹ iOS å¼€å‘åˆå­¦è€…æ›´å…·å¸å¼•åŠ›ç®—æ˜¯ä¸€ç‚¹ã€‚å¯¹äºéœ€è¦æ·±å…¥ç‰¹å®šé¢†åŸŸçš„é—®é¢˜ï¼Œå¦‚ decoding æˆ–è€… transformerï¼Œç”¨ Swift é‡å†™å’Œ Objective-C ä¸€æ ·ä¸‘é™‹ï¼Œå¹¶æ— å¤ªå¤šåŒºåˆ« ğŸ˜…ã€‚å› æ­¤ï¼Œä½œä¸ºæ¡†æ¶æä¾›è€…ï¼Œè¦è·³å‡ºè¯­è¨€çš„é™åˆ¶ï¼Œä»æ›´é«˜è§’åº¦çœ‹å¾…é—®é¢˜ã€‚</p>
<p>çºµè§‚æ•´ä¸ª SDWebImage 6.0 ææ¡ˆçš„è®¨è®ºè¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°å…¶ç»´æŠ¤è€…çš„ä¸¥è°¨æ€åº¦ã€‚ä¸ä»…èƒ½ä»ç”¨æˆ·ä½¿ç”¨ä½“éªŒå’Œç»´æŠ¤æˆæœ¬è§’åº¦æ¥æƒè¡¡æ–¹æ¡ˆå˜æ›´å¸¦æ¥çš„å½±å“ï¼Œå¹¶ä¸”åšäº†è¯¦ç»†çš„è°ƒç ”å’Œç ”ç©¶åˆ†æã€‚</p>
<p>å¸Œæœ›æœ¬æ–‡èƒ½ä¸ºä» Objective-C è½¬å‘ Swift çš„å¼€å‘è€…æä¾›ä¸€äº›å¸®åŠ©ã€‚</p>
</section>

  
  
  <footer class="post-tags">
     
    <a href="https://looseyi.github.io/tags/ios">iOS&#39;</a>
     
    <a href="https://looseyi.github.io/tags/swift">Swift</a>
     
    <a href="https://looseyi.github.io/tags/framework">Framework</a>
    
  </footer>
  

  
  
  
  <nav class="post-nav">
     
    <a class="next" href="https://looseyi.github.io/post/sourcecode-ios/cocoapods-binary-1/"><span>æµ…æ cocoapods-binary</span><span>â†’</span></a>
    
  </nav>
  

  
  
</article>


			

  

  
    <script src="https://utteranc.es/client.js"
            repo="looseyi/looseyi.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

		</main>

    <footer class="footer">
  <p>&copy; 2021 <a href="https://looseyi.github.io/">Aha Edmond</a></p>
  <p>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugoï¸ï¸</a>ï¸</p>
  <p>
    <a href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank">Paper 5.1</a>
  </p>
</footer>

		


  </body>
</html>
