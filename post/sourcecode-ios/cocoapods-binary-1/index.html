<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>æµ…æ cocoapods-binary - </title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="åœŸåœŸEdmondæœ¨" /><meta name="description" content="#ä»‹ç» cocoapods-binary æœ€æ—©æ˜¯åœ¨ CocoaPods çš„ Blog ä¸­å‘ç°çš„ï¼špre-compiling dependenciesã€‚è™½éå®˜æ–¹å‡ºå“ï¼Œä½†å´æ˜¯å›½å†…ç¨‹åºå‘˜çš„åŠ›ä½œï¼Œmedium åŸç‰ˆä»‹" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.71.1 with theme even" />


<link rel="canonical" href="http://looseyi.github.io/post/sourcecode-ios/cocoapods-binary-1/" />
  <link href="http://looseyi.github.io/post/sourcecode-ios/cocoapods-binary-1/index.xml" rel="alternate" type="application/rss+xml" title="" />
  <link href="http://looseyi.github.io/post/sourcecode-ios/cocoapods-binary-1/index.xml" rel="feed" type="application/rss+xml" title="" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="æµ…æ cocoapods-binary" />
<meta property="og:description" content="#ä»‹ç» cocoapods-binary æœ€æ—©æ˜¯åœ¨ CocoaPods çš„ Blog ä¸­å‘ç°çš„ï¼špre-compiling dependenciesã€‚è™½éå®˜æ–¹å‡ºå“ï¼Œä½†å´æ˜¯å›½å†…ç¨‹åºå‘˜çš„åŠ›ä½œï¼Œmedium åŸç‰ˆä»‹" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://looseyi.github.io/post/sourcecode-ios/cocoapods-binary-1/" />
<meta property="article:published_time" content="2019-12-21T11:37:41+21:00" />
<meta property="article:modified_time" content="2019-12-21T11:37:41+21:00" />
<meta itemprop="name" content="æµ…æ cocoapods-binary">
<meta itemprop="description" content="#ä»‹ç» cocoapods-binary æœ€æ—©æ˜¯åœ¨ CocoaPods çš„ Blog ä¸­å‘ç°çš„ï¼špre-compiling dependenciesã€‚è™½éå®˜æ–¹å‡ºå“ï¼Œä½†å´æ˜¯å›½å†…ç¨‹åºå‘˜çš„åŠ›ä½œï¼Œmedium åŸç‰ˆä»‹">
<meta itemprop="datePublished" content="2019-12-21T11:37:41&#43;21:00" />
<meta itemprop="dateModified" content="2019-12-21T11:37:41&#43;21:00" />
<meta itemprop="wordCount" content="4781">



<meta itemprop="keywords" content="CocoaPods,iOS,Binary," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="æµ…æ cocoapods-binary"/>
<meta name="twitter:description" content="#ä»‹ç» cocoapods-binary æœ€æ—©æ˜¯åœ¨ CocoaPods çš„ Blog ä¸­å‘ç°çš„ï¼špre-compiling dependenciesã€‚è™½éå®˜æ–¹å‡ºå“ï¼Œä½†å´æ˜¯å›½å†…ç¨‹åºå‘˜çš„åŠ›ä½œï¼Œmedium åŸç‰ˆä»‹"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Aha Moment</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Aha Moment</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">æµ…æ cocoapods-binary</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-12-21 </span>
        <div class="post-category">
            <a href="/categories/ios/"> iOS </a>
            <a href="/categories/cocoapods/"> CocoaPods </a>
            </div>
          <span class="more-meta"> çº¦ 4781 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 10 åˆ†é’Ÿ </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#ç¯å¢ƒæ£€æŸ¥">ç¯å¢ƒæ£€æŸ¥</a></li>
    <li><a href="#binary-pod-çš„ä¸‹è½½å®‰è£…">Binary Pod çš„ä¸‹è½½å®‰è£…</a>
      <ul>
        <li><a href="#install">install</a></li>
      </ul>
    </li>
    <li><a href="#é¢„ç¼–è¯‘ç¯å¢ƒæ§åˆ¶">é¢„ç¼–è¯‘ç¯å¢ƒæ§åˆ¶</a>
      <ul>
        <li><a href="#is_prebuild_stag">is_prebuild_stag</a></li>
        <li><a href="#enable_prebuild_patch">enable_prebuild_patch</a></li>
        <li><a href="#force_disable_integration">force_disable_integration</a></li>
        <li><a href="#disable_install_complete_message">disable_install_complete_message</a></li>
        <li><a href="#force_disable_write_lockfile">force_disable_write_lockfile</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#é¢„ç¼–è¯‘çš„ç¼“å­˜æŸ¥è¯¢">é¢„ç¼–è¯‘çš„ç¼“å­˜æŸ¥è¯¢</a>
      <ul>
        <li><a href="#é¢„ç¼–è¯‘çš„-mainfest-æ£€æŸ¥">é¢„ç¼–è¯‘çš„ mainfest æ£€æŸ¥</a></li>
        <li><a href="#é¢„ç¼–è¯‘çš„-pods-å˜æ›´æ£€æŸ¥">é¢„ç¼–è¯‘çš„ pods å˜æ›´æ£€æŸ¥</a></li>
        <li><a href="#é¢„ç¼–è¯‘çš„-framework-ç¼“å­˜æ£€æŸ¥">é¢„ç¼–è¯‘çš„ framework ç¼“å­˜æ£€æŸ¥</a></li>
      </ul>
    </li>
    <li><a href="#target-ç¼–è¯‘">Target ç¼–è¯‘</a>
      <ul>
        <li><a href="#prebuild_frameworks">prebuild_frameworks!</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#resolve-dependencies">resolve dependencies</a></li>
    <li><a href="#download-dependencies">download dependencies</a></li>
    <li><a href="#embedframeworksscript">EmbedFrameworksScript</a></li>
    <li><a href="#æµç¨‹å›¾">æµç¨‹å›¾</a></li>
    <li><a href="#ç»“æœå¯¹æ¯”">ç»“æœå¯¹æ¯”</a></li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>#ä»‹ç»</p>
<p>cocoapods-binary æœ€æ—©æ˜¯åœ¨ CocoaPods çš„ Blog ä¸­å‘ç°çš„ï¼š<a href="https://guides.cocoapods.org/plugins/pre-compiling-dependencies.html">pre-compiling dependencies</a>ã€‚è™½éå®˜æ–¹å‡ºå“ï¼Œä½†å´æ˜¯å›½å†…ç¨‹åºå‘˜çš„åŠ›ä½œï¼Œmedium åŸç‰ˆä»‹ç»ï¼š<a href="https://medium.com/@gaojiji/%E5%8A%A0%E5%BF%AB-cocoapods-%E9%A1%B9%E7%9B%AE%E7%BC%96%E8%AF%91%E6%97%B6%E9%97%B4-pod-%E9%A2%84%E7%BC%96%E8%AF%91%E7%9A%84%E5%82%BB%E7%93%9C%E5%BC%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-6b791daf192d">Pod é¢„ç¼–è¯‘çš„å‚»ç“œå¼è§£å†³æ–¹æ¡ˆ</a>ï¼š</p>
<blockquote>
<p>A CocoaPods plugin to integrate pods in form of prebuilt frameworks, not source code, by adding <strong>just one flag</strong> in podfile. Speed up compiling dramatically.</p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œcocoapods-binary é€šè¿‡å¼€å…³ï¼Œåœ¨ pod insatll çš„è¿‡ç¨‹ä¸­è¿›è¡Œ library çš„é¢„ç¼–è¯‘ï¼Œç”Ÿæˆ frameworkï¼Œå¹¶è‡ªåŠ¨é›†æˆåˆ°é¡¹ç›®ä¸­ã€‚</p>
<p>æ•´ä¸ªé¢„ç¼–è¯‘å·¥ä½œåˆ†æˆäº†ä¸‰ä¸ªé˜¶æ®µæ¥å®Œæˆï¼š</p>
<ul>
<li>binary pod çš„å®‰è£…</li>
<li>binary  pod çš„é¢„ç¼–è¯‘</li>
<li>binary pod çš„é›†æˆ</li>
</ul>
<h1 id="binary-pod-çš„å®‰è£…">Binary Pod çš„å®‰è£…</h1>
<p>Binary Pod çš„å®‰è£…ä½œæ˜¯ä»¥ <code>pre_install</code> hook ä½œä¸ºå…¥å£ï¼Œå¼€å§‹æ’ä»¶çš„è¿ä½œã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/8157560cly1gfopbdyts7j20l10f3dh6.jpg" alt="pre_install.png"></p>
<p>å½“æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ <code>pod install</code>ï¼ŒCocoaPods ä¼šä¾æ¬¡æ‰§è¡Œ ğŸ‘† å›¾çš„å‡ ä¸ªæ–¹æ³•ã€‚cocoapods-binary çš„ <code>pre_install</code> å°±æ˜¯åœ¨ prepare é˜¶æ®µæ’å…¥çš„é€»è¾‘ã€‚</p>
<p>è¿™é‡Œçš„ <code>pre_install</code> ä¸åŒäº <code>Podfile</code> ä¸­çš„ <a href="https://guides.cocoapods.org/syntax/podfile.html#pre_install">pre_install</a>ï¼Œå…¶æ‹¦æˆªæ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="no">Pod</span><span class="o">::</span><span class="no">HooksManager</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;cocoapods-binary&#39;</span><span class="p">,</span> <span class="ss">:pre_install</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">installer_context</span><span class="o">|</span>
	<span class="o">...</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>åˆ©ç”¨ CocoaPods æä¾›çš„ <a href="https://www.rubydoc.info/github/CocoaPods/CocoaPods/Pod/HooksManager">HooksManager</a> æ³¨å†Œ <code>pre_install</code> hook æ¥ä¸‹è½½ binary podsã€‚è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/8157560cly1gflvtlvtqvj208n067aa9.jpg" alt="Main.png"></p>
<h2 id="ç¯å¢ƒæ£€æŸ¥">ç¯å¢ƒæ£€æŸ¥</h2>
<p>ç¯å¢ƒæ£€æŸ¥ï¼Œé¦–å…ˆæ˜¯é€šè¿‡æ ‡è®°å…¨å±€çš„ <code>is_prebuild_stage</code> æ¥é˜²æ­¢ <code>pre_install</code> é‡å¤çš„è¿›å…¥ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="k">if</span> <span class="no">Pod</span><span class="o">.</span><span class="n">is_prebuild_stage</span>
  	 <span class="k">next</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>æ¥ç€æ£€æŸ¥ podfile æ˜¯å¦è®¾ç½®äº† <code>use_framework!</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="n">podfile</span> <span class="o">=</span> <span class="n">installer_context</span><span class="o">.</span><span class="n">podfile</span>
<span class="n">podfile</span><span class="o">.</span><span class="n">target_definition_list</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">target_definition</span><span class="o">|</span>
    <span class="k">next</span> <span class="k">if</span> <span class="n">target_definition</span><span class="o">.</span><span class="n">prebuild_framework_pod_names</span><span class="o">.</span><span class="n">empty?</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">target_definition</span><span class="o">.</span><span class="n">uses_frameworks?</span>
        <span class="no">STDERR</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&#34;[!] Cocoapods-binary requires `use_frameworks!`&#34;</span><span class="o">.</span><span class="n">red</span>
        <span class="nb">exit</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>å³ cocoapods-binary éœ€è¦æ‰“å‡ºçš„åŒ…ä¸º framework çš„å½¢å¼ã€‚äº†è§£æ›´å¤š CocoaPods ä½¿ç”¨ framework çš„åŸå› ï¼Œè¯·çŒ›æˆ³ <a href="https://stackoverflow.com/questions/41210249/why-do-we-use-use-frameworks-in-cocoapods">è¿™é‡Œ</a>ã€‚</p>
<h2 id="binary-pod-çš„ä¸‹è½½å®‰è£…">Binary Pod çš„ä¸‹è½½å®‰è£…</h2>
<blockquote>
<p>è¿™é‡Œè¯´çš„ binary pod éƒ½æ˜¯åœ¨ podfile ä¸­è¢«æ ‡è®°ä¸º <code>:binary =&gt; true</code> çš„ã€‚</p>
</blockquote>
<p>å®‰è£…å‰éœ€è¦ hook ç›¸å…³æ–¹æ³•è¿›è¡Œé¢„ç¼–è¯‘çŠ¶æ€æ£€æŸ¥ï¼Œå¹¶åœ¨å®‰è£…ç»“æŸåå°†å®ƒä»¬é‡ç½®ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="no">Pod</span><span class="o">.</span><span class="n">is_prebuild_stage</span> <span class="o">=</span> <span class="kp">true</span>
<span class="no">Pod</span><span class="o">::</span><span class="no">Podfile</span><span class="o">::</span><span class="no">DSL</span><span class="o">.</span><span class="n">enable_prebuild_patch</span> <span class="kp">true</span>
<span class="no">Pod</span><span class="o">::</span><span class="no">Installer</span><span class="o">.</span><span class="n">force_disable_integration</span> <span class="kp">true</span>
<span class="no">Pod</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">force_disable_write_lockfile</span> <span class="kp">true</span>
<span class="no">Pod</span><span class="o">::</span><span class="no">Installer</span><span class="o">.</span><span class="n">disable_install_complete_message</span> <span class="kp">true</span>
<span class="o">...</span> 
<span class="c1"># install æˆåŠŸåå°† ğŸ‘† 5 ä¸ªå˜é‡é‡ç½®ä¸º false</span>
<span class="no">Pod</span><span class="o">::</span><span class="no">UserInterface</span><span class="o">.</span><span class="n">warnings</span> <span class="o">=</span> <span class="o">[]</span> <span class="c1"># clean the warning in the prebuild step, it&#39;s duplicated.</span>
</code></pre></td></tr></table>
</div>
</div><p>æ¥ç€åˆå§‹åŒ– binary_installerï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="n">update</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="n">repo_update</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="kp">include</span> <span class="no">ObjectSpace</span>
<span class="no">ObjectSpace</span><span class="o">.</span><span class="n">each_object</span><span class="p">(</span><span class="no">Pod</span><span class="o">::</span><span class="no">Installer</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">installer</span><span class="o">|</span>
    <span class="n">update</span> <span class="o">=</span> <span class="n">installer</span><span class="o">.</span><span class="n">update</span>
    <span class="n">repo_update</span> <span class="o">=</span> <span class="n">installer</span><span class="o">.</span><span class="n">repo_update</span>
<span class="p">}</span>

<span class="n">standard_sandbox</span> <span class="o">=</span> <span class="n">installer_context</span><span class="o">.</span><span class="n">sandbox</span>
<span class="n">prebuild_sandbox</span> <span class="o">=</span> <span class="no">Pod</span><span class="o">::</span><span class="no">PrebuildSandbox</span><span class="o">.</span><span class="n">from_standard_sandbox</span><span class="p">(</span><span class="n">standard_sandbox</span><span class="p">)</span>
<span class="n">prebuild_podfile</span> <span class="o">=</span> <span class="no">Pod</span><span class="o">::</span><span class="no">Podfile</span><span class="o">.</span><span class="n">from_Ruby</span><span class="p">(</span><span class="n">podfile</span><span class="o">.</span><span class="n">defined_in_file</span><span class="p">)</span>
<span class="n">lockfile</span> <span class="o">=</span> <span class="n">installer_context</span><span class="o">.</span><span class="n">lockfile</span>
<span class="n">binary_installer</span> <span class="o">=</span> <span class="no">Pod</span><span class="o">::</span><span class="no">Installer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">prebuild_sandbox</span><span class="p">,</span> <span class="n">prebuild_podfile</span><span class="p">,</span> <span class="n">lockfile</span><span class="p">)</span>

<span class="c1"># install ...</span>
</code></pre></td></tr></table>
</div>
</div><p>installer çš„åˆå§‹åŒ–éœ€è¦ï¼š<code>prebuild_sandbox</code>ã€<code>prebuild_podfile</code>ã€<code>lockfile</code>ã€‚</p>
<p><code>prebuild_sandbox</code> ç®¡ç†çš„ç›®å½•åœ¨ <code>Pods/_Prebuild</code>ï¼Œå®ƒæ˜¯ Sandbox çš„å­ç±»ã€‚Sandbox ç®¡ç†ç€ CocoaPods çš„ <code>/Pods</code> ç›®å½•ã€‚</p>
<p>lockfile å’Œ prebuild_podfile æ˜¯åˆ†åˆ«ä»å·¥ç¨‹ç›®å½•çš„ <code>podfile.lock</code> å’Œ <code>Podfile</code> ä¸­è¯»å–çš„ã€‚</p>
<h3 id="install">install</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="k">if</span> <span class="n">binary_installer</span><span class="o">.</span><span class="n">have_exact_prebuild_cache?</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">update</span>
    <span class="n">binary_installer</span><span class="o">.</span><span class="n">install_when_cache_hit!</span>
<span class="k">else</span>
    <span class="n">binary_installer</span><span class="o">.</span><span class="n">update</span> <span class="o">=</span> <span class="n">update</span>
    <span class="n">binary_installer</span><span class="o">.</span><span class="n">repo_update</span> <span class="o">=</span> <span class="n">repo_update</span>
    <span class="n">binary_installer</span><span class="o">.</span><span class="n">install!</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>å½“ç¼“å­˜å‘½ä¸­ä¸”æ²¡æœ‰ pod éœ€è¦æ›´æ–°æ—¶ï¼Œä¼šæ‰§è¡Œ <code>install_when_cache_hit!</code> ï¼ˆå°±æ˜¯æ‰“å°ä¸€ä¸‹ cache podsï¼‰ï¼Œå¦åˆ™å¼€å§‹ binary pod çš„ä¸‹è½½ï¼Œä¸‹è½½ç›®å½•å°±åœ¨  <code>Pods/_Prebuild</code> ä¸‹ã€‚</p>
<h2 id="é¢„ç¼–è¯‘ç¯å¢ƒæ§åˆ¶">é¢„ç¼–è¯‘ç¯å¢ƒæ§åˆ¶</h2>
<p>èŠä¸€ä¸‹ä¸Šé¢çš„ 5 ä¸ªç¯å¢ƒæ§åˆ¶å¼€å…³ï¼Œå®šä¹‰åœ¨ <a href="https://github.com/leavez/cocoapods-binary/blob/master/lib/cocoapods-binary/helper/feature_switches.rb">feature_switches.rb</a> ã€‚</p>
<h3 id="is_prebuild_stag">is_prebuild_stag</h3>
<blockquote>
<p>ç”¨äºæ ‡è®°å½“å‰æ˜¯å¦åœ¨è¿›è¡Œ binary installã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">class_attr_accessor</span> <span class="ss">:is_prebuild_stage</span>

<span class="k">def</span> <span class="nf">class_attr_accessor</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:attr_accessor</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p><code>attr_accessor</code> æ˜¯ Ruby ä¸º instance æä¾›çš„ Access æ–¹æ³•ï¼Œç±»ä¼¼ Objc çš„ <code>@perperty</code> å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ getter &amp; setterã€‚ä½œè€…åˆ©ç”¨ Ruby çš„åŠ¨æ€è°ƒç”¨ï¼Œå°† symbol å‘é€ç»™ <code>attr_accessor</code> æ¥æ·»åŠ  <code>class_attr_accessor</code> çš„æ‰©å±•ã€‚</p>
<h3 id="enable_prebuild_patch">enable_prebuild_patch</h3>
<blockquote>
<p>ç”¨äºè¿‡æ»¤å‡ºéœ€è¦é¢„ç¼–è¯‘çš„ podï¼Œé»˜è®¤ä¸º falseã€‚</p>
</blockquote>
<p>Cocoapods-Binary åœ¨<a href="https://github.com/leavez/cocoapods-binary#usage">ä½¿ç”¨è¯´æ˜</a>ä¸­æåˆ°è¿‡ä¸¤ç§è®¾ç½®é¢„ç¼–è¯‘çš„æ–¹å¼ï¼š</p>
<ul>
<li>é’ˆå¯¹å•ä¸ªå…·ä½“çš„ pod çš„å¯é€‰å‚æ•°ï¼š<code>:binary =&gt; true</code></li>
<li>åœ¨æ‰€æœ‰ targets ä¹‹å‰çš„å…¨å±€å‚æ•°ï¼š<code>all_binary!</code></li>
</ul>
<p>enable_prebuild_patch å°±æ˜¯ç”¨äºå®ç°è¿™ä¸¤ä¸ªå˜é‡çš„åˆ¤æ–­é€»è¾‘ï¼Œåªæœ‰åœ¨ binary install æ—¶ä¼šå°† enable_prebuild_patch è®¾ä¸º trueï¼Œå¼€å¯ä¹‹åä¸éœ€è¦é¢„ç¼–è¯‘çš„ <code>pod</code> éƒ½ä¼šè¢«å¿½ç•¥æ‰ã€‚å®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="k">class</span> <span class="nc">Podfile</span>
    <span class="k">module</span> <span class="nn">DSL</span>        
        <span class="vc">@@enable_prebuild_patch</span> <span class="o">=</span> <span class="kp">false</span>
        <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">enable_prebuild_patch</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="vc">@@enable_prebuild_patch</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">end</span>

        <span class="n">old_method</span> <span class="o">=</span> <span class="nb">instance_method</span><span class="p">(</span><span class="ss">:pod</span><span class="p">)</span>
        <span class="n">define_method</span><span class="p">(</span><span class="ss">:pod</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="o">|</span>
            <span class="k">if</span> <span class="o">!</span><span class="vc">@@enable_prebuild_patch</span>
                <span class="n">old_method</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">end</span>
            <span class="c1"># --- patch content ---</span>
            <span class="o">...</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>ç”±äºå¯é€‰å‚æ•° <code>:binary =&gt; true</code> æ˜¯æ·»åŠ åœ¨æ¯ä¸ª pod ä¸Šï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å…ˆ hook pod å®ç°æ¥è·å– optionsã€‚</p>
<ol>
<li>é€šè¿‡ <code>instance_method</code> è·å–æ—§çš„ <code>pod</code> æ–¹æ³•</li>
<li>ç”¨ <code>define_method</code> æ¥å®Œæˆé‡è½½</li>
<li>ä»¥ <code>old_method.bind(self).(name, *args)</code> å®ŒæˆåŸæœ‰é€»è¾‘çš„è°ƒç”¨ã€‚</li>
</ol>
<p><strong>Ruby Method Swizzling ä¸‰éƒ¨æ›²</strong> ğŸ˜‚ ï¼Œåç»­è¿˜æœ‰è®¸å¤šä½¿ç”¨è¯¥æ–¹å¼çš„ hook æ“ä½œã€‚</p>
<p>æ¥ç€çœ‹ patch content é€»è¾‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="n">should_prebuild</span> <span class="o">=</span> <span class="no">Pod</span><span class="o">::</span><span class="no">Podfile</span><span class="o">::</span><span class="no">DSL</span><span class="o">.</span><span class="n">prebuild_all</span>
<span class="n">local</span> <span class="o">=</span> <span class="kp">false</span>

<span class="n">options</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">last</span>
<span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">[</span><span class="no">Pod</span><span class="o">::</span><span class="no">Prebuild</span><span class="o">.</span><span class="n">keyword</span><span class="o">]</span> <span class="o">!=</span> <span class="kp">nil</span>
    <span class="n">should_prebuild</span> <span class="o">=</span> <span class="n">options</span><span class="o">[</span><span class="no">Pod</span><span class="o">::</span><span class="no">Prebuild</span><span class="o">.</span><span class="n">keyword</span><span class="o">]</span>
    <span class="n">local</span> <span class="o">=</span> <span class="p">(</span><span class="n">options</span><span class="o">[</span><span class="ss">:path</span><span class="o">]</span> <span class="o">!=</span> <span class="kp">nil</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">should_prebuild</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">local</span><span class="p">)</span>
    <span class="n">old_method</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p>æ£€æŸ¥æ€»å¼€å…³ <code>prebuild_all</code> å¯¹åº”çš„æ˜¯ <code>all_binary!</code> çš„å£°æ˜ã€‚</p>
</li>
<li>
<p>æ£€æŸ¥ <code>pod</code> æ–¹æ³•ä¸­æ˜¯å¦å­˜åœ¨å¯é€‰å‚æ•° <code>:binary</code>ï¼Œå¹¶æ›´æ–° <code>should_prebuild</code></p>
</li>
<li>
<p>åªæœ‰ <code>should_prebuild</code> ä¸º true çš„ pod æ–¹æ³•æ‰ä¼šèµ°åŸæœ‰é€»è¾‘ï¼Œfalse çš„ä¼šè¢«å¿½ç•¥</p>
</li>
</ol>
<p>ä½œè€…é€šè¿‡è¿™æ ·çš„é…åˆå®Œæˆäº†ä¸€é”® <code>all_binary!</code> å’Œå•ä¸ª <code>:binary</code> çš„ä¸ªæ€§åŒ–è®¾ç½®ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/8157560cly1gfm7kp2ee5j20ln0dqabf.jpg" alt="enable_prebuild_patch.png"></p>
<h3 id="force_disable_integration">force_disable_integration</h3>
<blockquote>
<p>a force disable option for integral</p>
</blockquote>
<p>æ­£å¸¸ CocoaPods å®‰è£…åä¼šæ‰§è¡Œ <a href="https://www.rubydoc.info/github/CocoaPods/CocoaPods/Pod%2FInstaller:integrate_user_project">integrate_user_project</a> æ•´åˆç”¨æˆ·çš„ projectï¼š</p>
<ul>
<li>åˆ›å»º xcode çš„ workspace, å¹¶æ•´åˆæ‰€æœ‰çš„ target åˆ°æ–°çš„ workspace ä¸­</li>
<li>æŠ›å‡º Podfile ç©ºé¡¹ç›®ä¾èµ–å’Œ xcconfig æ˜¯å¦è¢«åŸæœ‰çš„ xcconfig æ‰€è¦†ç›–ä¾èµ–ç›¸å…³çš„è­¦å‘Šã€‚</li>
</ul>
<p>è¿™é‡Œ é€šè¿‡ force_disable_integration æ‹¦æˆªåå¼ºåˆ¶è·³è¿‡åˆæˆè¿™ä¸€æ­¥ã€‚</p>
<h3 id="disable_install_complete_message">disable_install_complete_message</h3>
<blockquote>
<p>a option to disable install complete message</p>
</blockquote>
<p>install åä¼šæ‰§è¡Œ <a href="https://www.rubydoc.info/github/CocoaPods/CocoaPods/Pod/Installer:print_post_install_message">print_post_install_message</a> æ¥è¾“å‡ºå„ç§æ”¶é›†çš„è­¦å‘Šï¼Œè¿™é‡ŒåŒæ ·ä»¥ hook å¼ºåˆ¶è·³è¿‡ã€‚</p>
<h3 id="force_disable_write_lockfile">force_disable_write_lockfile</h3>
<blockquote>
<p>option to disable write lockfiles</p>
</blockquote>
<p>æ­£å¸¸çš„ pod install ä¼šç”Ÿæˆ <code>podfile.lock</code> æ–‡ä»¶ä»¥ä¿å­˜ä¸Šæ¬¡çš„ Pods ä¾èµ–é…ç½®ã€‚åœ¨é¢„ç¼–è¯‘ä¸­æˆ‘ä»¬é€šè¿‡æ›¿æ¢ <code>lockfile_path</code> å°†é”æ–‡ä»¶ä¿å­˜åˆ°äº† <code>Pods/_Prebuild/Manifest.lock.tmp</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="k">class</span> <span class="nc">Config</span>
    <span class="vc">@@force_disable_write_lockfile</span> <span class="o">=</span> <span class="kp">false</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">force_disable_write_lockfile</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="vc">@@force_disable_write_lockfile</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">end</span>
    
    <span class="n">old_method</span> <span class="o">=</span> <span class="nb">instance_method</span><span class="p">(</span><span class="ss">:lockfile_path</span><span class="p">)</span>
    <span class="n">define_method</span><span class="p">(</span><span class="ss">:lockfile_path</span><span class="p">)</span> <span class="k">do</span> 
        <span class="k">if</span> <span class="vc">@@force_disable_write_lockfile</span>
            <span class="k">return</span> <span class="no">PrebuildSandbox</span><span class="o">.</span><span class="n">from_standard_sanbox_path</span><span class="p">(</span><span class="n">sandbox_root</span><span class="p">)</span><span class="o">.</span><span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;Manifest.lock.tmp&#39;</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="n">old_method</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="p">()</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="http://ww1.sinaimg.cn/large/8157560cly1gfm5t282twj20xb0hqjut.jpg" alt="feature_switch.png"></p>
<h1 id="binary-pod-çš„é¢„ç¼–è¯‘">Binary Pod çš„é¢„ç¼–è¯‘</h1>
<p>cocoapods-binary åœ¨ä¸‹è½½ binary pod æºç å‰ä¼šå…ˆæ£€æŸ¥æ˜¯å¦å·²ç»æœ‰é¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶åŒ…ï¼Œå¦‚æœæ²¡æœ‰ç¼“å­˜æ‰ä¼šå¼€å§‹binary pod çš„ä¸‹è½½å’Œé¢„ç¼–è¯‘ã€‚</p>
<h2 id="é¢„ç¼–è¯‘çš„ç¼“å­˜æŸ¥è¯¢">é¢„ç¼–è¯‘çš„ç¼“å­˜æŸ¥è¯¢</h2>
<p>ç¼“å­˜æŸ¥è¯¢æ–¹æ³•ä¸º <strong>have_exact_prebuild_cache?</strong> ï¼Œæˆ‘ä»¬åœ¨å‰é¢æåˆ°è¿‡ï¼Œæ¥çœ‹å…¶å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="k">def</span> <span class="nf">have_exact_prebuild_cache?</span>
    <span class="k">return</span> <span class="kp">false</span> <span class="k">if</span> <span class="n">local_manifest</span> <span class="o">==</span> <span class="kp">nil</span> <span class="c1"># step 1</span>
    <span class="c1"># step 2</span>
    <span class="n">changes</span> <span class="o">=</span> <span class="n">prebuild_pods_changes</span>
    <span class="n">added</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">added</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">changed</span> 
    <span class="n">unchanged</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">unchanged</span>
    <span class="n">deleted</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">deleted</span> 
    
    <span class="n">exsited_framework_pod_names</span> <span class="o">=</span> <span class="n">sandbox</span><span class="o">.</span><span class="n">exsited_framework_pod_names</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">unchanged</span><span class="o">.</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">pod_name</span><span class="o">|</span>
        <span class="ow">not</span> <span class="n">exsited_framework_pod_names</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">pod_name</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">needed</span> <span class="o">=</span> <span class="p">(</span><span class="n">added</span> <span class="o">+</span> <span class="n">changed</span> <span class="o">+</span> <span class="n">deleted</span> <span class="o">+</span> <span class="n">missing</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">needed</span><span class="o">.</span><span class="n">empty?</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>æ£€æŸ¥ <code>PrebuildSandbox</code> ä¸‹æ˜¯å¦å­˜åœ¨ <code>Manifest.lock</code> æ–‡ä»¶ï¼Œæ²¡æœ‰åˆ™è¯´æ˜æ²¡æœ‰æˆåŠŸæ‰§è¡Œè¿‡ binary pod å®‰è£…è¿‡ä¹Ÿå°±ä¸ä¼šæœ‰ç¼“å­˜ï¼Œå¯ä»¥ç›´æ¥ return false</li>
<li>æ‰§è¡Œ <code>prebuild_pods_changes</code> è·å– pod å˜æ›´</li>
<li>æ‰§è¡Œ <code>exsited_framework_pod_names</code> æŸ¥çœ‹æ˜¯å¦æœ‰é¢„ç¼–è¯‘è¿‡çš„ framework</li>
<li>ç»“åˆå‰ä¸¤æ­¥çš„ç»“æœåˆ¤æ–­æ˜¯å¦å­˜åœ¨ç¼“å­˜</li>
</ol>
<h3 id="é¢„ç¼–è¯‘çš„-mainfest-æ£€æŸ¥">é¢„ç¼–è¯‘çš„ mainfest æ£€æŸ¥</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="k">def</span> <span class="nf">local_manifest</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="vi">@local_manifest_inited</span>
        <span class="vi">@local_manifest_inited</span> <span class="o">=</span> <span class="kp">true</span>
        <span class="k">raise</span> <span class="s2">&#34;This method should be call before generate project&#34;</span> <span class="k">unless</span> <span class="nb">self</span><span class="o">.</span><span class="n">analysis_result</span> <span class="o">==</span> <span class="kp">nil</span>
        <span class="vi">@local_manifest</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">sandbox</span><span class="o">.</span><span class="n">manifest</span>
    <span class="k">end</span>
    <span class="vi">@local_manifest</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>local_manifest å…¶å®æ˜¯ ruby çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½œç”¨ä¸Šé¢ä»‹ç»è¿‡ï¼Œé‚£ Manifest.lock æ–‡ä»¶åˆæ˜¯å•¥ï¼Ÿè¯¦ç»†ï¼š<a href="https://www.objc.io/issues/6-build-tools/cocoapods-under-the-hood/">objc.io</a></p>
<blockquote>
<p>This is a copy of the <code>Podfile.lock</code> that gets created every time you run <code>pod install</code>. If youâ€™ve ever seen the error <code>The sandbox is not in sync with the Podfile.lock</code>, itâ€™s because this file is no longer the same as the <code>Podfile.lock</code>.</p>
</blockquote>
<p>ç”±äº <code>Pods</code> ç›®å½•å¹¶ä¸ä¸€å®šä¼šæ·»åŠ åˆ°é¡¹ç›®çš„ version control ä¸­ï¼Œæ‰€ä»¥åˆ©ç”¨ <code>Mainfest.lock</code> æ¥ç¡®ä¿å·¥ç¨‹å¸ˆåœ¨è¿è¡Œé¡¹ç›®å‰èƒ½å¤Ÿå‡†ç¡®æ›´æ–°å¯¹åº”çš„ podã€‚å¦åˆ™ä¼šå¯¼è‡´ build å¤±è´¥ç­‰å„ç§é—®é¢˜ã€‚</p>
<h3 id="é¢„ç¼–è¯‘çš„-pods-å˜æ›´æ£€æŸ¥">é¢„ç¼–è¯‘çš„ pods å˜æ›´æ£€æŸ¥</h3>
<p>æ¥ç€é€šè¿‡ <code>prebuild_pods_changes</code> æ£€æŸ¥æ˜¯å¦æœ‰éœ€è¦æ›´æ–°çš„ podï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="k">def</span> <span class="nf">prebuild_pods_changes</span>
    <span class="k">return</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">local_manifest</span><span class="o">.</span><span class="n">nil?</span>
    <span class="k">if</span> <span class="vi">@prebuild_pods_changes</span><span class="o">.</span><span class="n">nil?</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="n">local_manifest</span><span class="o">.</span><span class="n">detect_changes_with_podfile</span><span class="p">(</span><span class="n">podfile</span><span class="p">)</span>
        <span class="vi">@prebuild_pods_changes</span> <span class="o">=</span> <span class="no">Analyzer</span><span class="o">::</span><span class="no">SpecsState</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">changes</span><span class="p">)</span>
        <span class="c1"># save the chagnes info for later stage</span>
        <span class="no">Pod</span><span class="o">::</span><span class="no">Prebuild</span><span class="o">::</span><span class="no">Passer</span><span class="o">.</span><span class="n">prebuild_pods_changes</span> <span class="o">=</span> <span class="vi">@prebuild_pods_changes</span> 
    <span class="k">end</span>
    <span class="vi">@prebuild_pods_changes</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>æ–¹æ³•ç¬¬ä¸€è¡Œä¹Ÿæ£€æŸ¥äº† <code>local_manifest</code> æ˜¯å› ä¸ºä¼šè¢«å¤šå¤„è°ƒç”¨ï¼Œæ‰€æœ‰è¿™é‡Œä¹Ÿæ·»åŠ äº†åˆ¤æ–­ã€‚æ ¸å¿ƒæ˜¯ä¾èµ– cocoapods-core çš„ <a href="https://www.Rubydoc.info/gems/cocoapods-core/Pod%2FLockfile:detect_changes_with_podfile">detect_changes_with_podfile</a> æ¥è·å–éœ€è¦æ›´æ–°çš„ podsï¼Œå…¶æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Analyzes the <a href="https://www.Rubydoc.info/gems/cocoapods-core/Pod/Lockfile">Pod::Lockfile</a> and detects any changes applied to the <a href="https://www.Rubydoc.info/gems/cocoapods-core/Pod/Podfile">Podfile</a> since the last installation.</p>
</blockquote>
<p>å®ƒå¯¹äºæ¯ä¸ª pod ä¼šæ£€æŸ¥å¦‚ä¸‹å‡ ä¸ªçŠ¶æ€ï¼š</p>
<ul>
<li>added: Pods that weren&rsquo;t present in the Podfile.</li>
<li>changed: Pods that were present in the Podfile but changed:
<ul>
<li>Pods whose version is not compatible anymore with Podfile,</li>
<li>Pods that changed their external options.</li>
</ul>
</li>
<li>removed: Pods that were removed form the Podfile.</li>
<li>unchanged: Pods that are still compatible with Podfile.</li>
</ul>
<p>æœ€åä» <code>unchanged</code> ä¸­æŸ¥æ‰¾ <code>exsited_framework_pod_names</code> æ¥åˆ¤æ–­æ˜¯å¦æœ‰å·²é¢„ç¼–è¯‘è¿‡çš„ frameworkã€‚</p>
<h3 id="é¢„ç¼–è¯‘çš„-framework-ç¼“å­˜æ£€æŸ¥">é¢„ç¼–è¯‘çš„ framework ç¼“å­˜æ£€æŸ¥</h3>
<p>é¢„ç¼–è¯‘çš„ framework æ£€æŸ¥å³ <code> exsited_framework_pod_names</code> ä» <code>exsited_framework_name_pairs</code> ä¸­ map è¿‡æ¥çš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="k">def</span> <span class="nf">exsited_framework_pod_names</span>
    <span class="n">exsited_framework_name_pairs</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">pair</span><span class="o">|</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">}</span><span class="o">.</span><span class="n">uniq</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>exsited_framework_name_pairs</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="k">def</span> <span class="nf">pod_name_for_target_folder</span><span class="p">(</span><span class="n">target_folder_path</span><span class="p">)</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="no">Pathname</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">target_folder_path</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">find</span> <span class="k">do</span> <span class="o">|</span><span class="n">child</span><span class="o">|</span>
        <span class="n">child</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">end_with?</span> <span class="s2">&#34;.pod_name&#34;</span>
    <span class="k">end</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="nb">name</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="s2">&#34;.pod_name&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span> <span class="k">unless</span> <span class="nb">name</span><span class="o">.</span><span class="n">nil?</span>
    <span class="nb">name</span> <span class="o">||=</span> <span class="no">Pathname</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">target_folder_path</span><span class="p">)</span><span class="o">.</span><span class="n">basename</span><span class="o">.</span><span class="n">to_s</span> <span class="c1"># for compatibility with older version</span>
<span class="k">end</span>

<span class="c1"># Array&lt;[target_name, pod_name]&gt;</span>
<span class="k">def</span> <span class="nf">exsited_framework_name_pairs</span>
    <span class="k">return</span> <span class="o">[]</span> <span class="k">unless</span> <span class="n">generate_framework_path</span><span class="o">.</span><span class="n">exist?</span>
    <span class="n">generate_framework_path</span><span class="o">.</span><span class="n">children</span><span class="p">()</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">framework_path</span><span class="o">|</span>
        <span class="k">if</span> <span class="n">framework_path</span><span class="o">.</span><span class="n">directory?</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="ow">not</span> <span class="n">framework_path</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">empty?</span><span class="p">)</span>
            <span class="o">[</span><span class="n">framework_path</span><span class="o">.</span><span class="n">basename</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span>  <span class="n">pod_name_for_target_folder</span><span class="p">(</span><span class="n">framework_path</span><span class="p">)</span><span class="o">]</span>
        <span class="k">else</span>
            <span class="kp">nil</span>
        <span class="k">end</span>
    <span class="k">end</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:nil?</span><span class="p">)</span><span class="o">.</span><span class="n">uniq</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>è¯¥æ–¹æ³•è™½ç„¶é€»è¾‘ç®€å•ï¼Œå´æ˜¯æ¯”è¾ƒæ ¸å¿ƒçš„é€»è¾‘ä¹‹ä¸€ã€‚</p>
<p>å®ƒæœ€ç»ˆè°ƒç”¨ <code>pod_name_for_target_folder</code> æ¥æ£€æŸ¥ <code>Pods/_Prebuild/GeneratedFrameworks</code> ç›®å½•ä¸‹å¯¹åº”çš„ framework ä¸­æ˜¯å¦å­˜åœ¨ä»¥ <strong>.pod_name</strong> ä¸ºç»“å°¾çš„æ–‡ä»¶ï¼Œæ¥æ ‡ç¤ºè¯¥ framework æ˜¯å¦å®Œæˆäº†é¢„ç¼–è¯‘ã€‚å®ƒå°±æ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶è€Œå·²ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/8157560cly1gfmci591ncj20np0g3q53.jpg" alt="exact_prebuild_cache.png"></p>
<h2 id="target-ç¼–è¯‘">Target ç¼–è¯‘</h2>
<p>é€šè¿‡ <code>pre_install</code> ä¸‹è½½å®Œ pods åå°±è¦å¼€å§‹ç¼–è¯‘å•¦ï¼Œå…¥å£å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="n">old_method2</span> <span class="o">=</span> <span class="nb">instance_method</span><span class="p">(</span><span class="ss">:run_plugins_post_install_hooks</span><span class="p">)</span>
<span class="n">define_method</span><span class="p">(</span><span class="ss">:run_plugins_post_install_hooks</span><span class="p">)</span> <span class="k">do</span> 
    <span class="n">old_method2</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="p">()</span>
    <span class="k">if</span> <span class="no">Pod</span><span class="o">::</span><span class="n">is_prebuild_stage</span>
        <span class="nb">self</span><span class="o">.</span><span class="n">prebuild_frameworks!</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸ºäº†ä¿è¯ <code>prebuild_frameworks!</code> æ˜¯åœ¨æœ€åä¸€æ­¥æ‰§è¡Œï¼Œä½œè€…å¹¶æœªé€šè¿‡ <code>HooksManager</code> æ¥æ·»åŠ  plugins çš„ <code>post_install</code> è€Œæ˜¯ç›´æ¥ <strong>Override</strong> äº†å®ƒçš„è°ƒç”¨æ–¹æ³•ã€‚</p>
<p>å…³äº install hooksï¼ŒCocoaPods æä¾›äº†ä¸¤ç§ç±»å‹ï¼šPodfile hook å’Œ plugin hookã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/8157560cly1gfnfd0b99ij210r0hqtbm.jpg" alt="hooks.png"></p>
<p>æ’ä»¶çš„ hooks æ“ä½œéƒ½æ˜¯é€šè¿‡ <code>HooksManager</code> æ¥å®Œæˆè°ƒç”¨çš„ï¼Œpodfile ä¸­æä¾›çš„ hooks åˆ™æ˜¯å•ç‹¬çš„æ–¹æ³•æ‰§è¡Œæ—¶æœºä¹Ÿæ˜¯å„æœ‰ä¸åŒã€‚</p>
<h3 id="prebuild_frameworks">prebuild_frameworks!</h3>
<p>æ–¹æ³•æ¯”è¾ƒé•¿å°±ä¸è´´å®Œæ•´çš„ä»£ç äº†ï¼Œæ¦‚æ‹¬å¦‚ä¸‹ï¼š</p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šè·å–å¾…æ›´æ–°çš„ targets</strong></p>
<p>targets çš„è·å–é€»è¾‘åŒé¢„ç¼–è¯‘ç¼“å­˜æ£€æŸ¥ä¸­çš„ <strong>needed</strong> çš„è·å–æœ‰äº›ç±»ä¼¼ã€‚</p>
<ol>
<li>é€šè¿‡ <code>prebuild_pods_changes</code> å’Œ <code>exsited_framework_pod_names</code> å¾—åˆ° <code>root_names_to_update</code></li>
<li>æ¥ç€ç”¨ <code>fast_get_targets_for_pod_name</code> æ‰¾å‡ºå¯¹åº”çš„ taregets</li>
<li>è°ƒç”¨ <code>recursive_dependent_targets</code> å°† targets çš„ä¾èµ– map å‡ºæ¥ï¼Œåˆå¹¶åˆ° targets ä¸­å¹¶å»é‡å¤</li>
<li>è¿‡æ»¤æ‰å·²é¢„ç¼–è¯‘è¿‡çš„ targets ä»¥åŠè¢«æ ‡è®°ä¸º  <code>:binary =&gt; false</code> çš„ targetã€‚</li>
</ol>
<p>æ³¨æ„ï¼Œå¦‚æœ pod target åŸæœ¬å°±æ˜¯ä»¥  <code>.a + .h</code>  å½¢å¼å­˜åœ¨çš„äºŒè¿›åˆ¶åŒ…ï¼Œåˆ™ä¼šè¢«ç›´æ¥è¿‡æ»¤æ‰ã€‚</p>
<p><strong>ç¬¬äºŒæ­¥ï¼šå®Œæˆ pod target çš„ç¼–è¯‘ã€ä¿å­˜èµ„æºæ–‡ä»¶ã€å†™å…¥ä»¥ <code>.pod_name</code> ä¸ºç»“å°¾çš„æ ‡è®°æ–‡ä»¶ã€‚</strong></p>
<p>æ ¸å¿ƒé€»è¾‘æ˜¯é€šè¿‡ <code>xcodebuild</code> å‘½ä»¤æ¥å®Œæˆç¼–è¯‘æ‰“åŒ…ï¼Œæœ€åå°†ç”Ÿæˆçš„äºŒè¿›åˆ¶åŒ…å’Œ dSYM è¾“å‡ºåˆ° <code>GeneratedFrameworks</code> ç›®å½•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äº iOS å¹³å°ç”Ÿæˆçš„äºŒè¿›åˆ¶åŒ…åŒæ—¶åŒ…å«äº†æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåˆ†åˆ«æ‰“åŒ…åå†é€šè¿‡ <code>libo</code> åˆå¹¶æˆä¸€ä»½ <strong>Fat Binary</strong> çš„ã€‚</p>
<p>å®Œæ•´çš„æ„å»ºä»£ç åœ¨ <a href="https://github.com/leavez/cocoapods-binary/blob/master/lib/cocoapods-binary/rome/build_framework.rb">build_framework.rb</a> ä¸­è¿™é‡Œä¹Ÿä¸ä½œå±•å¼€ï¼Œå°±è¡¥å……ä¸¤ç‚¹ï¼š</p>
<ol>
<li>å¯¹äº static framework éœ€è¦åœ¨ç¼–è¯‘åï¼Œæ‰‹åŠ¨å°†ç›¸å…³èµ„æº copy å›æ¥ã€‚å› æ­¤ï¼Œéœ€è¦å…ˆå°†å¯¹åº”è·¯å¾„ä¿å­˜ã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="n">path_objects</span> <span class="o">=</span> <span class="n">resources</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
    <span class="n">object</span> <span class="o">=</span> <span class="no">Prebuild</span><span class="o">::</span><span class="no">Passer</span><span class="o">::</span><span class="no">ResourcePath</span><span class="o">.</span><span class="n">new</span>
    <span class="n">object</span><span class="o">.</span><span class="n">real_file_path</span> <span class="o">=</span> <span class="n">framework_path</span> <span class="o">+</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">object</span><span class="o">.</span><span class="n">target_file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;${PODS_ROOT}&#39;</span><span class="p">,</span> <span class="n">standard_sandbox_path</span><span class="o">.</span><span class="n">to_s</span><span class="p">)</span> <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">start_with?</span> <span class="s1">&#39;${PODS_ROOT}&#39;</span>
    <span class="n">object</span><span class="o">.</span><span class="n">target_file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&#34;${PODS_CONFIGURATION_BUILD_DIR}&#34;</span><span class="p">,</span> <span class="n">standard_sandbox_path</span><span class="o">.</span><span class="n">to_s</span><span class="p">)</span> <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">start_with?</span> <span class="s2">&#34;${PODS_CONFIGURATION_BUILD_DIR}&#34;</span>
    <span class="n">object</span>
<span class="k">end</span>
<span class="no">Prebuild</span><span class="o">::</span><span class="no">Passer</span><span class="o">.</span><span class="n">resources_to_copy_for_static_framework</span><span class="o">[</span><span class="n">target</span><span class="o">.</span><span class="n">name</span><span class="o">]</span> <span class="o">=</span> <span class="n">path_objects</span>
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>å¦‚æœ pod ä¸­åŒ…å«äº† <strong>vendored library</strong> å’Œ <strong>vendered framework</strong> ä¹Ÿä¼šåœ¨ build å copy å›æ¥ã€‚</li>
</ol>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šæ¸…ç†æ— ç”¨æ–‡ä»¶å’Œ pods</strong></p>
<p>æ³¨æ„ï¼install å®Œæˆåä»…ä¿å­˜ <code>PrebuildSandbox</code> ä¸‹çš„ <code>Manifest.lock</code> ä»¥åŠ <code>GeneratedFrameworks</code> ç›®å½•ä¸‹çš„ frameworkï¼Œè€Œä¸‹è½½è‡³ <code>_Prebuild</code> ç›®å½•ä¸‹çš„æºç éƒ½ä¼šè¢«æ¸…ç†ã€‚</p>
<h1 id="binary-pod-çš„é›†æˆ">Binary Pod çš„é›†æˆ</h1>
<p>æœ€åé›†æˆå·¥ä½œæ˜¯åœ¨æ™®é€šçš„ pod install æ¨¡å¼ä¸‹ï¼ŒåŒæ ·é€šè¿‡ <strong>Ruby Method Swizzling ä¸‰éƒ¨æ›²</strong> æ¥æ‹¦æˆªçš„ã€‚</p>
<h2 id="resolve-dependencies">resolve dependencies</h2>
<p>resolve_dependencies åœ¨ cocoapods ä¸­æ˜¯é€šè¿‡åˆ›å»º <code>Analyzer</code> æ¥åˆ†æ podfile çš„ dependenciesã€‚</p>
<p>è¿™é‡Œ hook åä¸»è¦ç”¨äºæ¸…ç†å¹¶ä¿®æ”¹ prebuild specs ä¸­å¯¹åº”çš„æ•°æ®ã€‚</p>
<ol>
<li>åˆ é™¤ prebuild framework æ—¶ä¸‹è½½çš„ source code å’Œç”Ÿæˆçš„ target support filesï¼›</li>
<li>å°† prebuild spec ä¸­çš„ source_files çš„é…ç½®å…¨éƒ¨ç½®ç©ºï¼Œç„¶åç”¨ prebuild åçš„ framework ä½œä¸º vender framework æ›¿ä»£ï¼›</li>
<li>æ¸…é™¤ prebuild spec ä¸­çš„ resource_bundlesï¼›</li>
</ol>
<p>ç®€åŒ–åé€»è¾‘å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="n">old_method2</span> <span class="o">=</span> <span class="nb">instance_method</span><span class="p">(</span><span class="ss">:resolve_dependencies</span><span class="p">)</span>
<span class="n">define_method</span><span class="p">(</span><span class="ss">:resolve_dependencies</span><span class="p">)</span> <span class="k">do</span>
		
    <span class="nb">self</span><span class="o">.</span><span class="n">remove_target_files_if_needed</span> <span class="c1"># 1</span>
   
    <span class="n">old_method2</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="p">()</span>    
    <span class="nb">self</span><span class="o">.</span><span class="n">validate_every_pod_only_have_one_form</span>

    <span class="n">cache</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="n">specs</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">analysis_result</span><span class="o">.</span><span class="n">specifications</span>
    <span class="n">prebuilt_specs</span> <span class="o">=</span> <span class="p">(</span><span class="n">specs</span><span class="o">.</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">spec</span><span class="o">|</span>
        <span class="nb">self</span><span class="o">.</span><span class="n">prebuild_pod_names</span><span class="o">.</span><span class="n">include?</span> <span class="n">spec</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">name</span>
    <span class="k">end</span><span class="p">)</span>

    <span class="n">prebuilt_specs</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">spec</span><span class="o">|</span>
		  <span class="c1"># 2</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="no">Pod</span><span class="o">.</span><span class="n">fast_get_targets_for_pod_name</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">pod_targets</span><span class="p">,</span> <span class="n">cache</span><span class="p">)</span>
        <span class="n">targets</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">target</span><span class="o">|</span>
            <span class="n">framework_file_path</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">framework_name</span>
            <span class="n">framework_file_path</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="n">framework_file_path</span> <span class="k">if</span> <span class="n">targets</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="n">add_vendered_framework</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span> <span class="n">framework_file_path</span><span class="p">)</span>
        <span class="k">end</span>
        
        <span class="n">empty_source_files</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
			
        <span class="c1"># 3</span>
        <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">attributes_hash</span><span class="o">[</span><span class="s2">&#34;resource_bundles&#34;</span><span class="o">]</span>
            <span class="n">bundle_names</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">attributes_hash</span><span class="o">[</span><span class="s2">&#34;resource_bundles&#34;</span><span class="o">].</span><span class="n">keys</span>
            <span class="n">spec</span><span class="o">.</span><span class="n">attributes_hash</span><span class="o">[</span><span class="s2">&#34;resource_bundles&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="kp">nil</span> 
            <span class="n">spec</span><span class="o">.</span><span class="n">attributes_hash</span><span class="o">[</span><span class="s2">&#34;resources&#34;</span><span class="o">]</span> <span class="o">||=</span> <span class="o">[]</span>
            <span class="n">spec</span><span class="o">.</span><span class="n">attributes_hash</span><span class="o">[</span><span class="s2">&#34;resources&#34;</span><span class="o">]</span> <span class="o">+=</span> <span class="n">bundle_names</span><span class="o">.</span><span class="n">map</span><span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span><span class="o">+</span><span class="s2">&#34;.bundle&#34;</span><span class="p">}</span>
        <span class="k">end</span>

        <span class="c1"># to avoid the warning of missing license</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">attributes_hash</span><span class="o">[</span><span class="s2">&#34;license&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>å…³äºè¿™ä¸‰æ­¥æ“ä½œï¼Œåˆ†åˆ«åšä¸€äº›è§£ç­”ã€‚</p>
<p>ç¬¬ä¸€æ­¥çš„æ¸…ç†å·¥ä½œæ˜¯åœ¨æ‰§è¡ŒåŸæœ‰é€»è¾‘å‰æ‰§è¡Œï¼Œæ˜¯ä¸ºäº†é¿å…ç”Ÿæˆçš„æ—§çš„ targets æ–‡ä»¶è§¦å‘æ–‡ä»¶ä¿®æ”¹çš„è­¦å‘Šã€‚</p>
<p>call original ååˆæ‰§è¡Œäº†ä¸€æ¬¡ <code>validate_every_pod_only_have_one_form</code>ï¼Œè™½ç„¶æ²¡æœ‰å‰¯ä½œç”¨ï¼Œä½†ç›®çš„æ˜¯ä¸ºäº†é¿å…ä¸€äº›å¼‚å¸¸æƒ…å†µä¸‹ï¼ŒæŸäº› pod ä»¥æºç çš„å½¢å¼åˆå‡ºç°åœ¨å…¶ä»– target ä¸­ã€‚</p>
<p><strong>target_checker</strong> ä¸­ä½œè€…æåˆ°è¿‡ cocoapods-binary æœ‰ä¸€ä¸ªé™åˆ¶ï¼š</p>
<blockquote>
<p>ä¸€ä¸ª pod åªèƒ½å…è®¸å¯¹åº”ä¸€ä¸ª targetã€‚</p>
</blockquote>
<p>ç†ç”±å°±æ˜¯æˆ‘ä»¬åœ¨ç¬¬äºŒæ­¥å°†é¢„ç¼–è¯‘åçš„ static framework ä½œä¸º vender framework çš„æ–¹å¼åµŒå…¥åˆ°é¡¹ç›®ä¸­ï¼ŒåŒæ—¶æ¸…ç©ºäº†å…¨éƒ¨ platform ä¸Šçš„ source_files çš„é…ç½®ã€‚</p>
<p>ç¬¬ä¸‰æ­¥å¯¹äº resource bundle target çš„æ¸…ç†ï¼Œæ˜¯ä¸ºäº†é¿å… resource bundle çš„é‡å¤ copyã€‚</p>
<p>å› ä¸º pod install ä¸­ ï¼Œå¦‚æœ podspec æŒ‡å®šäº† <code>resource_bundles</code> ï¼ŒXcode æ˜¯ä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆ bundle target çš„ã€‚è€Œæˆ‘ä»¬åœ¨ static framework ä¸­å·²ç»ç”Ÿæˆå¹¶ copy äº†ï¼Œæ‰€ä»¥é¿å…é‡å¤éœ€è¦æ¸…é™¤ä¸€ä¸‹ã€‚</p>
<h2 id="download-dependencies">download dependencies</h2>
<p>è¿™ä¸€æ­¥æ˜¯ hook äº† <code>download_dependencies</code> æ‰§è¡Œä¸­ä¼šè§¦å‘çš„ä¸€ä¸ªæ–¹æ³•ï¼š<code>install_source_of_pod</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="n">old_method</span> <span class="o">=</span> <span class="nb">instance_method</span><span class="p">(</span><span class="ss">:install_source_of_pod</span><span class="p">)</span>
<span class="n">define_method</span><span class="p">(</span><span class="ss">:install_source_of_pod</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">pod_name</span><span class="o">|</span>

    <span class="c1"># original logic ...</span>
    <span class="k">if</span> <span class="nb">self</span><span class="o">.</span><span class="n">prebuild_pod_names</span><span class="o">.</span><span class="n">include?</span> <span class="n">pod_name</span>
        <span class="n">pod_installer</span><span class="o">.</span><span class="n">install_for_prebuild!</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">sandbox</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="n">pod_installer</span><span class="o">.</span><span class="n">install!</span>
    <span class="k">end</span>
    <span class="c1"># original logic ...</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„ç›®çš„æ˜¯ä¸ºè·³è¿‡ binary pod çš„ä¸‹è½½ï¼Œä»¥åŠå®Œæˆ symbol link çš„æ“ä½œã€‚ç®€åŒ–é€»è¾‘å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="k">def</span> <span class="nf">install_for_prebuild!</span><span class="p">(</span><span class="n">standard_sanbox</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">if</span> <span class="n">standard_sanbox</span><span class="o">.</span><span class="n">local?</span> <span class="nb">self</span><span class="o">.</span><span class="n">name</span>

    <span class="n">prebuild_sandbox</span> <span class="o">=</span> <span class="no">Pod</span><span class="o">::</span><span class="no">PrebuildSandbox</span><span class="o">.</span><span class="n">from_standard_sandbox</span><span class="p">(</span><span class="n">standard_sanbox</span><span class="p">)</span>
    <span class="n">target_names</span> <span class="o">=</span> <span class="n">prebuild_sandbox</span><span class="o">.</span><span class="n">existed_target_names_for_pod_name</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    
    <span class="n">target_names</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>

        <span class="n">real_file_folder</span> <span class="o">=</span> <span class="n">prebuild_sandbox</span><span class="o">.</span><span class="n">framework_folder_path_for_target_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
                
        <span class="n">target_folder</span> <span class="o">=</span> <span class="n">standard_sanbox</span><span class="o">.</span><span class="n">pod_dir</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target_names</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span> 
            <span class="n">target_folder</span> <span class="o">+=</span> <span class="n">real_file_folder</span><span class="o">.</span><span class="n">basename</span>
        <span class="k">end</span>
        <span class="n">target_folder</span><span class="o">.</span><span class="n">rmtree</span> <span class="k">if</span> <span class="n">target_folder</span><span class="o">.</span><span class="n">exist?</span>
        <span class="n">target_folder</span><span class="o">.</span><span class="n">mkpath</span>


        <span class="n">walk</span><span class="p">(</span><span class="n">real_file_folder</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">child</span><span class="o">|</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">child</span>
            <span class="c1"># only make symlink to file and `.framework` folder</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">directory?</span> <span class="ow">and</span> <span class="o">[</span><span class="s2">&#34;.framework&#34;</span><span class="p">,</span> <span class="s2">&#34;.dSYM&#34;</span><span class="o">].</span><span class="n">include?</span> <span class="n">child</span><span class="o">.</span><span class="n">extname</span>
                <span class="n">mirror_with_symlink</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">real_file_folder</span><span class="p">,</span> <span class="n">target_folder</span><span class="p">)</span>
                <span class="k">next</span> <span class="kp">false</span>  <span class="c1"># return false means don&#39;t go deeper</span>
            <span class="k">elsif</span> <span class="n">child</span><span class="o">.</span><span class="n">file?</span>
                <span class="n">mirror_with_symlink</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">real_file_folder</span><span class="p">,</span> <span class="n">target_folder</span><span class="p">)</span>
                <span class="k">next</span> <span class="kp">true</span>
            <span class="k">else</span>
                <span class="k">next</span> <span class="kp">true</span>
            <span class="k">end</span>
        <span class="k">end</span>

        <span class="c1"># symbol link copy resource for static framework</span>
        <span class="nb">hash</span> <span class="o">=</span> <span class="no">Prebuild</span><span class="o">::</span><span class="no">Passer</span><span class="o">.</span><span class="n">resources_to_copy_for_static_framework</span> <span class="o">||</span> <span class="p">{}</span>
        
        <span class="n">path_objects</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">[</span><span class="nb">name</span><span class="o">]</span>
        <span class="k">if</span> <span class="n">path_objects</span> <span class="o">!=</span> <span class="kp">nil</span>
            <span class="n">path_objects</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">object</span><span class="o">|</span>
                <span class="n">make_link</span><span class="p">(</span><span class="n">object</span><span class="o">.</span><span class="n">real_file_path</span><span class="p">,</span> <span class="n">object</span><span class="o">.</span><span class="n">target_file_path</span><span class="p">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span> <span class="c1"># of for each </span>
<span class="k">end</span> <span class="c1"># of method</span>
</code></pre></td></tr></table>
</div>
</div><p>æ ¸å¿ƒæ˜¯ <strong>walk</strong> æ–¹æ³•ï¼Œå®ƒéå†æ¯ä¸ª static framework ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œ <code>.framework</code> æ–‡ä»¶å¤¹ï¼Œå°†å…¶ä½œä¸º <code>Pods</code> ç›®å½•ä¸‹å¯¹åº”æ–‡ä»¶çš„å¼•ç”¨ã€‚</p>
<h2 id="embedframeworksscript">EmbedFrameworksScript</h2>
<p>è¿™ä¸€æ­¥æ˜¯ä¸ºäº†è§£å†³ symbol link åï¼Œå¯¹äº embeded framework ä¸­äº§ç”Ÿçš„é—®é¢˜ã€‚<code>embedded framework</code> æ˜¯è‹¹æœåœ¨ iOS 8 åæå‡ºçš„ä»£ç å…±äº«æ–¹æ¡ˆï¼Œä¸ºäº†è§£å†³å®¿ä¸» App å’Œ Extensions çš„ä»£ç å…±ç”¨è€Œäº§ç”Ÿçš„ã€‚è¯¦ç»† <a href="https://medium.com/hootsuite-engineering/an-introduction-to-creating-and-distributing-embedded-frameworks-in-ios-367b7a45a304">medium</a> æ–‡ç« ï¼›</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Ruby" data-lang="Ruby"><span class="n">old_method</span> <span class="o">=</span> <span class="nb">instance_method</span><span class="p">(</span><span class="ss">:script</span><span class="p">)</span>
<span class="n">define_method</span><span class="p">(</span><span class="ss">:script</span><span class="p">)</span> <span class="k">do</span>

    <span class="n">script</span> <span class="o">=</span> <span class="n">old_method</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="p">()</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="s">&lt;&lt;-SH.strip_heredoc
</span><span class="s"></span>        <span class="c1">#!/bin/sh</span>
        <span class="n">old_read_link</span><span class="o">=</span><span class="sb">`which readlink`</span>
        <span class="n">readlink</span> <span class="p">()</span> <span class="p">{</span>
            <span class="n">path</span><span class="o">=</span><span class="sb">`$old_read_link $1`</span><span class="p">;</span>
            <span class="k">if</span> <span class="o">[</span> <span class="err">$</span><span class="p">(</span><span class="n">echo</span> <span class="s2">&#34;$path&#34;</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">c</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                <span class="n">echo</span> <span class="vg">$path</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="n">echo</span> <span class="s2">&#34;`dirname $1`/$path&#34;</span><span class="p">;</span>
            <span class="n">fi</span>
        <span class="p">}</span>
    <span class="no">SH</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">gsub</span> <span class="s2">&#34;rsync --delete&#34;</span><span class="p">,</span> <span class="s2">&#34;rsync --copy-links --delete&#34;</span>    
    <span class="n">patch</span> <span class="o">+</span> <span class="n">script</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>ä¸Šä¸€æ­¥ä¸­æŠŠ pod target æ–‡ä»¶å¤¹ä¸­çš„ framework æ–‡ä»¶æ”¹æˆäº†ç›¸å¯¹è·¯å¾„çš„ symblinkï¼Œè€Œ EmbedFrameworksScript æ˜¯é€šè¿‡ <code>readlink</code> çš„æ–¹å¼æ¥è¯»å–è·¯å¾„ï¼Œå®ƒå¯¹ç›¸å¯¹è·¯å¾„çš„å¤„ç†ä¸å¤ªå¥½ï¼Œè¿™é‡Œéœ€è¦é‡å†™ã€‚</p>
<p>é‡å†™å…¶å®å°±æ˜¯åœ¨æŠŠç›¸å¯¹è·¯å¾„æ”¹ä¸ºç»å¯¹è·¯å¾„ã€‚</p>
<h2 id="æµç¨‹å›¾">æµç¨‹å›¾</h2>
<p>æœ€åè´´ä¸€ä¸‹ï¼Œæ¢³ç†çš„æµç¨‹å›¾ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/21/16f28fe79cec4bae?w=3891&amp;h=2218&amp;f=png&amp;s=435060" alt=""></p>
<h2 id="ç»“æœå¯¹æ¯”">ç»“æœå¯¹æ¯”</h2>
<p>åŸºæœ¬çš„æ¨¡å—ä»‹ç»å®Œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå¼•å…¥ cocoapods-binary æ’ä»¶å Pods çš„æ–‡ä»¶æ„æˆï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/21/16f28fe274deb12a?w=1218&amp;h=113&amp;f=png&amp;s=42173" alt=""></p>
<p>_Prebuild ç›®å½•ä¸‹åˆ™å®Œæ•´ä¿å­˜äº†ä¸€ä»½ Pods æºä»£ç ï¼ŒåŒæ—¶å¤šå‡ºæ¥çš„ GeneratedFrameworks åˆ™ç¼“å­˜äº†é¢„ç¼–è¯‘åçš„ binary æ–‡ä»¶ä»¥åŠ dSYM ç¬¦å·è¡¨ã€‚åœ¨æœ€åçš„ integration é˜¶æ®µ symbol link æ›¿æ¢å®Œåæºç åˆ™ä¼šè¢«åˆ é™¤åŒæ—¶æŒ‡å‘binaryã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/21/16f28fe4bebba8af?w=805&amp;h=102&amp;f=png&amp;s=26338" alt=""></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ä½¿ç”¨è¿‡ç¨‹ä¸­è¿™ä¸ªæ–¹æ¡ˆè¿˜æ˜¯æœ‰å¾ˆå¤šé™åˆ¶çš„ï¼š</p>
<ul>
<li>ç”±äº CocoaPods åœ¨ 1.7 ä»¥ä¸Šç‰ˆæœ¬ä¿®æ”¹äº† framework ç”Ÿæˆé€»è¾‘ï¼Œä¸ä¼šæŠŠ bundle copy è‡³ frameworkï¼Œå› æ­¤éœ€è¦å°† Pod ç¯å¢ƒå›ºå®šåˆ° 1.6.2ï¼›</li>
<li>pod è¦æ”¯æŒ binaryï¼Œheader ref éœ€è¦å˜æ›´ä¸º <code>#import &lt;&gt;</code> æˆ–è€… <code>@import</code> ä»¥ç¬¦åˆ moduler æ ‡å‡†ï¼›</li>
<li>éœ€è¦ç»Ÿä¸€å¼€å‘ç¯å¢ƒã€‚å¦‚æœé¡¹ç›®æ”¯æŒ Swiftï¼Œä¸åŒ compiler ç¼–è¯‘äº§ç‰©æœ‰ Swift ç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼›</li>
<li>æœ€ç»ˆçš„ binary ä½“ç§¯æ¯”ä½¿ç”¨æºç çš„æ—¶å€™å¤§ä¸€ç‚¹ï¼Œä¸å»ºè®®æœ€ç»ˆä¸Šä¼  Storeï¼›</li>
<li>å»ºè®® ignore Pods æ–‡ä»¶å¤¹ï¼Œå¦åˆ™åœ¨ source code ä¸ binary åˆ‡æ¢è¿‡ç¨‹ä¼šæœ‰å¤§é‡ changeï¼Œå¢åŠ  git è´Ÿæ‹…ï¼›</li>
<li>å¦‚æœéœ€è¦ debug å°±éœ€è¦åˆ‡æ¢å›æºç ï¼Œæˆ–è€…é€šè¿‡ dSYM æ˜ å°„æ¥å®Œæˆæ–¹æ³•å¯¹å®šä½ã€‚</li>
</ul>
<p>æ•´ä½“æ„Ÿè§‰æ˜¯å¾ˆä¸é”™çš„æ€è·¯ï¼Œé€‚ç”¨äºäººæ•°ä¸å¤šçš„ä¸­å°å‹é¡¹ç›®ã€‚ä¸€æ—¦é¡¹ç›®ä¾èµ–åº“è¾ƒå¤šï¼Œå¯èƒ½å°±ä¸å¤ªé€‚ç”¨äº†ï¼Œé™åˆ¶å¤ªå¤šï¼ŒåŒæ—¶å¯¹å¼€å‘çš„è¦æ±‚å’Œç¯å¢ƒçš„ä¸€è‡´æ€§è¦æ±‚æ¯”è¾ƒé«˜ã€‚</p>
<p>å‰æœŸå‡†å¤‡åŸºæœ¬ä»‹ç»å®Œäº†ï¼Œä¸‹ä¸€èŠ‚å°±æ˜¯æ ¸å¿ƒçš„ prebuild é€»è¾‘ã€‚å…ˆä¸Šä¸€å¼ è„‘å›¾è¡¥ä¸€è¡¥ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/21/16f28fd6d97d3ea7?w=2850&amp;h=1490&amp;f=png&amp;s=370440" alt="structure"></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">åœŸåœŸEdmondæœ¨</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2019-12-21
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/cocoapods/">CocoaPods</a>
          <a href="/tags/ios/">iOS</a>
          <a href="/tags/binary/">Binary</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/sourcecode-ios/cocoapods-binary-2/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">å®Œå–„ Cocoapods-Binary æ”¯æŒ ServerÂ ç«¯ç¼“å­˜</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="looseyi/looseyi.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:chun574271939@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/looseyi" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/looseyi" class="iconfont icon-github" title="github"></a>
      <a href="https://www.weibo.com/foreverclp" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.zhihu.com/people/tu-tu-edmondmu" class="iconfont icon-zhihu" title="zhihu"></a>
  <a href="http://looseyi.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019-12-11 - 
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">åœŸåœŸEdmondæœ¨</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-62789092-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
