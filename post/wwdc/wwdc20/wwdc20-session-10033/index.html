<!DOCTYPE html>















<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  
  <title>WWDC20 - Build SwiftUI views for widgets - Aha Edmond</title>

  
  
  <meta name="description" content="WWDC20 Session 10033 - Build SwiftUI views for widgets 本文知识目录 本文属于 WWDC20 中 Widgets 系列的文章。Widgets 是使用 SwiftUI 进行开发的，如果您对 SwiftUI 还不是很了解请翻看 Introduction to SwiftUI。如" />
  <meta name="author" content="土土Edmond木" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://looseyi.github.io/app.min.css" />

  

  
  <link rel="preload" as="image" href="https://looseyi.github.io/theme.png" />

  
  <link rel="preload" as="image" href="https://looseyi.github.io/twitter.svg" />
  
  <link rel="preload" as="image" href="https://looseyi.github.io/github.svg" />
  

  
  <link rel="icon" href="https://looseyi.github.io/favicon.ico" />
  <link rel="apple-touch-icon" href="https://looseyi.github.io/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.82.1" />

  
  
  <link
    rel="alternate"
    type="application/rss&#43;xml"
    href="https://looseyi.github.io/post/wwdc/wwdc20/wwdc20-session-10033/index.xml"
    title="Aha Edmond"
  />
  

  
  
  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-62789092-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
  
  <meta property="og:title" content="WWDC20 - Build SwiftUI views for widgets" />
<meta property="og:description" content="WWDC20 Session 10033 - Build SwiftUI views for widgets 本文知识目录 本文属于 WWDC20 中 Widgets 系列的文章。Widgets 是使用 SwiftUI 进行开发的，如果您对 SwiftUI 还不是很了解请翻看 Introduction to SwiftUI。如" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://looseyi.github.io/post/wwdc/wwdc20/wwdc20-session-10033/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-06-27T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-06-27T00:00:00&#43;00:00" />


  
  <meta itemprop="name" content="WWDC20 - Build SwiftUI views for widgets">
<meta itemprop="description" content="WWDC20 Session 10033 - Build SwiftUI views for widgets 本文知识目录 本文属于 WWDC20 中 Widgets 系列的文章。Widgets 是使用 SwiftUI 进行开发的，如果您对 SwiftUI 还不是很了解请翻看 Introduction to SwiftUI。如"><meta itemprop="datePublished" content="2020-06-27T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-06-27T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="2422">
<meta itemprop="keywords" content="iOS&#39;,WWDC&#39;,SwiftUI," />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WWDC20 - Build SwiftUI views for widgets"/>
<meta name="twitter:description" content="WWDC20 Session 10033 - Build SwiftUI views for widgets 本文知识目录 本文属于 WWDC20 中 Widgets 系列的文章。Widgets 是使用 SwiftUI 进行开发的，如果您对 SwiftUI 还不是很了解请翻看 Introduction to SwiftUI。如"/>

  
  
</head>


  <body class="not-ready" data-menu="true">
    <header class="header">
  
  <p class="logo">
    <a class="site-name" href="https://looseyi.github.io/">Aha Edmond</a><a class="btn-dark"></a>
  </p>
  

  <script>
    let bodyClx = document.body.classList;
    let btnDark = document.querySelector('.btn-dark');
    let sysDark = window.matchMedia('(prefers-color-scheme: dark)');
    let darkVal = localStorage.getItem('dark');

    let setDark = (isDark) => {
      bodyClx[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark ? 'yes' : 'no');
    };

    setDark(darkVal ? darkVal === 'yes' : sysDark.matches);
    requestAnimationFrame(() => bodyClx.remove('not-ready'));

    btnDark.addEventListener('click', () => setDark(!bodyClx.contains('dark')));
    sysDark.addEventListener('change', (event) => setDark(event.matches));
  </script>

  
  
  <nav class="menu">
    
    <a class="" href="/">Home</a>
    
  </nav>
  

  
  <nav class="social">
    
    <a
      class="twitter"
      style="--url: url(./twitter.svg)"
      href="https://twitter.com/looseyi"
      target="_blank"
    ></a>
    
    <a
      class="github"
      style="--url: url(./github.svg)"
      href="https://github.com/looseyi"
      target="_blank"
    ></a>
    
  </nav>
  
</header>


    <main class="main">
			

<article class="post-single">
  <header class="post-title">
    <p>
      <time>2020-06-27</time>
      
      <span>土土Edmond木</span>
      
    </p>
    <h1>WWDC20 - Build SwiftUI views for widgets</h1>
  </header>
  <section class="post-content"><blockquote>
<p>WWDC20 Session 10033 - <a href="https://wwdc.io/share/wwdc20/10033">Build SwiftUI views for widgets</a></p>
</blockquote>
<h1 id="本文知识目录">本文知识目录</h1>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aao2inhj21hc10sn1q.jpg" alt="Build SwiftUI views for widgets"></p>
<p>本文属于 WWDC20 中 Widgets 系列的文章。Widgets 是使用 SwiftUI 进行开发的，如果您对 SwiftUI 还不是很了解请翻看 <a href="https://wwdc.io/share/wwdc20/10119">Introduction to SwiftUI</a>。如果希望先了解更多 Widgets 请移步文末的相关链接。</p>
<h1 id="swiftui-in-widgets">SwiftUI in widgets</h1>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aani6pjj21ao0qa47o.jpg" alt="00-opportunityToLearnSwiftUI"></p>
<p>我们可以为 Widgets 提供基于时间线的内容，它将在适当的时机展示在 iOS 14 或 macOS Big Sur 系统的主屏幕上。得益于 SwiftUI 良好的屏幕自适应能力，Widgets 可以在不同的系统上展示出不错的效果。因此，尽管我们的应用程序发布在旧版本的系统中 (无法使用 SwiftUI)，Widgets 也将是我们学习和使用 SwiftUI 的绝佳机会。</p>
<p>Widgets 的展示效果如下：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aankyrfj212l0p77u8.jpg" alt="01-SwiftUI&Widgets"></p>
<p>事不宜迟，让我们直接通过 Demo 来体验如何使用 SwiftUI 来开发一个 Widgets</p>
<h1 id="caffiine-drink-demo">Caffiine Drink Demo</h1>
<p>我们将要创建一个应用程序，用于记录和跟踪我们所喝的含咖啡因的饮料，并估算出我们体内的咖啡因含量。 应用如下：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aanlzjqj21ao0qa45r.jpg" alt="03-coffeineDrinks"></p>
<p>而 Widgets 正好可以作为该应用程序的重要补充，以便能够一目了然地知道我们当前的咖啡因含量。</p>
<p>这个是我们希望展示的 Widget 效果：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aannftyj21ao0qadhd.jpg" alt="04-coffeineDrinksItem"></p>
<p>首先，可以看到它的视觉和配色方案与我们的应用程序相同。</p>
<p>在顶部，我们显示了我们体内目前的咖啡因含量，底部记录的是我们喝的最后一杯咖啡的时间。请注意 ⚠️，咖啡因含量的背景形状与 widget 形状是同心圆的关系，它可是使用我们新出的 API 来实现的哦。</p>
<p>最后，也希望 widget 底部的持续时间能够实时更新以始终正确。</p>
<h2 id="hello-widget">Hello Widget!</h2>
<p>我们先新建一个项目，可以是 iOS、macOS 或 Multiplatform：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg63now4bdj20qo0f0diu.jpg" alt="mutliplatform"></p>
<p>接着需要再新建一个 widge 的 target，这里我们选择基于 iOS 项目的 widget：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aanjpejj20ka0em76h.jpg" alt="01-xcode-widget"></p>
<p>生成之后，让我们配上 <code>Hello Widget！</code>，并在 <code>PreviewProvider</code> 处添加上 <strong><a href="https://developer.apple.com/documentation/widgetkit/widgetpreviewcontext">WidgetPreviewContext</a></strong>：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span style="color:#268bd2">struct</span> <span style="color:#268bd2">CafeineDrinkWidget_Previews</span>: PreviewProvider {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>    <span style="color:#268bd2">static</span> <span style="color:#268bd2">var</span> <span style="color:#268bd2">previews</span>: some View {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>        Group {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span>            CafeineDrinkWidgetEntryView(entry: .preivewEntry, data: .previewData)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span>        }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span>        .previewContext(WidgetPreviewContext(family: .systemSmall))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">9</span>}
</code></pre></div><p>我们目前提供的 widget 样式分为三种：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span style="color:#268bd2">public</span> <span style="color:#268bd2">enum</span> <span style="color:#268bd2">WidgetFamily</span> : <span style="color:#b58900">Int</span>, <span style="color:#b58900">RawRepresentable</span>, CustomDebugStringConvertible, CustomStringConvertible {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>    <span style="color:#586e75">/// A small widget.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>    <span style="color:#719e07">case</span> systemSmall
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>    <span style="color:#586e75">/// A medium-sized widget.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span>    <span style="color:#719e07">case</span> systemMedium
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span>    <span style="color:#586e75">/// A large widget.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span>    <span style="color:#719e07">case</span> systemLarge
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8</span>}
</code></pre></div><p>让我们一起来看看最简版本的 widget 😄 。</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aannd6ej216u0rs1c4.jpg" alt="02-HelloWidget"></p>
<h2 id="data-configuration">Data Configuration</h2>
<p>接着，让我们把 <code>CaffeineWidgetData</code>  配置起来：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#268bd2">struct</span> <span style="color:#268bd2">CaffeineWidgetData</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">let</span> <span style="color:#268bd2">drinkName</span>: <span style="color:#b58900">String</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">let</span> <span style="color:#268bd2">drinkData</span>: Date
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">let</span> <span style="color:#268bd2">caffeineAmount</span>: Measurement&lt;UnitMass&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span><span style="color:#268bd2">extension</span> <span style="color:#268bd2">CaffeineWidgetData</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> <span style="color:#268bd2">let</span> <span style="color:#268bd2">previewData</span> = CaffeineWidgetData(
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>        drinkName: <span style="color:#2aa198">&#34;Cappuccino&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>        drinkData: Date().advanced(by: <span style="color:#719e07">-</span><span style="color:#2aa198">60</span> <span style="color:#719e07">*</span> <span style="color:#2aa198">29</span> <span style="color:#719e07">+</span> <span style="color:#2aa198">5</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>        caffeineAmount: Measurement&lt;UnitMass&gt;(value: <span style="color:#2aa198">56.23</span>, unit: .milligrams)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>    )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>}
</code></pre></div><p>接着再加上简单的 View  <code>LazyVStack</code> 和 <code>Text</code> 来承载我们新添的数据。效果如下：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aanormsj211n0sjh5a.jpg" alt="04-previewData"></p>
<p>有了基本结构后，我们再丰富一下。先加点背景色，这里我们用 <code>ZStack</code> 来包装：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span style="color:#268bd2">var</span> <span style="color:#268bd2">body</span>: some View {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>  	ZStack {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>      Color(<span style="color:#2aa198">&#34;cappuccino&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span>      LazyVStack(alignment: .leading) { ... }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span>   }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span>}
</code></pre></div><p>让我们把 <code>drinkName</code> 和 <code>drinkDate</code> 也展示出来：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>Text(<span style="color:#2aa198">&#34;</span><span style="color:#2aa198">\(</span>data.drinkName<span style="color:#2aa198">)</span><span style="color:#2aa198"> ☕️&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>   .font(.body)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>   .bold()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>   .foregroundColor(Color(<span style="color:#2aa198">&#34;milk&#34;</span>))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">6</span><span style="color:#586e75">/// NOTE: *New* Date provider API</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">7</span>Text(<span style="color:#2aa198">&#34;</span><span style="color:#2aa198">\(</span>data.drinkDate, style: .relative<span style="color:#2aa198">)</span><span style="color:#2aa198"> ago&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">8</span>   .font(.caption)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">9</span>   .foregroundColor(Color(<span style="color:#2aa198">&#34;milk&#34;</span>))
</code></pre></div><p>注意，这里我们使用了 SwiftUI 新出的 <code>DateStyle</code> API</p>
<h3 id="datestyle">DateStyle</h3>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#268bd2">public</span> <span style="color:#268bd2">struct</span> <span style="color:#268bd2">DateStyle</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>    <span style="color:#586e75">/// A style displaying only the time component for a date.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>    <span style="color:#586e75">/// Example output: </span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>    <span style="color:#586e75">///     11:23PM</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> <span style="color:#268bd2">let</span> <span style="color:#268bd2">time</span>: Text.DateStyle
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>    <span style="color:#586e75">/// A style displaying a date.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>    <span style="color:#586e75">/// Example output:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>    <span style="color:#586e75">///     June 3, 2019</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> <span style="color:#268bd2">let</span> <span style="color:#268bd2">date</span>: Text.DateStyle
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>    <span style="color:#586e75">/// A style displaying a date as relative to now.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>    <span style="color:#586e75">/// Example output:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>    <span style="color:#586e75">///     2 hours, 23 minutes</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>    <span style="color:#586e75">///     1 year, 1 month</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> <span style="color:#268bd2">let</span> <span style="color:#268bd2">relative</span>: Text.DateStyle
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>    <span style="color:#586e75">/// A style displaying a date as offset from now.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span>    <span style="color:#586e75">/// Example output:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span>    <span style="color:#586e75">///     +2 hours</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span>    <span style="color:#586e75">///     -3 months</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> <span style="color:#268bd2">let</span> <span style="color:#268bd2">offset</span>: Text.DateStyle
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span>    <span style="color:#586e75">/// A style displaying a date as timer counting from now.</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span>    <span style="color:#586e75">/// Example output:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span>    <span style="color:#586e75">///    2:32</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28</span>    <span style="color:#586e75">///    36:59:01</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29</span>    <span style="color:#268bd2">public</span> <span style="color:#268bd2">static</span> <span style="color:#268bd2">let</span> <span style="color:#268bd2">timer</span>: Text.DateStyle
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30</span>}
</code></pre></div><p>再来看一眼效果：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aanrer2j214m0rr4ep.jpg" alt="05-allDataUsage"></p>
<h2 id="restructuring">Restructuring</h2>
<p>接下来，我们稍微调整一下代码结构，将内部的两个 <code>LazyStack</code> 抽离成单独的 View。这里可以用 Xcode 的 <code>Extra Subview</code> 来帮我们完成工作，我们只需将 🖱️移动到 <code>LazyStack</code> 上，按住 <code>Command</code> 并点击 🖱️ 就可以弹出如下窗口：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aanun9zj20j20ib11g.jpg" alt="06-Extrack Subview"></p>
<p>调整后，我们的结构就清爽很多了：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#268bd2">var</span> <span style="color:#268bd2">body</span>: some View {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>    ZStack {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>        Color(<span style="color:#2aa198">&#34;cappuccino&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>        LazyVStack(alignment: .leading) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>            CaffineAmountView(data: data)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>            Spacer()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>            DrinkView(data: data)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>        }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>        .padding(.all)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>}
</code></pre></div><p>记得为我们新加的 <code>CaffineAmountView</code> 和 <code>DrinkView</code> 加上 <code>CaffeineWidgetData</code> 数据。</p>
<h3 id="caffineamountview">CaffineAmountView</h3>
<p>最后再用我们的另一个新的 API 来修改 <code>CaffineAmountView</code>。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#268bd2">var</span> <span style="color:#268bd2">body</span>: some View {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>    LazyHStack {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>        VStack(alignment: .leading) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>            Text(<span style="color:#2aa198">&#34;Caffeine&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>                .font(.body)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>                .foregroundColor(Color(<span style="color:#2aa198">&#34;espresso&#34;</span>))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>                .bold()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>            Text(Formatter.measurement.string(from: data.caffeineAmount))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>                .font(.title)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>                .bold()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>                .foregroundColor(Color(<span style="color:#2aa198">&#34;espresso&#34;</span>))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>                .minimumScaleFactor(<span style="color:#2aa198">0.8</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>        }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>        Spacer(minLength: <span style="color:#2aa198">0</span>) <span style="color:#586e75">// #1</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>    .padding(.all, <span style="color:#2aa198">8.0</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>    .background(ContainerRelativeShape().fill(Color(<span style="color:#2aa198">&#34;latte&#34;</span>))) <span style="color:#586e75">// #2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>}
</code></pre></div><p>先注意一下，这里将 <code>Spacer</code> 的 minLength 设置为 0 是为了将整个 AmountView 的内容撑满。然后在编写 Demo 的过程中发现新增的 <code>LazyVStack</code> 在 layout 过程中有 bug，无法正常将内容撑满，所以这里改回用 <code>VStack</code>。</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aanvwo6j21ds0n00wu.jpg" alt="07-LazyVStack"></p>
<h3 id="containerrelativeshape">ContainerRelativeShape</h3>
<blockquote>
<p>A shape that is replaced by an inset version of the current container shape. If no container shape was defined, is replaced by a rectangle.</p>
</blockquote>
<p>由于不同大小的设备可能对其 widget 使用不同的半径，这可能会导致情况变得有些麻烦。 而新出的 <code>ContainerRelativeShape</code> 是一种新的形状类型，它将采用最接近父视图容器形状的路径，并根据形状的位置使用适当的倒角半径。</p>
<p>通过添加 <code>ContainerRelativeShape</code>，我们的 AmountView 会采用与系统为 widget 定义容器形状相同的同心的角半径。如果更改主 <code>VStack</code> 的 padding 的值，则 AmountView 的倒角将发生变化，以使围绕它的边框在拐角曲线周围保持恒定的厚度。</p>
<p>例如，我们修改容器的 padding 为 10，AmountView 的倒角变化效果如下：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aanx48dj20n5081god.jpg" alt="08-adjust padding"></p>
<p>##PreviewProvider</p>
<p>我们来看看 Widge 在不同场景下的实际效果。</p>
<h3 id="darkmode">DarkMode</h3>
<p>首先是 <code>.envrioment</code> 修饰符在 DarkMode 下的效果，这个其实完全由我们配置的 ColorSet 来保证的。</p>
<p><img src="http://ww1.sinaimg.cn/large/8157560cly1gg7aao0f8cj20jt05fgmr.jpg" alt="10-colorSet"></p>
<p>然后我们在 View 上添加 <code>colorScheme</code> 的环境配置就可以了。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>CafeineDrinkWidgetEntryView(entry: .preivewEntry, data: .previewData)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>    .previewContext(WidgetPreviewContext(family: .systemSmall))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>    .environment(\.colorScheme, .dark)
</code></pre></div><h3 id="sizecategory">SizeCategory</h3>
<p>可通过  <code>.envrioment</code> 修饰符的  <code>sizeCategory</code> 来控制 widget 的字体大小。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>CafeineDrinkWidgetEntryView(entry: .preivewEntry, data: .previewData)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>    .previewContext(WidgetPreviewContext(family: .systemSmall))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>    .environment(\.sizeCategory, .extraExtraLarge)
</code></pre></div><p>让我们先来看看这两种情况的效果：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aanyx89j218p0sjh3g.jpg" alt="09-previewSize"></p>
<h3 id="placeholder">Placeholder</h3>
<p>今年的 SwiftUI 还提供了一个特别棒的功能，我们可以通过 <code>isPlaceholder</code> 修饰符来设置骨架图。</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aanzjjqj20v006jach.jpg" alt="11-isPlaceholder"></p>
<p><code>.isPlaceholder</code>  还支持对单个视图的控制等。不过，目前的 Xcode 12 Beta1 版本还无法使用 😅。大家就且看一下吧。</p>
<h3 id="widgetfamily">WidgetFamily</h3>
<p>最后一个预览，让我们一起看看如何通过 <code>WidgetFamily</code> 来控制 Widge 的展示。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#268bd2">struct</span> <span style="color:#268bd2">CafeineDrinkWidgetEntryView</span> : View {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>    ...    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>    @Environment(\.widgetFamily) <span style="color:#268bd2">var</span> <span style="color:#268bd2">widgetFamily</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>    <span style="color:#268bd2">var</span> <span style="color:#268bd2">body</span>: some View {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>        ZStack {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>            ...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>            LazyHStack {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>                LazyVStack(alignment: .leading) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>                    CaffineAmountView(data: data)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>                    Spacer()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>                    DrinkView(data: data)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>                }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>                .padding(.all, <span style="color:#2aa198">10</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>                <span style="color:#719e07">if</span> widgetFamily == .systemMedium, <span style="color:#268bd2">let</span> <span style="color:#268bd2">phoneName</span> = data.phoneName {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>                    Image(phoneName).resizable()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>                }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>            }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span>        }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span>}
</code></pre></div><p>这里我们在 <code>widgetFamily</code> 为 <code>.systemMedium</code> 的情况下，为其添加了一张最后喝过的咖啡的图片。</p>
<p>效果如下：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aao6wfij20y3077n1x.jpg" alt="12-widgetFamily"></p>
<h1 id="new-apis">New APIs</h1>
<p>最后一节，再来回顾一下我们使用到的新 API</p>
<p><strong>DateStyle</strong></p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aanu0ekj20nc0d5jxx.jpg" alt="06-dateTeimAPI"></p>
<p><strong>ContainerRelativeShape</strong></p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg7aant2jjj20nc0d5q6i.jpg" alt="05-relativeShape"></p>
<p><strong>文末福利</strong></p>
<p>由于本文的 Session 并未提供相应的 SampleCode。本人在文章撰写的过程中，顺带写了完整的 Demo，如有需要的同学可以自取：<a href="https://github.com/looseyi/WWDC20-100330-SampleCode.git">Github</a>。⚠️  注意，在有的 macOS 系统上通过 Xcode 12 Beta 运行后可能无法在模拟器上查看 widget，不过在 Xcode 的 sidebar 预览，完整效果建议在真实设备体验。</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/8157560cly1gg89svkl11g20cg0qo1l3.gif" alt="widget.gif"></p>
<h1 id="总结">总结</h1>
<ul>
<li>苹果通过独立的 taget 将 <code>Widget</code> 与主项目隔离开来，很好的支持了 Widget 发展，因为不会有历史包袱。</li>
<li><code>Widge</code> 的定位还是比较清晰的，用于弥补宿主应用程序无法及时展示用户所关心的数据，而 Widget 正好很适合展示。</li>
<li>配合越来越丰富的 SwiftUI 的功能和性能的提升，Widget 也能够与现有的苹果生态更好的集成。</li>
<li>Widget 也使得苹果在 iOS 和 macOS 生态的融合了也更进了一步。</li>
</ul>
<h1 id="知识点问题梳理">知识点问题梳理</h1>
<ol>
<li><code>Widget</code> 支持在所有的苹果系统中使用吗 ？</li>
<li>本文的示例中使用了哪几种新 API，试着描述它们的功能 ？</li>
<li>本文的示例展示了几种环境描述符 ?</li>
</ol>
<h1 id="widges-相关视频">Widges 相关视频</h1>
<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2020/10103">Design great widgets</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2020/10028">Meet WidgetKit</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2020/10034">Widgets Code-along, part 1: The adventure begins</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2020/10035">Widgets Code-along, part 2: Alternate timelines</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2020/10036">Widgets Code-along, part 3: Advancing timelines</a></li>
</ul>
</section>

  
  
  <footer class="post-tags">
     
    <a href="https://looseyi.github.io/tags/ios">iOS&#39;</a>
     
    <a href="https://looseyi.github.io/tags/wwdc">WWDC&#39;</a>
     
    <a href="https://looseyi.github.io/tags/swiftui">SwiftUI</a>
    
  </footer>
  

  
  
  
  <nav class="post-nav">
    
    <a class="prev" href="https://looseyi.github.io/post/sourcecode-cocoapods/02-cocoapods-corecomponents/"><span>←</span><span>2. 整体把握 CocoaPods 核心组件</span></a>
     
    <a class="next" href="https://looseyi.github.io/post/wwdc/wwdc20/wwdc20-session-10041/"><span>WWDC20 - What&#39;s new in SwiftUI</span><span>→</span></a>
    
  </nav>
  

  
  
</article>


			

  

  
    <script src="https://utteranc.es/client.js"
            repo="looseyi/looseyi.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

		</main>

    <footer class="footer">
  <p>&copy; 2021 <a href="https://looseyi.github.io/">Aha Edmond</a></p>
  <p>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>️</p>
  <p>
    <a href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank">Paper 5.1</a>
  </p>
</footer>

		


  </body>
</html>
