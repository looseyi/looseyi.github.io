<!DOCTYPE html>















<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  
  <title>5. PodSpec 文件分析 - Aha Edmond</title>

  
  
  <meta name="description" content="引子 在上文 Podfile 解析逻辑 中，我们以 Xcode 工程结构作为切入点介绍了 Podfile 背后对应的数据结构，剖析了 Podfile 文件是如何解析与加载，并最终 &ldquo;入侵&rdq" />
  <meta name="author" content="土土Edmond木" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://looseyi.github.io/app.min.css" />

  

  
  <link rel="preload" as="image" href="https://looseyi.github.io/theme.png" />

  
  <link rel="preload" as="image" href="https://looseyi.github.io/twitter.svg" />
  
  <link rel="preload" as="image" href="https://looseyi.github.io/github.svg" />
  

  
  <link rel="icon" href="https://looseyi.github.io/favicon.ico" />
  <link rel="apple-touch-icon" href="https://looseyi.github.io/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.82.1" />

  
  
  <link
    rel="alternate"
    type="application/rss&#43;xml"
    href="https://looseyi.github.io/post/sourcecode-cocoapods/05-cocoapods-podspec/index.xml"
    title="Aha Edmond"
  />
  

  
  
  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-62789092-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  
  
  
  <meta property="og:title" content="5. PodSpec 文件分析" />
<meta property="og:description" content="引子 在上文 Podfile 解析逻辑 中，我们以 Xcode 工程结构作为切入点介绍了 Podfile 背后对应的数据结构，剖析了 Podfile 文件是如何解析与加载，并最终 &ldquo;入侵&rdq" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://looseyi.github.io/post/sourcecode-cocoapods/05-cocoapods-podspec/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-10-13T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-10-13T00:00:00&#43;00:00" />


  
  <meta itemprop="name" content="5. PodSpec 文件分析">
<meta itemprop="description" content="引子 在上文 Podfile 解析逻辑 中，我们以 Xcode 工程结构作为切入点介绍了 Podfile 背后对应的数据结构，剖析了 Podfile 文件是如何解析与加载，并最终 &ldquo;入侵&rdq"><meta itemprop="datePublished" content="2020-10-13T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-10-13T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="4870">
<meta itemprop="keywords" content="CocoaPods,iOS,Ruby," />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="5. PodSpec 文件分析"/>
<meta name="twitter:description" content="引子 在上文 Podfile 解析逻辑 中，我们以 Xcode 工程结构作为切入点介绍了 Podfile 背后对应的数据结构，剖析了 Podfile 文件是如何解析与加载，并最终 &ldquo;入侵&rdq"/>

  
  
</head>


  <body class="not-ready" data-menu="true">
    <header class="header">
  
  <p class="logo">
    <a class="site-name" href="https://looseyi.github.io/">Aha Edmond</a><a class="btn-dark"></a>
  </p>
  

  <script>
    let bodyClx = document.body.classList;
    let btnDark = document.querySelector('.btn-dark');
    let sysDark = window.matchMedia('(prefers-color-scheme: dark)');
    let darkVal = localStorage.getItem('dark');

    let setDark = (isDark) => {
      bodyClx[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark ? 'yes' : 'no');
    };

    setDark(darkVal ? darkVal === 'yes' : sysDark.matches);
    requestAnimationFrame(() => bodyClx.remove('not-ready'));

    btnDark.addEventListener('click', () => setDark(!bodyClx.contains('dark')));
    sysDark.addEventListener('change', (event) => setDark(event.matches));
  </script>

  
  
  <nav class="menu">
    
    <a class="" href="/">Home</a>
    
  </nav>
  

  
  <nav class="social">
    
    <a
      class="twitter"
      style="--url: url(./twitter.svg)"
      href="https://twitter.com/looseyi"
      target="_blank"
    ></a>
    
    <a
      class="github"
      style="--url: url(./github.svg)"
      href="https://github.com/looseyi"
      target="_blank"
    ></a>
    
  </nav>
  
</header>


    <main class="main">
			

<article class="post-single">
  <header class="post-title">
    <p>
      <time>2020-10-13</time>
      
      <span>土土Edmond木</span>
      
    </p>
    <h1>5. PodSpec 文件分析</h1>
  </header>
  <section class="post-content"><h1 id="引子">引子</h1>
<p>在上文 <a href="https://zhuanlan.zhihu.com/p/248308670">Podfile 解析逻辑</a> 中，我们以 Xcode 工程结构作为切入点介绍了 Podfile 背后对应的数据结构，剖析了 <code>Podfile</code> 文件是如何解析与加载，并最终 <em>&ldquo;入侵&rdquo;</em> 项目影响其工程结构的。今天我们来聊一聊 <em><a href="https://link.zhihu.com/?target=https%3A//github.com/CocoaPods/Core">CocoaPods-Core</a></em> 中的另一个重要文件 &mdash; <code>PodSpec</code> 以及它所撑起的 CocoaPods 世界。</p>
<p>一个 <code>Pod</code> 的创建和发布离不开 <code>PodSpec</code> 文件，它可以很简单也能复杂，如 <a href="https://github.com/Tencent/QMUI_iOS/blob/master/QMUIKit.podspec">QMUIKit</a>（后续介绍)。</p>
<p>今天我们就直奔主题，来分析 <code>PodSpec</code> 文件。</p>
<blockquote>
<p>Tips：如果未看过<a href="https://zhuanlan.zhihu.com/p/248308670">前文</a>，强烈推荐。</p>
</blockquote>
<h1 id="podspec">PodSpec</h1>
<blockquote>
<p>The Specification provides a DSL to describe a Pod. A pod is defined as a library originating from a source. A specification can support detailed attributes for modules of code through subspecs.</p>
</blockquote>
<p><code>PodSpec</code> 是用于<strong>描述一个 Pod 库的源代码和资源将如何被打包编译成链接库或 framework 的文件</strong>，而 <code>PodSpec</code> 中的这些描述内容最终将映会映射到 <code>Specification</code> 类中（以下简称 <strong>Spec</strong>）。</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/3MFQxdCNgTHuBIW.png" alt="01-Spec"></p>
<p>让我们来重新认识 <code>PodSpec</code>。</p>
<h2 id="podspec-初探">PodSpec 初探</h2>
<p><code>PodSpec</code> 支持的文件格式为 <code>.podspec</code> 和 <code>.json</code> 两种，而 <code>.podspec</code> 本质是 Ruby 文件。</p>
<p>问题来了，为什么是 JSON 格式而不像 <code>Podfile</code> 一样支持 YAML 呢？</p>
<p>笔者的理解：由于 <code>PodSpec</code> 文件会满世界跑，它可能存在于 CocoaPods 的 <a href="https://cdn.cocoapods.org/">CDN Service</a>、<a href="https://github.com/CocoaPods/Specs">Speces Repo</a> 或者你们的私有 Specs Repo 上，因此采用  JSON 的文件在网络传输中会更友好。而 <code>Podfile</code> 更多的场景是用于序列化，它需要在项目中生成一份经依赖仲裁后的 <code>Podfile</code> 快照，用于后续的对比。</p>
<h3 id="podspec-1">PodSpec</h3>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#cb4b16">Pod</span><span style="color:#719e07">::</span><span style="color:#cb4b16">Spec</span><span style="color:#719e07">.</span>new <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>spec<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>  spec<span style="color:#719e07">.</span>name         <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;Reachability&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>  spec<span style="color:#719e07">.</span>version      <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;3.1.0&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>  spec<span style="color:#719e07">.</span>license      <span style="color:#719e07">=</span> { <span style="color:#2aa198">:type</span> <span style="color:#719e07">=&gt;</span> <span style="color:#2aa198">&#39;BSD&#39;</span> }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>  spec<span style="color:#719e07">.</span>homepage     <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;https://github.com/tonymillion/Reachability&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>  spec<span style="color:#719e07">.</span>authors      <span style="color:#719e07">=</span> { <span style="color:#2aa198">&#39;Tony Million&#39;</span> <span style="color:#719e07">=&gt;</span> <span style="color:#2aa198">&#39;tonymillion@gmail.com&#39;</span> }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>  spec<span style="color:#719e07">.</span>summary      <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;ARC and GCD Compatible Reachability Class for iOS and OS X.&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>  spec<span style="color:#719e07">.</span>source       <span style="color:#719e07">=</span> { <span style="color:#2aa198">:git</span> <span style="color:#719e07">=&gt;</span> <span style="color:#2aa198">&#39;https://github.com/tonymillion/Reachability.git&#39;</span>, <span style="color:#2aa198">:tag</span> <span style="color:#719e07">=&gt;</span> <span style="color:#2aa198">&#34;v</span><span style="color:#2aa198">#{</span>spec<span style="color:#719e07">.</span>version<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>  spec<span style="color:#719e07">.</span>source_files <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;Reachability.{h,m}&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>  spec<span style="color:#719e07">.</span>framework    <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;SystemConfiguration&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span><span style="color:#719e07">end</span>
</code></pre></div><p>上面这份 <code>Reachability.podspec</code> 配置，基本通过命令行 <code>pod lib create NAME</code> 就能帮我们完成。除此之外我们能做的更多，比如，默认情况下 CococaPods 会为每个 <code>pod</code> framework 生成一个对应的 <strong>modulemap</strong> 文件，它将包含 <code>PodSpec</code> 中指定的公共 headers。如果需要自定义引入的 header 文件，仅需配置 <code>moduel_map</code> 即可完成。</p>
<p>下面是进阶版配置：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#cb4b16">Pod</span><span style="color:#719e07">::</span><span style="color:#cb4b16">Spec</span><span style="color:#719e07">.</span>new <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>spec<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>  spec<span style="color:#719e07">.</span>name         <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;Reachability&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>  <span style="color:#586e75"># 省略与前面相同部分的配置 ...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>  spec<span style="color:#719e07">.</span>module_name   <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;Rich&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>  spec<span style="color:#719e07">.</span>swift_version <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;4.0&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>  spec<span style="color:#719e07">.</span>ios<span style="color:#719e07">.</span>deployment_target  <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;9.0&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>  spec<span style="color:#719e07">.</span>osx<span style="color:#719e07">.</span>deployment_target  <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;10.10&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>  spec<span style="color:#719e07">.</span>source_files       <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;Reachability/common/*.swift&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>  spec<span style="color:#719e07">.</span>ios<span style="color:#719e07">.</span>source_files   <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;Reachability/ios/*.swift&#39;</span>, <span style="color:#2aa198">&#39;Reachability/extensions/*.swift&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>  spec<span style="color:#719e07">.</span>osx<span style="color:#719e07">.</span>source_files   <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;Reachability/osx/*.swift&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>  spec<span style="color:#719e07">.</span>framework      <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;SystemConfiguration&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>  spec<span style="color:#719e07">.</span>ios<span style="color:#719e07">.</span>framework  <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;UIKit&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>  spec<span style="color:#719e07">.</span>osx<span style="color:#719e07">.</span>framework  <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;AppKit&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>  spec<span style="color:#719e07">.</span>dependency <span style="color:#2aa198">&#39;SomeOtherPod&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span><span style="color:#719e07">end</span>
</code></pre></div><p>像 👆 我们为不同的系统指定了不同的源码和依赖等，当然可配置的不只这些。</p>
<p><code>PodSpec</code> 支持的完整配置分类如下：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/tDW3YNr4F2GXA1y.png" alt="01-Specification"></p>
<p>想了解更多的配置选项：<a href="https://guides.cocoapods.org/syntax/podspec.html">传送门</a>。</p>
<h3 id="convention-over-configuration">Convention Over Configuration</h3>
<blockquote>
<p>Convention over configuration (aka：coding by convention) is a software design paradigm used by software frameworks that attempts to decrease the number of decisions that a developer using the framework is required to make without necessarily losing flexibility.</p>
</blockquote>
<p>说到配置，不得不提一下 <code>CoC</code> 约定大于配置。约定大于配置算是在软件工程较早出现的概念的了，大意是：<strong>为了简单起见，我们的代码需要按照一定的约定来编写</strong>（如代码放在什么目录，用什么文件名，用什么类名等)。 这样既简化了配置文件，同时也降低了学习成本。</p>
<p>约定大于配置可以说是通过 <a href="https://www.wikiwand.com/en/Ruby_on_Rails">Ruby on Rails</a> 发扬光大的。尽管它一直饱受争议，但是主流语言的依赖管理工具，如 <em>Maven，npm</em> 等都遵循 <code>CoC</code> 进行不断演进的，因为 <code>CoC</code> 能够有效帮助开发者减轻选择的痛感，减少无意义的选择。一些新的语言也吸收了这个思想，比如 Go 语言。如果用 C/C++ 可能需要定义复杂的 Makefile 来定义编译的规则，以及如何运行测试用例，而在 Go 中这些都是约定好的。</p>
<p>举个 🌰 ：<code>Podfile</code> 中是可以指定 pod library 所链接的 Xcode project，不过大多情况下无需配置，CocoaPods 会自动查找 <code>Podfile</code> 所在的同级目录下所对应的工程文件 <code>.project</code> 。</p>
<h2 id="spec-的核心数据结构">Spec 的核心数据结构</h2>
<h3 id="specification">Specification</h3>
<p>在数据结构上 <code>Specification</code> 与 <a href="https://looseyi.github.io/post/sourcecode-cocoapods/04-cocoapods-podfile/#targetdefinition">TargetDefinition</a> 是类似的，<strong>同为多叉树结构</strong>。简化后的 <code>Spec</code> 的类如下：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#b58900">require</span> <span style="color:#2aa198">&#39;active_support/core_ext/string/strip.rb&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span style="color:#586e75"># 记录对应 platform 上 Spec 的其他 pod 依赖</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span><span style="color:#b58900">require</span> <span style="color:#2aa198">&#39;cocoapods-core/specification/consumer&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span><span style="color:#586e75"># 解析 DSL</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span><span style="color:#b58900">require</span> <span style="color:#2aa198">&#39;cocoapods-core/specification/dsl&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span><span style="color:#586e75"># 校验 Spec 的正确性，并抛出对应的错误和警告</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span><span style="color:#b58900">require</span> <span style="color:#2aa198">&#39;cocoapods-core/specification/linter&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span><span style="color:#586e75"># 用于解析 DSL 内容包含的配置信息</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span><span style="color:#b58900">require</span> <span style="color:#2aa198">&#39;cocoapods-core/specification/root_attribute_accessors&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span><span style="color:#586e75"># 记录一个 Pod 所有依赖的 Spec 来源信息</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span><span style="color:#b58900">require</span> <span style="color:#2aa198">&#39;cocoapods-core/specification/set&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span><span style="color:#586e75"># json 格式数据解析</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span><span style="color:#b58900">require</span> <span style="color:#2aa198">&#39;cocoapods-core/specification/json&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span><span style="color:#719e07">module</span> Pod
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>  <span style="color:#719e07">class</span> <span style="color:#268bd2">Specification</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>    <span style="color:#719e07">include</span> <span style="color:#cb4b16">Pod</span><span style="color:#719e07">::</span><span style="color:#cb4b16">Specification</span><span style="color:#719e07">::</span><span style="color:#cb4b16">DSL</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>    <span style="color:#719e07">include</span> <span style="color:#cb4b16">Pod</span><span style="color:#719e07">::</span><span style="color:#cb4b16">Specification</span><span style="color:#719e07">::</span><span style="color:#cb4b16">DSL</span><span style="color:#719e07">::</span><span style="color:#cb4b16">Deprecations</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>    <span style="color:#719e07">include</span> <span style="color:#cb4b16">Pod</span><span style="color:#719e07">::</span><span style="color:#cb4b16">Specification</span><span style="color:#719e07">::</span><span style="color:#cb4b16">RootAttributesAccessors</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span>    <span style="color:#719e07">include</span> <span style="color:#cb4b16">Pod</span><span style="color:#719e07">::</span><span style="color:#cb4b16">Specification</span><span style="color:#719e07">::</span><span style="color:#cb4b16">JSONSupport</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span> 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span>    <span style="color:#586e75"># `subspec` 的父节点</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span>    <span style="color:#719e07">attr_reader</span> <span style="color:#2aa198">:parent</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span>    <span style="color:#586e75"># `Spec` 的唯一 id，由 name + version 的 hash 构成</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span>    <span style="color:#719e07">attr_reader</span> <span style="color:#2aa198">:hash_value</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span>    <span style="color:#586e75"># 记录 `Spec` 的配置信息 </span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span>    <span style="color:#719e07">attr_accessor</span> <span style="color:#2aa198">:attributes_hash</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28</span>    <span style="color:#586e75"># `Spec` 包含的 `subspec`</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29</span>    <span style="color:#719e07">attr_accessor</span> <span style="color:#2aa198">:subspecs</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30</span>     
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31</span>    <span style="color:#586e75"># 递归调用获取 Specification 的根节点</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32</span>    <span style="color:#719e07">def</span> <span style="color:#268bd2">root</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33</span>      parent ? parent<span style="color:#719e07">.</span>root : <span style="color:#b58900">self</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">34</span>    <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">35</span>     
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">36</span>	 <span style="color:#719e07">def</span> <span style="color:#268bd2">hash</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">37</span>   	<span style="color:#719e07">if</span> @hash_value<span style="color:#719e07">.</span>nil?
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">38</span>      	@hash_value <span style="color:#719e07">=</span> (<span style="color:#b58900">name</span><span style="color:#719e07">.</span>hash <span style="color:#719e07">*</span> <span style="color:#2aa198">53</span>) <span style="color:#719e07">^</span> version<span style="color:#719e07">.</span>hash
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">39</span>		<span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">40</span>      @hash_value
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">41</span>    <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">42</span>    <span style="color:#586e75"># ...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">43</span><span style="color:#719e07">end</span>
</code></pre></div><p><code>Specification</code> 同样用 map <code>attributes_hash</code> 来记录配置信息。</p>
<p>⚠️ 这里的 parent 是为 <code>subspec</code> 保留的，用于指向其父节点的 <code>Spec</code>。</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/L8MkIO3bD4dJXqR.png" alt="02-PodSpec-Dependency"></p>
<h3 id="subspecs">Subspecs</h3>
<blockquote>
<p>A library can specify a dependency on either another library, a subspec of another library, or a subspec of itself.</p>
</blockquote>
<p>乍一听 <code>Subspec</code> 这个概念似乎有一些抽象，不过当你理解了上面的描述，就能明白什么是 <code>Subspec</code> 了。我们知道在 Xcode 项目中，target 作为最小的可编译单元，它编译后的产物为链接库或 framework。而在 CocoaPods 的世界里这些 targets 则是由 <code>Spec</code> 文件来描述的，它还能拆分成一个或者多个 <code>Subspec</code>，我们暂且把它称为 <code>Spec</code> 的<strong>子模块</strong>，子模块也是用 <strong>Specification</strong> 类来描述的。</p>
<p>**子模块可以单独作为依赖被引入到项目中。**它有几个特点：</p>
<ul>
<li>未指定 <code>default_subspec</code> 的情况下，<code>Spec</code> 的全部子模块都将作为依赖被引入；</li>
<li>子模块会主动继承其父节点 <code>Spec</code> 中定义的 <code>attributes_hash</code>；</li>
<li>子模块可以指定自己的源代码、资源文件、编译配置、依赖等；</li>
<li>同一 <code>Spec</code> 内部的子模块是可以有依赖关系的；</li>
<li>每个子模块在 <code>pod push</code> 的时候是需要被 lint 通过的；</li>
</ul>
<p>光听总结似乎还是云里雾里，祭出 QMUI 让大家感受一下：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#cb4b16">Pod</span><span style="color:#719e07">::</span><span style="color:#cb4b16">Spec</span><span style="color:#719e07">.</span>new <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>s<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>  s<span style="color:#719e07">.</span>name             <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;QMUIKit&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>  s<span style="color:#719e07">.</span>version          <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;4.2.1&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>  <span style="color:#586e75"># ...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>  s<span style="color:#719e07">.</span>subspec <span style="color:#2aa198">&#39;QMUICore&#39;</span> <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>ss<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>    ss<span style="color:#719e07">.</span>source_files <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;QMUIKit/QMUIKit.h&#39;</span>, <span style="color:#2aa198">&#39;QMUIKit/QMUICore&#39;</span>, <span style="color:#2aa198">&#39;QMUIKit/UIKitExtensions&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>    ss<span style="color:#719e07">.</span>dependency <span style="color:#2aa198">&#39;QMUIKit/QMUIWeakObjectContainer&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>    ss<span style="color:#719e07">.</span>dependency <span style="color:#2aa198">&#39;QMUIKit/QMUILog&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>  <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>  s<span style="color:#719e07">.</span>subspec <span style="color:#2aa198">&#39;QMUIWeakObjectContainer&#39;</span> <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>ss<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>    ss<span style="color:#719e07">.</span>source_files <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;QMUIKit/QMUIComponents/QMUIWeakObjectContainer.{h,m}&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>  <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>  s<span style="color:#719e07">.</span>subspec <span style="color:#2aa198">&#39;QMUILog&#39;</span> <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>ss<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>    ss<span style="color:#719e07">.</span>source_files <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;QMUIKit/QMUIComponents/QMUILog/*.{h,m}&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>  <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>  s<span style="color:#719e07">.</span>subspec <span style="color:#2aa198">&#39;QMUIComponents&#39;</span> <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>ss<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span>    ss<span style="color:#719e07">.</span>dependency <span style="color:#2aa198">&#39;QMUIKit/QMUICore&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span>     
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span>    ss<span style="color:#719e07">.</span>subspec <span style="color:#2aa198">&#39;QMUIButton&#39;</span> <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>sss<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span>      sss<span style="color:#719e07">.</span>source_files <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;QMUIKit/QMUIComponents/QMUIButton/QMUIButton.{h,m}&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span>    <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span>    <span style="color:#586e75"># 此处省略 59 个 Components</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span>  <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span>  <span style="color:#586e75"># ...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28</span><span style="color:#719e07">end</span>
</code></pre></div><blockquote>
<p>不吹不黑，QMUI 是笔者见过国内开源作品中代码注释非常详尽且提供完整 Demo 的项目之一。</p>
<p><strong>QMUI 🐂 🍺</strong></p>
</blockquote>
<p>整个 QMUIKit 的 <code>Spec</code> 文件中，总共定义了 <strong>64</strong> 个 <code>subspec</code> 子模块，同时这些子模块之间还做了分层。比如 QMUICore：</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/EQTshCgymAzUXnZ.png" alt="03-QMUICore"></p>
<p>另外补充一点，CocoaPods 支持了不同类型的 <code>SubSpec</code>：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span style="color:#586e75"># lib/cocoapods-core/specification/dsl/attribute_support.rb</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span style="color:#cb4b16">SUPPORTED_SPEC_TYPES</span> <span style="color:#719e07">=</span> <span style="color:#719e07">[</span><span style="color:#2aa198">:library</span>, <span style="color:#2aa198">:app</span>, <span style="color:#2aa198">:test</span><span style="color:#719e07">].</span>freeze
</code></pre></div><p><code>:app</code> 和 <code>:test</code> 用于在项目中集成单元测试代码的 <code>Subspec</code>。</p>
<h2 id="podspec-from-json">PodSpec From JSON</h2>
<p>有了上文 <code>Podfile</code> 的了解，这次我们对 <code>PodSpec</code> 的文件加载会更加轻车熟路。首先是由 <code>#from_file</code> 方法进行文件路径和内容编码格式的检查，将加载的内容转入 <code>#from_string</code>：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#719e07">def</span> <span style="color:#268bd2">self</span><span style="color:#719e07">.</span><span style="color:#268bd2">from_file</span>(path, subspec_name <span style="color:#719e07">=</span> <span style="color:#719e07">nil</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>  path <span style="color:#719e07">=</span> <span style="color:#cb4b16">Pathname</span><span style="color:#719e07">.</span>new(path)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>  <span style="color:#719e07">unless</span> path<span style="color:#719e07">.</span>exist?
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>    <span style="color:#719e07">raise</span> <span style="color:#cb4b16">Informative</span>, <span style="color:#2aa198">&#34;No podspec exists at path `</span><span style="color:#2aa198">#{</span>path<span style="color:#2aa198">}</span><span style="color:#2aa198">`.&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>  <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>  string <span style="color:#719e07">=</span> <span style="color:#cb4b16">File</span><span style="color:#719e07">.</span>open(path, <span style="color:#2aa198">&#39;r:utf-8&#39;</span>, <span style="color:#719e07">&amp;</span><span style="color:#2aa198">:read</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>  <span style="color:#586e75"># Work around for Rubinius incomplete encoding in 1.9 mode</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>  <span style="color:#719e07">if</span> string<span style="color:#719e07">.</span>respond_to?(<span style="color:#2aa198">:encoding</span>) <span style="color:#719e07">&amp;&amp;</span> string<span style="color:#719e07">.</span>encoding<span style="color:#719e07">.</span>name <span style="color:#719e07">!=</span> <span style="color:#2aa198">&#39;UTF-8&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>    string<span style="color:#719e07">.</span>encode!(<span style="color:#2aa198">&#39;UTF-8&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>  <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>  from_string(string, path, subspec_name)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span><span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span><span style="color:#719e07">def</span> <span style="color:#268bd2">self</span><span style="color:#719e07">.</span><span style="color:#268bd2">from_string</span>(spec_contents, path, subspec_name <span style="color:#719e07">=</span> <span style="color:#719e07">nil</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>  path <span style="color:#719e07">=</span> <span style="color:#cb4b16">Pathname</span><span style="color:#719e07">.</span>new(path)<span style="color:#719e07">.</span>expand_path
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>  spec <span style="color:#719e07">=</span> <span style="color:#719e07">nil</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>  <span style="color:#719e07">case</span> path<span style="color:#719e07">.</span>extname
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span>  <span style="color:#719e07">when</span> <span style="color:#2aa198">&#39;.podspec&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span>    <span style="color:#cb4b16">Dir</span><span style="color:#719e07">.</span>chdir(path<span style="color:#719e07">.</span>parent<span style="color:#719e07">.</span>directory? ? path<span style="color:#719e07">.</span>parent : <span style="color:#cb4b16">Dir</span><span style="color:#719e07">.</span>pwd) <span style="color:#719e07">do</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span>     spec <span style="color:#719e07">=</span> <span style="color:#719e07">::</span><span style="color:#cb4b16">Pod</span><span style="color:#719e07">.</span>_eval_podspec(spec_contents, path)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span>     <span style="color:#719e07">unless</span> spec<span style="color:#719e07">.</span>is_a?(<span style="color:#cb4b16">Specification</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span>      <span style="color:#719e07">raise</span> <span style="color:#cb4b16">Informative</span>, <span style="color:#2aa198">&#34;Invalid podspec file at path `</span><span style="color:#2aa198">#{</span>path<span style="color:#2aa198">}</span><span style="color:#2aa198">`.&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span>     <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span>    <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span>  <span style="color:#719e07">when</span> <span style="color:#2aa198">&#39;.json&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28</span>    spec <span style="color:#719e07">=</span> <span style="color:#cb4b16">Specification</span><span style="color:#719e07">.</span>from_json(spec_contents)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29</span>  <span style="color:#719e07">else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30</span> 	 <span style="color:#719e07">raise</span> <span style="color:#cb4b16">Informative</span>, <span style="color:#2aa198">&#34;Unsupported specification format `</span><span style="color:#2aa198">#{</span>path<span style="color:#719e07">.</span>extname<span style="color:#2aa198">}</span><span style="color:#2aa198">` for spec at `</span><span style="color:#2aa198">#{</span>path<span style="color:#2aa198">}</span><span style="color:#2aa198">`.&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31</span>  <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33</span>  spec<span style="color:#719e07">.</span>defined_in_file <span style="color:#719e07">=</span> path
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">34</span>  spec<span style="color:#719e07">.</span>subspec_by_name(subspec_name, <span style="color:#719e07">true</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">35</span><span style="color:#719e07">end</span>
</code></pre></div><p>接着根据文件类型为 <code>.podspec</code> 和 <code>.json</code> 分别采用不同的解析方式。在  <strong>JSONSupport</strong> 模块内将 <code>#from_json</code> 的逻辑拆成了两部分：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#586e75"># `lib/cocoapods-core/specification/json.rb`</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span style="color:#719e07">module</span> Pod
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>  <span style="color:#719e07">class</span> <span style="color:#268bd2">Specification</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>    <span style="color:#719e07">module</span> JSONSupport
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>      <span style="color:#586e75"># ①</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>      <span style="color:#719e07">def</span> <span style="color:#268bd2">self</span><span style="color:#719e07">.</span><span style="color:#268bd2">from_json</span>(json)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>        <span style="color:#b58900">require</span> <span style="color:#2aa198">&#39;json&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>        <span style="color:#b58900">hash</span> <span style="color:#719e07">=</span> <span style="color:#cb4b16">JSON</span><span style="color:#719e07">.</span>parse(json)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>        from_hash(<span style="color:#b58900">hash</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>      <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>  <span style="color:#586e75"># ②</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>      <span style="color:#719e07">def</span> <span style="color:#268bd2">self</span><span style="color:#719e07">.</span><span style="color:#268bd2">from_hash</span>(<span style="color:#b58900">hash</span>, parent <span style="color:#719e07">=</span> <span style="color:#719e07">nil</span>, <span style="color:#2aa198">test_specification</span>: <span style="color:#719e07">false</span>, <span style="color:#2aa198">app_specification</span>: <span style="color:#719e07">false</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>        attributes_hash <span style="color:#719e07">=</span> <span style="color:#b58900">hash</span><span style="color:#719e07">.</span>dup
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>        spec <span style="color:#719e07">=</span> <span style="color:#cb4b16">Spec</span><span style="color:#719e07">.</span>new(parent, <span style="color:#719e07">nil</span>, test_specification, <span style="color:#2aa198">:app_specification</span> <span style="color:#719e07">=&gt;</span> app_specification)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>        subspecs <span style="color:#719e07">=</span> attributes_hash<span style="color:#719e07">.</span>delete(<span style="color:#2aa198">&#39;subspecs&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>        testspecs <span style="color:#719e07">=</span> attributes_hash<span style="color:#719e07">.</span>delete(<span style="color:#2aa198">&#39;testspecs&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>        appspecs <span style="color:#719e07">=</span> attributes_hash<span style="color:#719e07">.</span>delete(<span style="color:#2aa198">&#39;appspecs&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>        <span style="color:#586e75">## backwards compatibility with 1.3.0</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span>        spec<span style="color:#719e07">.</span>test_specification <span style="color:#719e07">=</span> <span style="color:#719e07">!</span>attributes_hash<span style="color:#719e07">[</span><span style="color:#2aa198">&#39;test_type&#39;</span><span style="color:#719e07">].</span>nil?
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span>    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span>        spec<span style="color:#719e07">.</span>attributes_hash <span style="color:#719e07">=</span> attributes_hash
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span>        spec<span style="color:#719e07">.</span>subspecs<span style="color:#719e07">.</span>concat(subspecs_from_hash(spec, subspecs, <span style="color:#719e07">false</span>, <span style="color:#719e07">false</span>))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span>        spec<span style="color:#719e07">.</span>subspecs<span style="color:#719e07">.</span>concat(subspecs_from_hash(spec, testspecs, <span style="color:#719e07">true</span>, <span style="color:#719e07">false</span>))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span>        spec<span style="color:#719e07">.</span>subspecs<span style="color:#719e07">.</span>concat(subspecs_from_hash(spec, appspecs, <span style="color:#719e07">false</span>, <span style="color:#719e07">true</span>))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span>    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span>        spec
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28</span>      <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29</span>  	  <span style="color:#586e75"># ③</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30</span>      <span style="color:#719e07">def</span> <span style="color:#268bd2">self</span><span style="color:#719e07">.</span><span style="color:#268bd2">subspecs_from_hash</span>(spec, subspecs, test_specification, app_specification)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31</span>        <span style="color:#719e07">return</span> <span style="color:#719e07">[]</span> <span style="color:#719e07">if</span> subspecs<span style="color:#719e07">.</span>nil?
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32</span>        subspecs<span style="color:#719e07">.</span>map <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>s_hash<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33</span>          <span style="color:#cb4b16">Specification</span><span style="color:#719e07">.</span>from_hash(s_hash, spec,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">34</span>                                  <span style="color:#2aa198">:test_specification</span> <span style="color:#719e07">=&gt;</span> test_specification,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">35</span>                                  <span style="color:#2aa198">:app_specification</span> <span style="color:#719e07">=&gt;</span> app_specification)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">36</span>        <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">37</span>      <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">38</span>  <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">39</span><span style="color:#719e07">end</span>
</code></pre></div><p>这里的逻辑也是比较简单：</p>
<p>①  将传入的字符串转换为 json；
② 将转换后的 json 转换为 <code>Spec</code> 对象并将 json 转换为 <code>attributes_hash</code>，同时触发 ③；
③ 通过 <code>self.subspecs_from_hash</code> 实现递归调用完成 <code>subspecs</code> 解析；</p>
<blockquote>
<p>Tips: 方法 ② 里的 <strong>Spec</strong> 是对 <code>Specification</code> 的别名。</p>
</blockquote>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/fm3xhI5jZidwvuP.png" alt="04-podspec-from-json"></p>
<h2 id="podspec-from-ruby">PodSpec From Ruby</h2>
<p><code>QMUIKit.podspec</code> 的文件内容，大家是否注意到其开头的声明：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span style="color:#cb4b16">Pod</span><span style="color:#719e07">::</span><span style="color:#cb4b16">Spec</span><span style="color:#719e07">.</span>new <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>s<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>  s<span style="color:#719e07">.</span>name             <span style="color:#719e07">=</span> <span style="color:#2aa198">&#34;QMUIKit&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>  s<span style="color:#719e07">.</span>source_files     <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;QMUIKit/QMUIKit.h&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span>  <span style="color:#586e75"># ...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span style="color:#719e07">end</span>
</code></pre></div><p>发现没 <code>.podspec</code> 文件就是<strong>简单直接地声明了一个 <code>Specifiction</code> 对象</strong>，然后通过 block 块定制来完成配置。像 <code>name</code>、<code>source_files</code> 这些配置参数最终都会转换为方法调用并将值存入 <code>attributes_hash</code> 中。这些方法调用的实现方式分两种：</p>
<ol>
<li>大部分配置是通过方法包装器 <code>attribute</code> 和 <code>root_attribute</code> 来动态添加的 setter 方法；</li>
<li>对于复杂逻辑的配置则直接方法声明，如 <code>subspec</code> 、<code>dependency</code> 方法等（后续介绍)。</li>
</ol>
<h3 id="attribute-wrappter">attribute wrappter</h3>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#586e75"># `lib/cocoapods-core/specification/dsl.rb`</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span style="color:#719e07">module</span> Pod
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>   <span style="color:#719e07">class</span> <span style="color:#268bd2">Specification</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>      <span style="color:#719e07">module</span> DSL
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>         <span style="color:#719e07">extend</span> <span style="color:#cb4b16">Pod</span><span style="color:#719e07">::</span><span style="color:#cb4b16">Specification</span><span style="color:#719e07">::</span><span style="color:#cb4b16">DSL</span><span style="color:#719e07">::</span><span style="color:#cb4b16">AttributeSupport</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>         <span style="color:#586e75"># Deprecations must be required after include AttributeSupport</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>         <span style="color:#b58900">require</span> <span style="color:#2aa198">&#39;cocoapods-core/specification/dsl/deprecations&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>         attribute <span style="color:#2aa198">:name</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>                   <span style="color:#2aa198">:required</span> <span style="color:#719e07">=&gt;</span> <span style="color:#719e07">true</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>                   <span style="color:#2aa198">:inherited</span> <span style="color:#719e07">=&gt;</span> <span style="color:#719e07">false</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>                   <span style="color:#2aa198">:multi_platform</span> <span style="color:#719e07">=&gt;</span> <span style="color:#719e07">false</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>         root_attribute <span style="color:#2aa198">:version</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>                        <span style="color:#2aa198">:required</span> <span style="color:#719e07">=&gt;</span> <span style="color:#719e07">true</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>         <span style="color:#586e75"># ...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>      <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>   <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span><span style="color:#719e07">end</span>
</code></pre></div><p>可以看出 name 和 version 的方法声明与普通的不太一样，其实 <code>attribute</code> 和 <code>root_attribute</code> 是通过 Ruby 的方法包装器来实现的，感兴趣的同学看这里 「<a href="https://github.com/mxchenxiaodong/haha_day/issues/3#">Python装饰器 与 Ruby实现</a>」。</p>
<blockquote>
<p>Tips: Ruby 原生提供的属性访问器 &mdash; <code>attr_accessor</code> 大家应该不陌生，就是通过包装器实现的。</p>
</blockquote>
<p>这些<strong>装饰器所声明的方法会在其模块被加载时动态生成</strong>，来看其实现：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#586e75"># `lib/cocoapods-core/specification/attribute_support.rb`</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span style="color:#719e07">module</span> Pod
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span> <span style="color:#719e07">class</span> <span style="color:#268bd2">Specification</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>   <span style="color:#719e07">module</span> DSL
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>     <span style="color:#719e07">class</span> <span style="color:#719e07">&lt;&lt;</span> <span style="color:#b58900">self</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>       <span style="color:#719e07">attr_reader</span> <span style="color:#2aa198">:attributes</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>     <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>     <span style="color:#719e07">module</span> AttributeSupport
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>         <span style="color:#719e07">def</span> <span style="color:#268bd2">root_attribute</span>(<span style="color:#b58900">name</span>, options <span style="color:#719e07">=</span> {})
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>             options<span style="color:#719e07">[</span><span style="color:#2aa198">:root_only</span><span style="color:#719e07">]</span> <span style="color:#719e07">=</span> <span style="color:#719e07">true</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>             options<span style="color:#719e07">[</span><span style="color:#2aa198">:multi_platform</span><span style="color:#719e07">]</span> <span style="color:#719e07">=</span> <span style="color:#719e07">false</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>             store_attribute(<span style="color:#b58900">name</span>, options)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>         <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>         <span style="color:#719e07">def</span> <span style="color:#268bd2">attribute</span>(<span style="color:#b58900">name</span>, options <span style="color:#719e07">=</span> {})
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>             store_attribute(<span style="color:#b58900">name</span>, options)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>         <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span>         <span style="color:#719e07">def</span> <span style="color:#268bd2">store_attribute</span>(<span style="color:#b58900">name</span>, options)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span>             <span style="color:#719e07">attr</span> <span style="color:#719e07">=</span> <span style="color:#cb4b16">Attribute</span><span style="color:#719e07">.</span>new(<span style="color:#b58900">name</span>, options)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span>             @attributes <span style="color:#719e07">||=</span> {}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span>             @attributes<span style="color:#719e07">[</span><span style="color:#b58900">name</span><span style="color:#719e07">]</span> <span style="color:#719e07">=</span> <span style="color:#719e07">attr</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span>         <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span>     <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span> <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span><span style="color:#719e07">end</span>
</code></pre></div><p><code>attribute</code> 和 <code>root_attribute</code> 最终都走到了 <code>store_attribute</code> 保存在创建的 Attribute 对象内，并以配置的 Symbol 名称作为 KEY 存入 <code>@attributes</code>，用于生成最终的 attributes setter 方法。</p>
<p>最关键的一步，让我们回到 <em>specification</em> 文件：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#586e75"># `/lib/coocapods-core/specification`</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span><span style="color:#719e07">module</span> Pod
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>   <span style="color:#719e07">class</span> <span style="color:#268bd2">Specification</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>     <span style="color:#586e75"># ...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>      <span style="color:#719e07">def</span> <span style="color:#268bd2">store_attribute</span>(<span style="color:#b58900">name</span>, value, platform_name <span style="color:#719e07">=</span> <span style="color:#719e07">nil</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>         <span style="color:#b58900">name</span> <span style="color:#719e07">=</span> <span style="color:#b58900">name</span><span style="color:#719e07">.</span>to_s
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>         value <span style="color:#719e07">=</span> <span style="color:#cb4b16">Specification</span><span style="color:#719e07">.</span>convert_keys_to_string(value) <span style="color:#719e07">if</span> value<span style="color:#719e07">.</span>is_a?(<span style="color:#cb4b16">Hash</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>         value <span style="color:#719e07">=</span> value<span style="color:#719e07">.</span>strip_heredoc<span style="color:#719e07">.</span>strip <span style="color:#719e07">if</span> value<span style="color:#719e07">.</span>respond_to?(<span style="color:#2aa198">:strip_heredoc</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>         <span style="color:#719e07">if</span> platform_name
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>             platform_name <span style="color:#719e07">=</span> platform_name<span style="color:#719e07">.</span>to_s
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>             attributes_hash<span style="color:#719e07">[</span>platform_name<span style="color:#719e07">]</span> <span style="color:#719e07">||=</span> {}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>             attributes_hash<span style="color:#719e07">[</span>platform_name<span style="color:#719e07">][</span><span style="color:#b58900">name</span><span style="color:#719e07">]</span> <span style="color:#719e07">=</span> value
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>         <span style="color:#719e07">else</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>             attributes_hash<span style="color:#719e07">[</span><span style="color:#b58900">name</span><span style="color:#719e07">]</span> <span style="color:#719e07">=</span> value
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>         <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>      <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>      <span style="color:#cb4b16">DSL</span><span style="color:#719e07">.</span>attributes<span style="color:#719e07">.</span>values<span style="color:#719e07">.</span>each <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>a<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span>         define_method(a<span style="color:#719e07">.</span>writer_name) <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>value<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span>             store_attribute(a<span style="color:#719e07">.</span>name, value)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span>         <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span>         <span style="color:#719e07">if</span> a<span style="color:#719e07">.</span>writer_singular_form
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span>             alias_method(a<span style="color:#719e07">.</span>writer_singular_form, a<span style="color:#719e07">.</span>writer_name)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span>         <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span>      <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28</span>   <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29</span><span style="color:#719e07">end</span>
</code></pre></div><p><code>Specification</code> 类被加载时，会先遍历 <code>DSL</code> module 加载后所保存的 attributes，再通过 <code>define_method</code> 动态生成对应的配置方法。最终数据还是保存在 <code>attributes_hash</code> 中。</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/9zpkhrngNCG87yT.png" alt="05-PodSpec-Load"></p>
<p><strong>Attribute</strong></p>
<p>Attribute 是为了记录该配置的相关信息，例如，记录 <code>Spec</code> 是否为根节点、<code>Spec</code> 类型、所支持的 platforms、资源地址通配符等。</p>
<ol>
<li>
<p>以 <code>root_attribute</code> 包装的配置仅用于修饰 <code>Spec</code> 根节点，比如版本号 <code>version</code> 只能由 <code>Spec</code> 根节点来设置，另外还有 <code>source</code>、<code>static_framework</code>、<code>module_name</code> 等；</p>
</li>
<li>
<p>以 <code>attribute</code> 包装的配置则不限是否为 <code>Spec</code> 根结点。我们以 AFNetworking 的 <code>source_files</code> 为例：由于在 macOS 和 watchOS 上并没有 UIKit framwork，因此它单独将 UIKit 的相关功能拆分到了 <code>AFNetworking/UIKit</code> 中；</p>
</li>
</ol>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#cb4b16">Pod</span><span style="color:#719e07">::</span><span style="color:#cb4b16">Spec</span><span style="color:#719e07">.</span>new <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>s<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>  <span style="color:#586e75"># ...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>  s<span style="color:#719e07">.</span>subspec <span style="color:#2aa198">&#39;NSURLSession&#39;</span> <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>ss<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>	 <span style="color:#586e75"># ...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>  <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>  s<span style="color:#719e07">.</span>subspec <span style="color:#2aa198">&#39;UIKit&#39;</span> <span style="color:#719e07">do</span> <span style="color:#719e07">|</span>ss<span style="color:#719e07">|</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>    ss<span style="color:#719e07">.</span>ios<span style="color:#719e07">.</span>deployment_target <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;9.0&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>    ss<span style="color:#719e07">.</span>tvos<span style="color:#719e07">.</span>deployment_target <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;9.0&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>    ss<span style="color:#719e07">.</span>dependency <span style="color:#2aa198">&#39;AFNetworking/NSURLSession&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>    ss<span style="color:#719e07">.</span>source_files <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;UIKit+AFNetworking&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>  <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span><span style="color:#719e07">end</span>
</code></pre></div><h3 id="subspec">#subspec</h3>
<p>除了 attribute 装饰器声明的 setter 方法，还有几个自定义的方法是直接通过 eval 调用的。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#719e07">def</span> <span style="color:#268bd2">subspec</span>(<span style="color:#b58900">name</span>, <span style="color:#719e07">&amp;</span>block)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>  subspec <span style="color:#719e07">=</span> <span style="color:#cb4b16">Specification</span><span style="color:#719e07">.</span>new(<span style="color:#b58900">self</span>, <span style="color:#b58900">name</span>, <span style="color:#719e07">&amp;</span>block)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>  @subspecs <span style="color:#719e07">&lt;&lt;</span> subspec
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>  subspec
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span><span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span><span style="color:#719e07">def</span> <span style="color:#268bd2">test_spec</span>(<span style="color:#b58900">name</span> <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;Tests&#39;</span>, <span style="color:#719e07">&amp;</span>block)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>  subspec <span style="color:#719e07">=</span> <span style="color:#cb4b16">Specification</span><span style="color:#719e07">.</span>new(<span style="color:#b58900">self</span>, <span style="color:#b58900">name</span>, <span style="color:#719e07">true</span>, <span style="color:#719e07">&amp;</span>block)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>  @subspecs <span style="color:#719e07">&lt;&lt;</span> subspec
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>  subspec
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span><span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span><span style="color:#719e07">def</span> <span style="color:#268bd2">app_spec</span>(<span style="color:#b58900">name</span> <span style="color:#719e07">=</span> <span style="color:#2aa198">&#39;App&#39;</span>, <span style="color:#719e07">&amp;</span>block)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>  appspec <span style="color:#719e07">=</span> <span style="color:#cb4b16">Specification</span><span style="color:#719e07">.</span>new(<span style="color:#b58900">self</span>, <span style="color:#b58900">name</span>, <span style="color:#2aa198">:app_specification</span> <span style="color:#719e07">=&gt;</span> <span style="color:#719e07">true</span>, <span style="color:#719e07">&amp;</span>block)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>  @subspecs <span style="color:#719e07">&lt;&lt;</span> appspec
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>  appspec
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span><span style="color:#719e07">end</span>
</code></pre></div><p>这三种不同类型的 <code>Subspec</code> 经 <code>eval</code> 转换为对应的 <code>Specification</code> 对象，注意这里初始化后都将 parent 节点指向 <strong>self</strong> 同时存入 <code>@subspecs</code> 数组中，完成 <code>SubSpec</code> 依赖链的构造。</p>
<h3 id="dependency">#dependency</h3>
<p>对于其他 <code>pod</code> 依赖的添加我们通过 dependency 方法来实现：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#719e07">def</span> <span style="color:#268bd2">dependency</span>(<span style="color:#719e07">*</span>args)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>   <span style="color:#b58900">name</span>, <span style="color:#719e07">*</span>version_requirements <span style="color:#719e07">=</span> args
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>   <span style="color:#586e75"># dependency args 有效性校验 ...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>   attributes_hash<span style="color:#719e07">[</span><span style="color:#2aa198">&#39;dependencies&#39;</span><span style="color:#719e07">]</span> <span style="color:#719e07">||=</span> {}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>   attributes_hash<span style="color:#719e07">[</span><span style="color:#2aa198">&#39;dependencies&#39;</span><span style="color:#719e07">][</span><span style="color:#b58900">name</span><span style="color:#719e07">]</span> <span style="color:#719e07">=</span> version_requirements
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>   <span style="color:#719e07">unless</span> whitelisted_configurations<span style="color:#719e07">.</span>nil?
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>   <span style="color:#586e75"># configuration 白名单过滤和校验 ...</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>   attributes_hash<span style="color:#719e07">[</span><span style="color:#2aa198">&#39;configuration_pod_whitelist&#39;</span><span style="color:#719e07">]</span> <span style="color:#719e07">||=</span> {}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span>   attributes_hash<span style="color:#719e07">[</span><span style="color:#2aa198">&#39;configuration_pod_whitelist&#39;</span><span style="color:#719e07">][</span><span style="color:#b58900">name</span><span style="color:#719e07">]</span> <span style="color:#719e07">=</span> whitelisted_configurations
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>   <span style="color:#719e07">end</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span><span style="color:#719e07">end</span>
</code></pre></div><p>dependency 方法内部主要是对依赖有效性的校验，限于篇幅这里不列出实现，核心要点如下：</p>
<ol>
<li><strong>检查依赖循环</strong>，根据 <code>Spec</code> 名称判断 <code>Spec</code> 与自身，<code>Spec</code> 与<code>SubSpec</code>之间是否存在循环依赖；</li>
<li><strong>检查依赖来源</strong>，<code>PodSpec</code> 中不支持 <code>:git</code> 或 <code>:path</code> 形式的来源指定，如需设定可通过 <code>Podfile</code> 来修改;</li>
<li><strong>检查 configuation 白名单</strong>，目前仅支持 Xcode 默认的 <code>Debug</code> 和 <code>Release</code> 的 configuration 配置；</li>
</ol>
<h1 id="创建并使用你的-pod">创建并使用你的 Pod</h1>
<p>最后一节来两个实践：创建 Pod 以及在项目中使用 <code>SubSpecs</code>。</p>
<h2 id="pod-创建">Pod 创建</h2>
<p>pod 相关使用官方都提供了很详尽的都文档，本小节仅做介绍。</p>
<h3 id="0x1-创建-pod">0x1 创建 Pod</h3>
<p>仅需一行命令完成 <code>Pod</code> 创建（<a href="https://guides.cocoapods.org/making/using-pod-lib-create.html">文档</a>）：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>$ pod lib create <span style="color:#586e75">`</span>NAME<span style="color:#586e75">`</span>
</code></pre></div><p>之后每一步都会输出友好提示，按照提示选择即可。在添加完 source code 和 dependency 之后，你还可以在 CocoaPods 为你提供的 Example 项目中运行和调试代码。</p>
<p>准备就绪后，可以通过以下命令进行校验，检查 <code>Pod</code> 正确性：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>$ pod lib lint <span style="color:#586e75">`</span><span style="color:#719e07">[</span>PODSPEC_PATHS ...<span style="color:#719e07">]</span><span style="color:#586e75">`</span>
</code></pre></div><h3 id="0x2-发布-pod">0x2 发布 Pod</h3>
<p>校验通过后就可以将 <code>Pod</code> 发布了，你可以将 <code>PodSepc</code> 发布到  Master Repo 上，或者发布到内部的 Spec Repo 上。</p>
<p><strong>CocoaPods Master Repo</strong></p>
<p>如果发布的 CocoaPods 的主仓库，那么需要通过 CocoaPods 提供的 <strong>Trunk</strong> 命令：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>$ pod trunk push <span style="color:#586e75">`</span><span style="color:#719e07">[</span>NAME.podspec<span style="color:#719e07">]</span><span style="color:#586e75">`</span>
</code></pre></div><p>不过使用前需要先通过邮箱注册，详情查看<a href="https://guides.cocoapods.org/making/getting-setup-with-trunk.html">文档</a>。</p>
<p><strong>Private Spec Repo</strong></p>
<p>对于发布到私有仓库的，可通过 CocoaPods 提供的 <strong>Repo</strong> 命令：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>$ pod repo push <span style="color:#586e75">`</span>REPO_NAME<span style="color:#586e75">`</span> <span style="color:#586e75">`</span>SPEC_NAME.podspec<span style="color:#586e75">`</span>
</code></pre></div><p>文档详情 &mdash; <a href="https://guides.cocoapods.org/making/private-cocoapods.html">传送门</a>。</p>
<h2 id="subspecs-in-podfile">SubSpecs In Podfile</h2>
<p>在 <code>SubSpec</code> 一节提到过，在 CocoaPods 中 <code>SubSpec</code> 是被作为单独的依赖来看待的，这里就借这个实操来证明一下。</p>
<p>在上文的实践中，我们知道每一个 <code>Pod</code> 库对应为 Xcode 项目中的一个个 target，那么当明确指定部分 <code>SubSpec</code> 时，它们也将被作为独立的 target 进行编译。不过这里需要明确一下使用场景：</p>
<h3 id="0x1-single-target">0x1 Single Target</h3>
<p>当主项目中仅有一个 target 或多个 target 引用了同一个 <code>pod</code> 库的多个不同 <code>SubSpec</code> 时，生成的 target 只会有一个。我们以 QMUIKit 为例，项目 Demo.project 下的 Podfile 配置如下：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>target <span style="color:#2aa198">&#39;Demo&#39;</span> <span style="color:#719e07">do</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>  pod <span style="color:#2aa198">&#39;QMUIKit/QMUIComponents/QMUILabel&#39;</span>, <span style="color:#2aa198">:path</span> <span style="color:#719e07">=&gt;</span> <span style="color:#2aa198">&#39;../QMUI_iOS&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span>  pod <span style="color:#2aa198">&#39;QMUIKit/QMUIComponents/QMUIButton&#39;</span>, <span style="color:#2aa198">:path</span> <span style="color:#719e07">=&gt;</span> <span style="color:#2aa198">&#39;../QMUI_iOS&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span style="color:#719e07">end</span>
</code></pre></div><p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/UvaHxjwkI8CofhZ.png" alt="06-podspec-single"></p>
<p>此时 <code>Pods.project</code> 下的 QMUIKit 的 target 名称为 <strong>QMUIKit</strong>。</p>
<h3 id="0x2-multiple-target">0x2 Multiple Target</h3>
<p>如果我们的主项目中存在多个 target 且使用同一个 <code>pod</code> 库的不同 <code>SubSpec</code> 时，结果则有所不同。</p>
<p>现在我们在 0x1 的基础上添加如下配置：</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span>target <span style="color:#2aa198">&#39;Demo2&#39;</span> <span style="color:#719e07">do</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span>	pod <span style="color:#2aa198">&#39;QMUIKit/QMUIComponents/QMUILog&#39;</span>, <span style="color:#2aa198">:path</span> <span style="color:#719e07">=&gt;</span> <span style="color:#2aa198">&#39;../QMUI_iOS&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span style="color:#719e07">end</span>
</code></pre></div><p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/OXEcuGNfoMHyJ6g.png" alt="07-podspec-mutil"></p>
<p>可以发现，CocoaPods 为每个 tareget 对应的 <code>SubSpec</code> 依赖生成了不同的 QMUIKit targets。</p>
<blockquote>
<p>Tips: 当主工程 target 依赖的 <code>Subspec</code> 数量过多导致的名称超过 50 个字符，将会对 subspec 后缀做摘要处理作为唯一标识符。</p>
</blockquote>
<h1 id="总结">总结</h1>
<p>本文是 CocoaPods-Core 的第二篇，重点介绍了 <code>PodSpec</code> 的类构成和解析实现，总结如下：</p>
<ol>
<li>初探 <code>PodSpec</code> 让我们对其能力边界和配置分类有了更好的了解；</li>
<li>深入 <code>PodSpec</code> 我们发现其数据结构同 <code>Podfile</code> 类似，都是根据依赖关系建立对应的树结构；</li>
<li><code>PodSpec</code> 针对单个库的源码和资源提供了更精细化的管理，<code>SubSpec</code> 结构的推出让大型 library 的内部分层提供了很好的工具；</li>
<li>装饰器模式结合 Ruby 的动态特性，让 <code>PodSpec</code> 的 DSL 特性的实现起来更加优雅；</li>
</ol>
<h1 id="知识点问题梳理">知识点问题梳理</h1>
<p>这里罗列了四个问题用来考察你是否已经掌握了这篇文章，如果没有建议你加入<strong>收藏</strong>再次阅读：</p>
<ol>
<li>说说 <code>PodSpec</code> 所支持的配置有几类，分别具有哪些功能 ？</li>
<li><code>PodSpec</code> 与 <code>SubSpec</code> 之间有哪些关系 ？</li>
<li>说说 <code>SubSpec</code> 的特点以及作用 ？</li>
<li>谈谈 <code>PodSpec</code> 中的 DSL 解析与 <code>Podfile</code> 的解析实现有哪些区别 ？</li>
</ol>
</section>

  
  
  <footer class="post-tags">
     
    <a href="https://looseyi.github.io/tags/cocoapods">CocoaPods</a>
     
    <a href="https://looseyi.github.io/tags/ios">iOS</a>
     
    <a href="https://looseyi.github.io/tags/ruby">Ruby</a>
    
  </footer>
  

  
  
  
  <nav class="post-nav">
    
    <a class="prev" href="https://looseyi.github.io/post/sourcecode-cocoapods/06-cocoapods-source/"><span>←</span><span>6. PodSpec 管理策略</span></a>
     
    <a class="next" href="https://looseyi.github.io/post/sourcecode-cocoapods/04-cocoapods-podfile/"><span>4. Podfile 的解析逻辑</span><span>→</span></a>
    
  </nav>
  

  
  
</article>


			

  

  
    <script src="https://utteranc.es/client.js"
            repo="looseyi/looseyi.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

		</main>

    <footer class="footer">
  <p>&copy; 2021 <a href="https://looseyi.github.io/">Aha Edmond</a></p>
  <p>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>️</p>
  <p>
    <a href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank">Paper 5.1</a>
  </p>
</footer>

		


  </body>
</html>
