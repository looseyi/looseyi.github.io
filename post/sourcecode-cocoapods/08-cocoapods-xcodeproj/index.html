<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>8. Xcode å·¥ç¨‹æ–‡ä»¶è§£æ - </title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="åœŸåœŸEdmondæœ¨" /><meta name="description" content="å¼•å­ åœ¨ã€ŒMolinillo ä¾èµ–æ ¡éªŒã€é€šè¿‡åï¼ŒCocoaPods ä¼šæ ¹æ®ç¡®å®šçš„ PodSpec ä¸‹è½½å¯¹åº”çš„æºä»£ç å’Œèµ„æºï¼Œå¹¶ä¸ºæ¯ä¸ª PodSpec ç”Ÿæˆå¯¹åº”çš„ Xcode Targetã€‚æœ¬æ–‡" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.82.1 with theme even" />


<link rel="canonical" href="http://looseyi.github.io/post/sourcecode-cocoapods/08-cocoapods-xcodeproj/" />
  <link href="http://looseyi.github.io/post/sourcecode-cocoapods/08-cocoapods-xcodeproj/index.xml" rel="alternate" type="application/rss+xml" title="" />
  <link href="http://looseyi.github.io/post/sourcecode-cocoapods/08-cocoapods-xcodeproj/index.xml" rel="feed" type="application/rss+xml" title="" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="8. Xcode å·¥ç¨‹æ–‡ä»¶è§£æ" />
<meta property="og:description" content="å¼•å­ åœ¨ã€ŒMolinillo ä¾èµ–æ ¡éªŒã€é€šè¿‡åï¼ŒCocoaPods ä¼šæ ¹æ®ç¡®å®šçš„ PodSpec ä¸‹è½½å¯¹åº”çš„æºä»£ç å’Œèµ„æºï¼Œå¹¶ä¸ºæ¯ä¸ª PodSpec ç”Ÿæˆå¯¹åº”çš„ Xcode Targetã€‚æœ¬æ–‡" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://looseyi.github.io/post/sourcecode-cocoapods/08-cocoapods-xcodeproj/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-05-16T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-05-16T00:00:00&#43;00:00" />

<meta itemprop="name" content="8. Xcode å·¥ç¨‹æ–‡ä»¶è§£æ">
<meta itemprop="description" content="å¼•å­ åœ¨ã€ŒMolinillo ä¾èµ–æ ¡éªŒã€é€šè¿‡åï¼ŒCocoaPods ä¼šæ ¹æ®ç¡®å®šçš„ PodSpec ä¸‹è½½å¯¹åº”çš„æºä»£ç å’Œèµ„æºï¼Œå¹¶ä¸ºæ¯ä¸ª PodSpec ç”Ÿæˆå¯¹åº”çš„ Xcode Targetã€‚æœ¬æ–‡"><meta itemprop="datePublished" content="2021-05-16T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2021-05-16T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="6857">
<meta itemprop="keywords" content="CocoaPods,iOS,Ruby," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="8. Xcode å·¥ç¨‹æ–‡ä»¶è§£æ"/>
<meta name="twitter:description" content="å¼•å­ åœ¨ã€ŒMolinillo ä¾èµ–æ ¡éªŒã€é€šè¿‡åï¼ŒCocoaPods ä¼šæ ¹æ®ç¡®å®šçš„ PodSpec ä¸‹è½½å¯¹åº”çš„æºä»£ç å’Œèµ„æºï¼Œå¹¶ä¸ºæ¯ä¸ª PodSpec ç”Ÿæˆå¯¹åº”çš„ Xcode Targetã€‚æœ¬æ–‡"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Aha Moment</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Aha Moment</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">8. Xcode å·¥ç¨‹æ–‡ä»¶è§£æ</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-05-16 </span>
        <div class="post-category">
            <a href="/categories/ios/"> iOS </a>
            <a href="/categories/cocoapods/"> CocoaPods </a>
            </div>
          <span class="more-meta"> çº¦ 6857 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 14 åˆ†é’Ÿ </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#xcworkspace">xcworkspace</a></li>
    <li><a href="#xcodeproj">xcodeproj</a>
      <ul>
        <li><a href="#property-list">Property List</a></li>
        <li><a href="#projectpbxproj">project.pbxproj</a></li>
        <li><a href="#xcode-object-identifiers">Xcode Object Identifiers</a></li>
        <li><a href="#xcode-object">Xcode Object</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#project-è§£æ">Project è§£æ</a></li>
    <li><a href="#object-module">Object Module</a>
      <ul>
        <li><a href="#abstractobject">AbstractObject</a></li>
        <li><a href="#const-accessor">Const Accessor</a></li>
      </ul>
    </li>
    <li><a href="#object-attributes">Object Attributes</a>
      <ul>
        <li><a href="#abstractobjectattribute">AbstractObjectAttribute</a></li>
        <li><a href="#attribute">Attribute</a></li>
      </ul>
    </li>
    <li><a href="#xcode-object-1">Xcode Object</a>
      <ul>
        <li><a href="#pbxfilereference">PBXFileReference</a></li>
        <li><a href="#pbxgroup">PBXGroup</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#ä¸º-xcode-å·¥ç¨‹æ·»åŠ æ–‡ä»¶">ä¸º Xcode å·¥ç¨‹æ·»åŠ æ–‡ä»¶</a>
      <ul>
        <li><a href="#0x01-æ·»åŠ æºæ–‡ä»¶">0x01 æ·»åŠ æºæ–‡ä»¶</a></li>
        <li><a href="#0x02-æ·»åŠ ç¼–è¯‘ä¾èµ–">0x02 æ·»åŠ ç¼–è¯‘ä¾èµ–</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/10-xcode-project-src.png" alt="10-xcode-project-src"></p>
<h1 id="å¼•å­">å¼•å­</h1>
<p>åœ¨ã€Œ<a href="https://zhuanlan.zhihu.com/p/355415807"><strong>Molinillo ä¾èµ–æ ¡éªŒ</strong></a>ã€é€šè¿‡åï¼ŒCocoaPods ä¼šæ ¹æ®ç¡®å®šçš„ PodSpec ä¸‹è½½å¯¹åº”çš„æºä»£ç å’Œèµ„æºï¼Œå¹¶ä¸ºæ¯ä¸ª PodSpec ç”Ÿæˆå¯¹åº”çš„ Xcode Targetã€‚æœ¬æ–‡é‡ç‚¹å°±æ¥èŠèŠ Xcode Project çš„å†…å®¹æ„æˆï¼Œä»¥åŠ <a href="https://github.com/CocoaPods/Xcodeproj">xcodeproj</a> æ˜¯å¦‚æœç»„ç»‡ Xcode Project å†…å®¹çš„ã€‚</p>
<h1 id="xcode-å·¥ç¨‹æ–‡ä»¶">Xcode å·¥ç¨‹æ–‡ä»¶</h1>
<p>æ—©åœ¨å‰æ–‡ã€Œ<a href="https://zhuanlan.zhihu.com/p/248308670"><strong>Podfile çš„è§£æé€»è¾‘</strong></a>ã€ä¸­ï¼Œæˆ‘ä»¬ç®€å•ä»‹ç»è¿‡ <strong>Xcode çš„å·¥ç¨‹ç»“æ„ï¼šWorkspaceã€Projectã€Target åŠ Build Setting</strong> ç­‰ã€‚</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/00-xcode-project-struct.png" alt="04-workspace"></p>
<p>æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹è¿™äº›æ•°æ®åœ¨ Xcode ä¸­æ˜¯å¦‚ä½•è¡¨ç¤ºï¼Œäº†è§£è¿™äº›ç»“æ„æ‰èƒ½æ–¹ä¾¿æˆ‘ä»¬ç†è§£ xcodeproj çš„ä»£ç è®¾è®¡æ€è·¯ã€‚</p>
<h2 id="xcworkspace">xcworkspace</h2>
<p>æ—©åœ¨ Xcode 4 ä¹‹å‰å°±å‡ºç° workspace bundle äº†ï¼Œåªæ˜¯é‚£ä¼š workspace ä»å†…åµŒäº <code>.xcodeproj</code> ä¸­ã€‚Xcode 4 ä¹‹åï¼Œæˆ‘ä»¬æ‰å¯¹ workspace å•ç‹¬å¯è§ã€‚è®©æˆ‘ä»¬æ–°å»ºä¸€ä¸ª Test.xcodeproj é¡¹ç›®ï¼Œæ¥çœ‹çœ‹å…¶ç›®å½•ç»“æ„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">Test.xcodeproj
â”œâ”€â”€ project.pbxproj
â”œâ”€â”€ project.xcworkspace
â”‚Â Â  â”œâ”€â”€ contents.xcworkspacedata
â”‚Â Â  â””â”€â”€ xcuserdata
â”‚Â Â      â””â”€â”€ edmond.xcuserdatad
â”‚Â Â          â””â”€â”€ UserInterfaceState.xcuserstate
â””â”€â”€ xcuserdata
    â””â”€â”€ edmond.xcuserdatad
        â””â”€â”€ xcschemes
            â””â”€â”€ xcschememanagement.plist
</code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥å‘ç° <code>Test.xcodeproj</code> bundle å†…åŒ…å« <code>project.workspace</code>ã€‚è€Œå½“æˆ‘ä»¬é€šè¿‡ <code>pod install</code> å‘½ä»¤æˆåŠŸæ·»åŠ  Pod ä¾èµ–åï¼ŒXcode å·¥ç¨‹ç›®å½•ä¸‹ä¼šå¤šå‡º <code>Test.workspace</code>ï¼Œå®ƒæ˜¯ Xcodeproj æ›¿æˆ‘ä»¬ç”Ÿæˆçš„ï¼Œç”¨äºç®¡ç†å½“å‰çš„ <code>Test.project</code> ä¸ <code>Pods.pbxproj</code>ã€‚æ–°å»ºçš„ workspace ç›®å½•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">Test.xcworkspace
â””â”€â”€ contents.xcworkspacedata
</code></pre></td></tr></table>
</div>
</div><p>ç”Ÿæˆçš„ workspace æ–‡ä»¶å¤¹å†…éƒ¨åªåŒ…å«äº† <code>contents.xcworkspacedata</code>ï¼Œä¸º xml æ ¼å¼çš„å†…å®¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;Workspace</span>
   <span class="na">version =</span> <span class="s">&#34;1.0&#34;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;FileRef</span>
      <span class="na">location =</span> <span class="s">&#34;group:Test.xcodeproj&#34;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;/FileRef&gt;</span>
   <span class="nt">&lt;FileRef</span>
      <span class="na">location =</span> <span class="s">&#34;group:Pods/Pods.xcodeproj&#34;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;/FileRef&gt;</span>
<span class="nt">&lt;/Workspace&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨æ ‡ç­¾ Workspace ä¸‹å£°æ˜äº†ä¸¤ä¸ª <code>FileRef</code> å…¶åœ°å€åˆ†åˆ«æŒ‡å‘äº† <code>Test.xcodeproj</code> å’Œ <code>Pods.xcodeproj</code>ã€‚è¿™é‡Œæ³¨æ„çš„æ˜¯ <code>FileRef</code> å±æ€§çš„å€¼ä½¿ç”¨å‰ç¼€ <code>group + path</code> æ¥ä¿®é¥°çš„ï¼Œè€Œå†…åµŒçš„ <code>project.xcworkspace</code>ï¼Œä½¿ç”¨ <code>self</code> ä½œä¸ºå‰ç¼€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;Workspace</span>
   <span class="na">version =</span> <span class="s">&#34;1.0&#34;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;FileRef</span>
      <span class="na">location =</span> <span class="s">&#34;self:&#34;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;/FileRef&gt;</span>
<span class="nt">&lt;/Workspace&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>å¦å¤–ï¼Œå½“æˆ‘ä»¬ç”¨ Xcode æ‰“å¼€é¡¹ç›®åï¼Œèƒ½å‘ç° workspace ç›®å½•ä¸‹ä¼šè‡ªåŠ¨ç”Ÿæˆ <code>xcuserdata</code> ç›®å½•ï¼Œå®ƒç”¨äºä¿å­˜ç”¨æˆ·çš„ Xcode é…ç½®ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li><code>UserInterfaceState.xcuserstate</code>ï¼šä»¥äºŒè¿›åˆ¶çš„ Plist ä¿å­˜ï¼Œç”¨äºè®°å½•çª—å£å¸ƒå±€ç­‰ä¸ªæ€§åŒ–è®¾ç½®ã€‚</li>
<li><code>xcdebugger</code>ï¼šè®°å½•å„ç§æ–­ç‚¹æ•°æ®ã€‚</li>
</ul>
<p>è¿™ä¹Ÿæ˜¯åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé€‰æ‹©å°† <code>xcuserdata</code> ç›®å½• ignore æ‰çš„åŸå› ã€‚</p>
<h2 id="xcodeproj">xcodeproj</h2>
<p>ä¸ <code>.xcworkspace</code> ç±»ä¼¼ <code>.xcodeproj</code> åŒä¸º Xcode å·¥ç¨‹é…ç½®çš„ bundleï¼Œæ¥ä¸‹æ¥é‡ç‚¹å±•å¼€ <code>project.pbxproj</code>ï¼Œå®ƒè®°å½•äº† Xcode å·¥ç¨‹çš„å„é¡¹é…ç½®ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ—§é£æ ¼çš„ Plist æ–‡ä»¶ã€‚</p>
<h3 id="property-list">Property List</h3>
<p>Plist è¢«è®¾è®¡ä¸ºäººç±»å¯è¯»çš„ã€å¯ä»¥æ‰‹å·¥ä¿®æ”¹çš„æ ¼å¼ï¼Œæ•…é‡‡ç”¨äº†ç±»ä¼¼äºç¼–ç¨‹è¯­è¨€çš„è¯­æ³•å°†æ•°æ®åºåˆ—åŒ–ä¸ºASCIIæ•°æ®ã€‚Plist æœ€æ—©å¯è¿½æº¯åˆ° NeXTSTEP æ—¶æœŸï¼Œç”±äºå†å²åŸå› ï¼Œç›®å‰å®ƒæ”¯æŒå¤šç§æ ¼å¼ï¼Œstringã€binaryã€arrayã€dictionary ç­‰ç±»å‹æ•°æ®ã€‚ç›¸æ¯”äº JSONï¼ŒPlist è¿˜æ”¯æŒäºŒè¿›åˆ¶æ•°æ®çš„è¡¨ç¤ºï¼Œä»¥ <code>&lt;&gt;</code> ä¿®é¥°æ–‡æœ¬å½¢å¼çš„åå…­è¿›åˆ¶æ•°ï¼Œå…¶ä¸­å­—å…¸ä¸æ•°ç»„çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">Arrayï¼š</span>
<span class="err">plist</span> <span class="err">=&gt;</span> <span class="err">(</span> <span class="s2">&#34;1&#34;</span><span class="err">,</span> <span class="s2">&#34;2&#34;</span><span class="err">,</span> <span class="s2">&#34;3&#34;</span> <span class="err">)</span>
<span class="err">json</span> <span class="err">=&gt;</span> <span class="p">[</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span> <span class="s2">&#34;2&#34;</span><span class="p">,</span> <span class="s2">&#34;3&#34;</span> <span class="p">]</span>

<span class="err">Dictionaryï¼š</span>
<span class="err">plist</span> <span class="err">=&gt;</span> <span class="p">{</span> <span class="nt">&#34;key&#34;</span> <span class="err">=</span> <span class="s2">&#34;value&#34;</span><span class="err">;</span> <span class="err">...</span> <span class="p">}</span>
<span class="err">json</span> <span class="err">=&gt;</span> <span class="p">{</span> <span class="nt">&#34;key&#34;</span> <span class="p">:</span> <span class="s2">&#34;value&#34;</span><span class="p">,</span> <span class="err">...</span> <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å¤„ç† Plist æ–‡ä»¶å¯ä½¿ç”¨ Unix æä¾›çš„ <code>plutil</code> å·¥å…·ã€‚ æ¯”å¦‚å°† Plist æ–‡ä»¶è½¬æˆ XML æ ¼å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">plutil -convert xml1 -s -r -o project.pbxproj.xml project.pbxproj
</code></pre></td></tr></table>
</div>
</div><p><code>-convert fmt</code> é€‰é¡¹æ”¯æŒè½¬æ¢çš„æ ¼å¼æœ‰ï¼šxml1ã€binary1ã€jsonã€swiftã€jsonã€‚</p>
<h3 id="projectpbxproj">project.pbxproj</h3>
<p><strong>pbxproj æ–‡ä»¶å…¨ç§°ä¸º Project Builder Xcode Project</strong>ï¼Œå…‰çœ‹ç¬¬ä¸€å±‚å…ƒæ•°æ®æ¯”è¾ƒç®€å•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">//</span> <span class="err">!$*UTF</span><span class="mi">8</span><span class="err">*$!</span>
<span class="p">{</span>
	<span class="err">archiveVersion</span> <span class="err">=</span> <span class="err">1;</span>
	<span class="err">classes</span> <span class="err">=</span> <span class="err">{</span>
	<span class="p">}</span><span class="err">;</span>
	<span class="err">objectVersion</span> <span class="err">=</span> <span class="mi">50</span><span class="err">;</span>
	<span class="err">objects</span> <span class="err">=</span> <span class="p">{</span>
		<span class="err">...</span>
   <span class="p">}</span><span class="err">;</span>
	<span class="err">rootObject</span> <span class="err">=</span> <span class="mi">8528</span><span class="err">A</span><span class="mi">0</span><span class="err">D</span><span class="mi">92651</span><span class="err">F</span><span class="mi">281005</span><span class="err">BEBA</span><span class="mi">5</span> <span class="err">/*</span> <span class="err">Project</span> <span class="err">object</span> <span class="err">*/;</span>
<span class="err">}</span>
</code></pre></td></tr></table>
</div>
</div><p>æ–‡ä»¶ä»¥æ˜ç¡®çš„ç¼–ç ä¿¡æ¯å¼€å¤´ï¼Œ<code>archiveVersion</code> é€šå¸¸ä¸º 1ï¼Œè¡¨ç¤ºåºåˆ—åŒ–çš„ç‰ˆæœ¬å·ï¼›<code>classes</code> åˆ™ä¼¼ä¹ä¸€ç›´ä¸ºç©ºï¼›<code>objectVersion</code> è¡¨ç¤ºæ‰€å…¼å®¹çš„æœ€ä½ç‰ˆæœ¬çš„ Xcodeï¼Œè¯¥æ•°å­—ä¸ Xcode çš„ç‰ˆæœ¬å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="mi">53</span> <span class="o">=&gt;</span> <span class="s1">&#39;Xcode 11.4&#39;</span><span class="p">,</span>
<span class="mi">52</span> <span class="o">=&gt;</span> <span class="s1">&#39;Xcode 11.0&#39;</span><span class="p">,</span>
<span class="mi">51</span> <span class="o">=&gt;</span> <span class="s1">&#39;Xcode 10.0&#39;</span><span class="p">,</span>
<span class="mi">50</span> <span class="o">=&gt;</span> <span class="s1">&#39;Xcode 9.3&#39;</span><span class="p">,</span>
<span class="mi">48</span> <span class="o">=&gt;</span> <span class="s1">&#39;Xcode 8.0&#39;</span><span class="p">,</span>
<span class="mi">47</span> <span class="o">=&gt;</span> <span class="s1">&#39;Xcode 6.3&#39;</span><span class="p">,</span>
<span class="mi">46</span> <span class="o">=&gt;</span> <span class="s1">&#39;Xcode 3.2&#39;</span><span class="p">,</span>
<span class="mi">45</span> <span class="o">=&gt;</span> <span class="s1">&#39;Xcode 3.1&#39;</span><span class="p">,</span>
</code></pre></td></tr></table>
</div>
</div><p><code>rootObject</code> è®°å½•çš„ 16 è¿›åˆ¶æ•°å­—ï¼Œä¸º project å¯¹è±¡çš„ç´¢å¼•ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç§°å…¶ä¸º Xcode Object Identifierï¼Œpbxproj ä¸­çš„æ¯ä¸ª Xcode Object åˆ›å»ºæ—¶ï¼Œéƒ½ä¼šç”Ÿæˆå¯¹åº”å”¯ä¸€æ ‡è¯†æ•°å­—ï¼Œè€Œä¸Šé¢çš„ <code>objects</code> å­—å…¸åˆ™è®°å½•äº†æ•´ä¸ª Xcode é¡¹ç›®çš„æ‰€æœ‰ Xcode Objectã€‚</p>
<h3 id="xcode-object-identifiers">Xcode Object Identifiers</h3>
<p>Xcode Object Identifier æ˜¯ç”¨ 24 ä½çš„ 16 è¿›åˆ¶å­—ç¬¦è¡¨ç¤ºï¼Œæˆ‘ä»¬æš‚ä¸”ç§°å…¶ä¸º GUIDã€‚</p>
<blockquote>
<p>âš ï¸ æ³¨æ„è¿™å¹¶ä¸æ„å‘³ç€å®ƒä¸å…¶ä»–ç§°ä¸º GUID çš„å…¶ä»–äº‹ç‰©ç›¸ä¼¼ã€‚</p>
</blockquote>
<p>ç”Ÿæˆçš„ GUID ä¸ä»…åœ¨é¡¹ç›®æ–‡ä»¶ä¸­å¿…é¡»å”¯ä¸€ï¼Œå¹¶ä¸”åœ¨ Xcode ä¸­åŒæ—¶æ‰“å¼€çš„å…¶ä»–é¡¹ç›®æ–‡ä»¶ä¸­ä¹Ÿå¿…é¡»å”¯ä¸€ï¼Œå³<strong>è·¨å·¥ç¨‹å”¯ä¸€æ€§</strong>ã€‚åªæœ‰è¿™æ ·èƒ½é¿å…äº†å¤šäººåˆä½œä¸­ï¼ŒåŒæ—¶æ–°å¢æˆ–ç¼–è¾‘å·¥ç¨‹æ–‡ä»¶å¸¦æ¥çš„é—®é¢˜ã€‚è¿™å…¶å®æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç«äº‰éœ€æ±‚ï¼Œæœ‰å…´è¶£çš„å¯ä»¥æŸ¥çœ‹ <a href="https://github.com/premake/premake-core">Premake</a> è¿™ä¸ªé¡¹ç›®ï¼Œå®ƒèƒ½ä¿è¯é‡æ–°ç”Ÿæˆçš„é¡¹ç›®å…·æœ‰ç›¸åŒçš„ GUIDã€‚</p>
<p>å¯¹äº Xcode ä½¿ç”¨çš„ GUID ç®—æ³•å¯å‚è€ƒ <a href="https://pewpewthespells.com/blog/pbxproj_identifiers.html">PBXProj Identifers</a>ï¼Œå®ƒæ˜¯é€šè¿‡é€†å‘ <code>DevToolsCore.framework</code> è·å–çš„ï¼Œä»ä¸­å¯ä»¥çª¥è§ GUID çš„ç”Ÿæˆéœ€è¦ä¾èµ– ğŸ‘‡ è¿™äº›æ•°æ®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="k">struct</span> <span class="n">globalidentifier</span> <span class="p">{</span>
    <span class="n">int8_t</span> <span class="n">user</span><span class="p">;</span>            <span class="c1">// encoded username
</span><span class="c1"></span>    <span class="n">int8_t</span> <span class="n">pid</span><span class="p">;</span>             <span class="c1">// encoded current pid #
</span><span class="c1"></span>    <span class="n">int16_t</span> <span class="n">_random</span><span class="p">;</span>        <span class="c1">// encoded random value
</span><span class="c1"></span>    <span class="n">int32_t</span> <span class="n">_time</span><span class="p">;</span>          <span class="c1">// encoded time value
</span><span class="c1"></span>    <span class="n">int8_t</span> <span class="n">zero</span><span class="p">;</span>            <span class="c1">// zero
</span><span class="c1"></span>    <span class="n">int8_t</span> <span class="n">host_shift</span><span class="p">;</span>      <span class="c1">// encoded, shifted hostid
</span><span class="c1"></span>    <span class="n">int8_t</span> <span class="n">host_h</span><span class="p">;</span>          <span class="c1">// high byte of lower bytes of hostid
</span><span class="c1"></span>    <span class="n">int8_t</span> <span class="n">host_l</span><span class="p">;</span>          <span class="c1">// low byte of lower bytes of hostid
</span><span class="c1"></span><span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>  <span class="c1">// packed, so we always have a length of 12 bytes
</span></code></pre></td></tr></table>
</div>
</div><h3 id="xcode-object">Xcode Object</h3>
<p>Xcode Object æ˜¯æŒ‡æ‰€æœ‰è®°å½•åœ¨ <code>objects</code> å­—å…¸ä¸­çš„å¯¹è±¡ (åç»­ç®€ç§°ä¸º Object)ï¼Œå†…éƒ¨ä»¥ <code>isa</code> æ¥æ ‡è¯†ç±»å‹ã€‚åŒæ—¶Xcode æŒ‰ <code>isa</code> ç±»å‹åˆ’åˆ†å‡ºè‹¥å¹² sectionï¼Œä»¥æ³¨é‡Šçš„æ–¹å¼åˆ†èŠ‚ã€‚</p>
<p>ä»¥ <code>PBXProject</code> ä¸ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">/*</span> <span class="err">Begin</span> <span class="err">PBXProject</span> <span class="err">section</span> <span class="err">*/</span>
   <span class="mi">8528</span><span class="err">A</span><span class="mi">0</span><span class="err">D</span><span class="mi">92651</span><span class="err">F</span><span class="mi">281005</span><span class="err">BEBA</span><span class="mi">5</span> <span class="err">/*</span> <span class="err">Project</span> <span class="err">object</span> <span class="err">*/</span> <span class="err">=</span> <span class="p">{</span>
      <span class="err">isa</span> <span class="err">=</span> <span class="err">PBXProject;</span>
      <span class="err">...</span>
      <span class="err">mainGroup</span> <span class="err">=</span> <span class="err">8528A0D82651F281005BEBA5;</span>
      <span class="err">productRefGroup</span> <span class="err">=</span> <span class="err">8528A0E22651F281005BEBA5</span> <span class="err">/*</span> <span class="err">Products</span> <span class="err">*/;</span>
      <span class="err">projectDirPath</span> <span class="err">=</span> <span class="nt">&#34;&#34;</span><span class="err">;</span>
      <span class="err">projectRoot</span> <span class="err">=</span> <span class="s2">&#34;&#34;</span><span class="err">;</span>
      <span class="err">targets</span> <span class="err">=</span> <span class="err">(</span> 
         <span class="mi">8528</span><span class="err">A</span><span class="mf">0E02651</span><span class="err">F</span><span class="mi">281005</span><span class="err">BEBA</span><span class="mi">5</span> <span class="err">/*</span> <span class="err">Test</span> <span class="err">*/</span><span class="p">,</span>
      <span class="err">);</span>
   <span class="p">}</span><span class="err">;</span>
<span class="err">/*</span> <span class="err">End</span> <span class="err">PBXProject</span> <span class="err">section</span> <span class="err">*/</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œ <code>Project object</code> çš„ç´¢å¼•å€¼æ­£æ˜¯ <code>rootObject</code> è®°å½•çš„ <em>8528A0D92651F281005BEBA5</em>ï¼Œå…¶ <code>isa</code> ç±»å‹ä¸º <code>PBXProject</code>ï¼Œ<code>targets</code> æ•°ç»„è®°å½•äº†é¡¹ç›®éœ€è¦æ„å»ºçš„ä»»åŠ¡ï¼š<code>Test target</code>ã€‚æ•´ä¸ª PBXProject section å°±å®šä¹‰åœ¨ <code>objects</code> ä¸­ã€‚</p>
<p>Object ç±»å‹çš„å¼•ç”¨å…³ç³»å¤§è‡´å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/00-xcodte-project.png" alt="00-xcodte-project"></p>
<blockquote>
<p>å…³äº pbxproj å†… Object çš„è¯¦ç»†è¯´æ˜ï¼Œå¯å‚ç…§ <a href="http://www.monobjc.net/xcode-project-file-format.html">Xcode Project File Format</a>ã€‚</p>
</blockquote>
<ul>
<li>PBXProjectï¼šProject çš„è®¾ç½®ï¼Œç¼–è¯‘å·¥ç¨‹æ‰€éœ€ä¿¡æ¯</li>
<li>PBXNativeTargetï¼šTarget çš„è®¾ç½®</li>
<li>PBXTargetDependencyï¼š Target ä¾èµ–</li>
<li>PBXContainerItemProxyï¼šéƒ¨ç½²çš„å…ƒç´ </li>
<li>XCConfigurationListï¼šæ„å»ºé…ç½®ç›¸å…³ï¼ŒåŒ…å« project å’Œ target æ–‡ä»¶</li>
<li>XCBuildConfigurationï¼šç¼–è¯‘é…ç½®ï¼Œå¯¹åº” Xcode çš„ Build Setting å†…å®¹</li>
<li>PBXVariantGroupï¼šå›½é™…åŒ–å¯¹ç…§è¡¨æˆ– <code>.storyboard</code> æ–‡ä»¶</li>
<li>PBXBuildFileï¼šå„ç±»æ–‡ä»¶ï¼Œæœ€ç»ˆä¼šå…³è”åˆ° PBXFileReference</li>
<li>PBXFileReferenceï¼šæºç ã€èµ„æºã€åº“ï¼ŒInfo.plist ç­‰æ–‡ä»¶ç´¢å¼•</li>
<li>PBXGroupï¼šè™šæ‹Ÿæ–‡ä»¶å¤¹ï¼Œå¯åµŒå¥—ï¼Œè®°å½•ç®¡ç†çš„ PBXFileReference ä¸å­ PBXGroup</li>
<li>PBXSourcesBuildPhaseï¼šç¼–è¯‘æºæ–‡ä»¶ï¼ˆ.mã€.swiftï¼‰</li>
<li>PBXFrameworksBuildPhaseï¼šç”¨äº framework çš„æ„å»º</li>
<li>PBXResourcesBuildPhaseï¼šç¼–è¯‘èµ„æºæ–‡ä»¶ï¼Œæœ‰ xibã€storyboardã€plist ä»¥åŠ xcassets ç­‰èµ„æºæ–‡ä»¶</li>
</ul>
<h1 id="xcodeproj-1">Xcodeproj</h1>
<p><a href="https://github.com/CocoaPods/Xcodeproj">Xcodeproj</a> èƒ½å¤Ÿé€šè¿‡ Ruby æ¥åˆ›å»ºå’Œä¿®æ”¹ Xcode å·¥ç¨‹æ–‡ä»¶ï¼Œå…¶å†…éƒ¨å®Œæ•´æ˜ å°„äº† <code>project.pbxproj</code> çš„ Object ç±»å‹åŠå…¶å¯¹åº”çš„å±æ€§ï¼Œé™äºç¯‡å¹…æœ¬æ–‡ä¼šé‡ç‚¹ä»‹ç»å…³é”®çš„ Object å’Œè§£æé€»è¾‘ã€‚</p>
<h2 id="project-è§£æ">Project è§£æ</h2>
<p>ä¸ŠèŠ‚å†…å®¹å¯çŸ¥ï¼ŒXcode è§£æå·¥ç¨‹çš„æ˜¯ä¾æ¬¡æ£€æŸ¥ <code>*.xcworkspace</code> &gt; <code>*.xcproject</code> &gt; <code>project.pbxproj</code>ï¼Œæ ¹æ® <code>project.pbxproj</code> çš„æ•°æ®ç»“æ„ï¼ŒXcodeproj æä¾›äº† Project ç±»ï¼Œç”¨äºè®°å½•æ ¹å…ƒç´ ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Xcodeproj</span>
  <span class="k">class</span> <span class="nc">Project</span>
    <span class="c1"># object æ¨¡å—ï¼Œåé¢ä¼šæåˆ°</span>
    <span class="kp">include</span> <span class="no">Object</span>	
    <span class="o">...</span>
    <span class="c1"># åºåˆ—åŒ–æ—¶ project çš„æœ€ä½å…¼å®¹ç‰ˆæœ¬, ä¸ object_version å¯¹åº”</span>
    <span class="kp">attr_reader</span> <span class="ss">:archive_version</span>
    <span class="c1"># ä½œç”¨æœªçŸ¥</span>
    <span class="kp">attr_reader</span> <span class="ss">:classes</span>
    <span class="c1"># project æœ€ä½å…¼å®¹ç‰ˆæœ¬</span>
    <span class="kp">attr_reader</span> <span class="ss">:object_version</span>
    <span class="c1"># project æ‰€åŒ…å«çš„ objectsï¼Œç»“æ„ä¸º [Hash{String =&gt; AbstractObject}]</span>
    <span class="kp">attr_reader</span> <span class="ss">:objects_by_uuid</span>
    <span class="c1"># project çš„æ ¹ç»“ç‚¹ï¼Œå³ PBXProject</span>
    <span class="kp">attr_reader</span> <span class="ss">:root_object</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨ <code>pod install</code> çš„ä¾èµ–è§£æé˜¶æ®µï¼Œä¼šè¯»å– <code>project.pbxproj</code>ã€‚</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/01-resolve-dependencies.png" alt="01-resolve-dependencies"></p>
<p>æœ€ç»ˆåœ¨ <code>inspect_targets_to_integrate</code> æ–¹æ³•å†…æ‰“å¼€é¡¹ç›®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">inspect_targets_to_integrate</span>
  <span class="n">project</span> <span class="o">=</span> <span class="no">Xcodeproj</span><span class="o">::</span><span class="no">Project</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>
  <span class="o">...</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>ç»§ç»­çœ‹ <code>Xcodeproj::Project::open</code> å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># lib/xcproject/Project.rb</span>

<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="n">path</span> <span class="o">=</span> <span class="no">Pathname</span><span class="o">.</span><span class="n">pwd</span> <span class="o">+</span> <span class="n">path</span>
  <span class="k">unless</span> <span class="no">Pathname</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">exist?</span>
    <span class="k">raise</span> <span class="s2">&#34;[Xcodeproj] Unable to open `</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="s2">` because it doesn&#39;t exist.&#34;</span>
  <span class="k">end</span>
  <span class="n">project</span> <span class="o">=</span> <span class="kp">new</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span>
  <span class="n">project</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:initialize_from_file</span><span class="p">)</span>
  <span class="n">project</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">initialize_from_file</span>
  <span class="n">pbxproj_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;project.pbxproj&#39;</span>
  <span class="n">plist</span> <span class="o">=</span> <span class="no">Plist</span><span class="o">.</span><span class="n">read_from_path</span><span class="p">(</span><span class="n">pbxproj_path</span><span class="o">.</span><span class="n">to_s</span><span class="p">)</span>
  <span class="n">root_object</span><span class="o">.</span><span class="n">remove_referrer</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">root_object</span>
  <span class="vi">@root_object</span>     <span class="o">=</span> <span class="n">new_from_plist</span><span class="p">(</span><span class="n">plist</span><span class="o">[</span><span class="s1">&#39;rootObject&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">plist</span><span class="o">[</span><span class="s1">&#39;objects&#39;</span><span class="o">]</span><span class="p">,</span> <span class="nb">self</span><span class="p">)</span>
  <span class="vi">@archive_version</span> <span class="o">=</span> <span class="n">plist</span><span class="o">[</span><span class="s1">&#39;archiveVersion&#39;</span><span class="o">]</span>
  <span class="vi">@object_version</span>  <span class="o">=</span> <span class="n">plist</span><span class="o">[</span><span class="s1">&#39;objectVersion&#39;</span><span class="o">]</span>
  <span class="vi">@classes</span>         <span class="o">=</span> <span class="n">plist</span><span class="o">[</span><span class="s1">&#39;classes&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="p">{}</span>
  <span class="vi">@dirty</span>           <span class="o">=</span> <span class="kp">false</span>

  <span class="k">unless</span> <span class="n">root_object</span>
    <span class="k">raise</span> <span class="s2">&#34;[Xcodeproj] Unable to find a root object in </span><span class="si">#{</span><span class="n">pbxproj_path</span><span class="si">}</span><span class="s2">.&#34;</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="n">archive_version</span><span class="o">.</span><span class="n">to_i</span> <span class="o">&gt;</span> <span class="no">Constants</span><span class="o">::</span><span class="no">LAST_KNOWN_ARCHIVE_VERSION</span>
    <span class="k">raise</span> <span class="s1">&#39;[Xcodeproj] Unknown archive version.&#39;</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="n">object_version</span><span class="o">.</span><span class="n">to_i</span> <span class="o">&gt;</span> <span class="no">Constants</span><span class="o">::</span><span class="no">LAST_KNOWN_OBJECT_VERSION</span>
    <span class="k">raise</span> <span class="s1">&#39;[Xcodeproj] Unknown object version.&#39;</span>
  <span class="k">end</span>

  <span class="c1"># Projects can have product_ref_groups that are not listed in the main_groups[&#34;Products&#34;]</span>
  <span class="n">root_object</span><span class="o">.</span><span class="n">product_ref_group</span> <span class="o">||=</span> <span class="n">root_object</span><span class="o">.</span><span class="n">main_group</span><span class="o">[</span><span class="s1">&#39;Products&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="n">root_object</span><span class="o">.</span><span class="n">main_group</span><span class="o">.</span><span class="n">new_group</span><span class="p">(</span><span class="s1">&#39;Products&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>åœ¨ open æ–¹æ³•ä¸­ä¼šæ£€éªŒè·¯å¾„ï¼Œåˆå§‹åŒ– Project å¯¹è±¡;</li>
<li>ä½¿ç”¨å†…éƒ¨ Property List ç±» <code>Plist</code> æ¥è¯»å– <code>project.pbxproj</code> æ•°æ®;</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>new_from_plist</code> ä¸ä»…å®Œæˆäº† rootObject çš„è§£æï¼ŒåŒæ—¶ä¹Ÿå®Œæˆ objects çš„è§£æã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">new_from_plist</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">objects_by_uuid_plist</span><span class="p">,</span> <span class="n">root_object</span> <span class="o">=</span> <span class="kp">false</span><span class="p">)</span>
  <span class="n">attributes</span> <span class="o">=</span> <span class="n">objects_by_uuid_plist</span><span class="o">[</span><span class="n">uuid</span><span class="o">]</span>
  <span class="k">if</span> <span class="n">attributes</span>
    <span class="c1"># ä»¥ isa è·å– Xcodeproj ä¸­å¯¹åº”çš„ Xcode Object ç±»å‹</span>
    <span class="n">klass</span> <span class="o">=</span> <span class="no">Object</span><span class="o">.</span><span class="n">const_get</span><span class="p">(</span><span class="n">attributes</span><span class="o">[</span><span class="s1">&#39;isa&#39;</span><span class="o">]</span><span class="p">)</span>
    <span class="n">object</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">)</span>
    <span class="n">objects_by_uuid</span><span class="o">[</span><span class="n">uuid</span><span class="o">]</span> <span class="o">=</span> <span class="n">object</span>
    <span class="n">object</span><span class="o">.</span><span class="n">add_referrer</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">root_object</span>
    <span class="c1"># è§£æ objects èŠ‚ç‚¹ï¼Œå¹¶å®Œæˆ ISA æ•°æ®åˆ° Xcode Object çš„æ˜ å°„</span>
    <span class="n">object</span><span class="o">.</span><span class="n">configure_with_plist</span><span class="p">(</span><span class="n">objects_by_uuid_plist</span><span class="p">)</span>
    <span class="n">object</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>ä»¥ uuid å–å‡º Plist æ•°æ®å¹¶åˆ©ç”¨ isa kclass å®Œæˆ Project å¯¹è±¡çš„åˆå§‹åŒ–å’Œæ˜ å°„ã€‚<code>Object const</code> ä¸­è®°å½•äº†æ”¯æŒçš„ <code>isa</code>ï¼›</li>
<li>å°† object å­˜å…¥ objects_by_uuid å­—å…¸ä¸­ï¼Œä»¥è¦†ç›–åŸæœ‰çš„ GUIDï¼›</li>
<li>æ‰§è¡Œ <code>configure_with_plist</code> é€’å½’ï¼Œå®Œæˆ <code>objects</code> æ˜ å°„ã€‚</li>
</ol>
<blockquote>
<p>Tips: <code>configure_with_plist</code> äºä¸‹ç¯‡å±•å¼€.</p>
</blockquote>
<p><code>project.pbxproj</code> è§£æä¸»ä½“æµç¨‹å¦‚ä¸‹</p>
<p><img src="https://gitee.com/looseyi/blog-image/raw/master/uPic/02-parse-project.png" alt="02-parse-project"></p>
<p>å›¾ä¸­çš„ reference attributes æ˜¯æŒ‡ Object çš„å¼•ç”¨å±æ€§ï¼Œåé¢ä¼šæœ‰ä»‹ç»ã€‚</p>
<h2 id="object-module">Object Module</h2>
<h3 id="abstractobject">AbstractObject</h3>
<p>Object çš„æŠ½è±¡ç±»ï¼ŒXcode é¡¹ç›®å¹¶ä¸å­˜åœ¨å¯¹åº”çš„ <code>isa</code> ç±»å‹ã€‚å…ˆç®€å•ä»‹ç»éƒ¨åˆ†å±æ€§ï¼Œæ–¹ä¾¿åç»­ç†è§£ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">AbstractObject</span>
  <span class="c1"># object ç±»å‹</span>
  <span class="kp">attr_reader</span> <span class="ss">:isa</span>
  <span class="c1"># object å”¯ä¸€æ ‡è¯†</span>
  <span class="kp">attr_reader</span> <span class="ss">:uuid</span>
  <span class="c1"># æŒæœ‰ object çš„ project</span>
  <span class="kp">attr_reader</span> <span class="ss">:project</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">uuid</span><span class="p">)</span>
    <span class="vi">@project</span> <span class="o">=</span> <span class="n">project</span>
    <span class="vi">@uuid</span> <span class="o">=</span> <span class="n">uuid</span>
    <span class="vi">@isa</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">isa</span>
    <span class="vi">@referrers</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="k">unless</span> <span class="vi">@isa</span> <span class="o">=~</span> <span class="sr">/^(PBX|XC)/</span>
      <span class="k">raise</span> <span class="s2">&#34;[Xcodeproj] Attempt to initialize an abstract class (</span><span class="si">#{</span><span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="si">}</span><span class="s2">).&#34;</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="o">...</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼ŒObject ç±»åœ¨ initialize æ—¶å…³è”äº† project å¯¹è±¡ï¼Œä½œè€…ä¸å»ºè®®æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ï¼Œè€Œåœ¨ Xcodeproj æ¨¡å—å†…æä¾›äº† convince æ–¹æ³•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">klass</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="nb">String</span><span class="p">)</span>
     <span class="n">klass</span> <span class="o">=</span> <span class="no">Object</span><span class="o">.</span><span class="n">const_get</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
   <span class="k">end</span>
   <span class="n">object</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">generate_uuid</span><span class="p">)</span>
   <span class="n">object</span><span class="o">.</span><span class="n">initialize_defaults</span>
   <span class="n">object</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>ä½œè€…ä¿ç•™ project çš„å¼•ç”¨æ˜¯ä¸ºäº†æ–¹ä¾¿å¤„ç† Object çš„å¼•ç”¨è®¡æ•°ï¼Œproject ä½œä¸ºé¡¹ç›®çš„æ ¹èŠ‚ç‚¹ï¼Œè®°å½•äº†å®Œæ•´çš„å·¥ç¨‹é…ç½®å’Œå„æ¨¡å—çš„äº¤å‰å¼•ç”¨å…³ç³»ï¼Œæœ‰äº† project çš„å¼•ç”¨èƒ½ç»™è¿›è¡Œ object çš„å¼•ç”¨ç®¡ç†ã€‚</p>
<h3 id="const-accessor">Const Accessor</h3>
<p>è¿™é‡Œå…ˆæ’æ’­ä¸€ä¸‹ Object æ¨¡å—ä¸­ <code>const</code> å®šä¹‰åŠå…¶å­˜å‚¨çš„å€¼ã€‚åœ¨ Ruby ä¸­ Module å¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ æ¨¡å—çº§çš„å¸¸é‡ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="no">Module</span><span class="c1">#const_get</span>
<span class="no">Module</span><span class="c1">#const_set</span>
</code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™äº› const å¸¸é‡æ˜¯åœ¨ä»€ä¹ˆæ—¶æœºå­˜å…¥ Object ä¸­çš„å‘¢ ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># lib/xcodeproj/project/object.rb</span>

<span class="no">Xcodeproj</span><span class="o">::</span><span class="no">Constants</span><span class="o">::</span><span class="no">KNOWN_ISAS</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">superclass_name</span><span class="p">,</span> <span class="n">isas</span><span class="o">|</span>
  <span class="n">superklass</span> <span class="o">=</span> <span class="no">Xcodeproj</span><span class="o">::</span><span class="no">Project</span><span class="o">::</span><span class="no">Object</span><span class="o">.</span><span class="n">const_get</span><span class="p">(</span><span class="n">superclass_name</span><span class="p">)</span>
  <span class="n">isas</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">isa</span><span class="o">|</span>
    <span class="n">c</span> <span class="o">=</span> <span class="no">Class</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">superklass</span><span class="p">)</span>
    <span class="no">Xcodeproj</span><span class="o">::</span><span class="no">Project</span><span class="o">::</span><span class="no">Object</span><span class="o">.</span><span class="n">const_set</span><span class="p">(</span><span class="n">isa</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨ object.rb æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å®šä½åˆ° <code>Object.const_set</code> çš„è°ƒç”¨ï¼Œå®ƒæ˜¯åœ¨ Object ç±»è¢«åŠ è½½æ—¶è§¦å‘çš„ã€‚Xcodeproj æ”¯æŒçš„ <code>isa</code> ç±»å‹åç§°éƒ½å®šä¹‰åœ¨ <code>Xcodeproj::Constants::KNOWN_ISAS</code> ä¸­ã€‚Object åŠ è½½æ—¶é€šè¿‡éå†å®ƒæ¥è½½å…¥ <code>isa class</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="no">KNOWN_ISAS</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;AbstractObject&#39;</span> <span class="o">=&gt;</span> <span class="sx">%w(
</span><span class="sx">    PBXBuildFile
</span><span class="sx">    AbstractBuildPhase
</span><span class="sx">    PBXBuildRule
</span><span class="sx">    XCBuildConfiguration
</span><span class="sx">    XCConfigurationList
</span><span class="sx">    PBXContainerItemProxy
</span><span class="sx">    PBXFileReference
</span><span class="sx">    PBXGroup
</span><span class="sx">    PBXProject
</span><span class="sx">    PBXTargetDependency
</span><span class="sx">    PBXReferenceProxy
</span><span class="sx">    AbstractTarget
</span><span class="sx">  )</span><span class="p">,</span>

  <span class="s1">&#39;AbstractBuildPhase&#39;</span> <span class="o">=&gt;</span> <span class="sx">%w(
</span><span class="sx">    PBXCopyFilesBuildPhase
</span><span class="sx">    PBXResourcesBuildPhase
</span><span class="sx">    PBXSourcesBuildPhase
</span><span class="sx">    PBXFrameworksBuildPhase
</span><span class="sx">    PBXHeadersBuildPhase
</span><span class="sx">    PBXShellScriptBuildPhase
</span><span class="sx">  )</span><span class="p">,</span>

  <span class="s1">&#39;AbstractTarget&#39;</span> <span class="o">=&gt;</span> <span class="sx">%w(
</span><span class="sx">    PBXNativeTarget
</span><span class="sx">    PBXAggregateTarget
</span><span class="sx">    PBXLegacyTarget
</span><span class="sx">  )</span><span class="p">,</span>

  <span class="s1">&#39;PBXGroup&#39;</span> <span class="o">=&gt;</span> <span class="sx">%w(
</span><span class="sx">    XCVersionGroup
</span><span class="sx">    PBXVariantGroup
</span><span class="sx">  )</span><span class="p">,</span>
<span class="p">}</span><span class="o">.</span><span class="n">freeze</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="object-attributes">Object Attributes</h2>
<p><code>AbstractObject</code> ä½œä¸º <code>Xcodeproj</code> æä¾›çš„ Object åŸºç±»ï¼Œå®ƒä¸ä»…æä¾›äº†åŸºæœ¬å±æ€§ï¼Œå¦‚ <code>isa</code> ç±»å‹å’Œ uuid ç­‰ï¼Œè¿˜æä¾›äº†ç‰¹æ®Šçš„å±æ€§ä¿®é¥°å™¨å¦‚ <code>Attribute</code>ï¼Œæ–¹ä¾¿å¿«é€Ÿæ·»åŠ å±æ€§ã€‚å…‰ä» <code>KNOWN_ISAS</code> çœ‹æ¥è¿™äº› <code>isa</code> ç±»å‹å°±å·²ç»å¤Ÿå¤šäº†ï¼Œè¿˜è¦è€ƒè™‘å±æ€§çš„ CURD ä»¥åŠæ•°æ®åˆ°å¯¹è±¡æ˜ å°„ç­‰ä¸€ç³»åˆ—æ“ä½œã€‚</p>
<p>ä¸ºæ­¤ï¼Œ<strong>Xcodeproj å®ç°äº†ä¸€å¥—é’ˆå¯¹ <code>project.pbxproj</code> çš„ DSL è§£æ</strong>ã€‚è¿™äº›ç‰¹æ€§çš„å®ç°æ­£æ˜¯ä¾èµ–äºå±æ€§ä¿®é¥°å™¨å’Œ Ruby å¼ºå¤§çš„ Runtime èƒ½åŠ›ã€‚</p>
<h3 id="abstractobjectattribute">AbstractObjectAttribute</h3>
<p><code>AbstractObjectAttribute</code> æ˜¯ç”¨äºå£°æ˜å’Œå­˜å‚¨ Object å±æ€§çš„å…³é”®ä¿¡æ¯ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">AbstractObjectAttribute</span>
   
  <span class="c1"># å±æ€§æœ¬èº«ç±»å‹ï¼Œ:simple, :to_one, :to_many.</span>
  <span class="kp">attr_reader</span> <span class="ss">:type</span>
   
  <span class="c1"># å±æ€§å</span>
  <span class="kp">attr_reader</span> <span class="ss">:name</span>
   
  <span class="c1"># å±æ€§çš„æŒæœ‰è€…</span>
  <span class="kp">attr_accessor</span> <span class="ss">:owner</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">owner</span><span class="p">)</span>
    <span class="vi">@type</span>  <span class="o">=</span> <span class="n">type</span>
    <span class="vi">@name</span>  <span class="o">=</span> <span class="nb">name</span>
    <span class="vi">@owner</span> <span class="o">=</span> <span class="n">owner</span>
  <span class="k">end</span>

  <span class="c1"># å±æ€§æ”¯æŒçš„ç±»å‹</span>
  <span class="kp">attr_accessor</span> <span class="ss">:classes</span>
   
  <span class="c1"># ä»…é™äº :references_by_keys å…³è”çš„ç±»å‹</span>
  <span class="kp">attr_accessor</span> <span class="ss">:classes_by_key</span>
   
  <span class="c1"># ä»…é™äº :simple ç±»å‹æŒ‡å®šé»˜è®¤å€¼</span>
  <span class="kp">attr_accessor</span> <span class="ss">:default_value</span>
  <span class="o">...</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p><code>AbstractObject</code> é€šè¿‡ Ruby æä¾›çš„ <code>Singleton Classes</code> ä»¥å®ç°å±æ€§ä¿®é¥°å™¨æ–¹æ³•çš„æ‰©å±•ã€‚</p>
<p>å¯¹äºå•ä¾‹æ¨¡å¼ï¼ŒRuby æä¾›äº†å¤šç§å®ç°æ–¹å¼ã€‚åœ¨ Ruby ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªåŒ¿å<strong>å•ä¾‹ç±»</strong>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰ç±»æ˜¯ä¸å­˜åœ¨å•ä¾‹ç±»ï¼Œä¸è¿‡å¯é€šè¿‡ <code>class &lt;&lt; obj</code> æ¥æ‰“å¼€å¯¹è±¡çš„å•ä¾‹ç±»ç©ºé—´ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">C</span>
  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="nb">puts</span> <span class="nb">self</span>	<span class="c1"># è¾“å‡ºï¼š#&lt;Class:C&gt;ï¼Œç±» C ç±»å¯¹è±¡çš„å•ä¾‹ç±»</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨æ„ï¼šRuby ä¸­æ¯ä¸ªå¯¹è±¡ (Class / Module ä¹Ÿæ˜¯å¯¹è±¡) éƒ½æœ‰è‡ªå·±æ‰€å±çš„ç±»ï¼Œå®ƒä»¬éƒ½æ˜¯æœ‰å…·ä½“åç§°çš„ç±»ã€‚</p>
</blockquote>
<p><code>Xcodeproj</code> é’ˆå¯¹ Attribute æä¾›äº†å¤šç§å•ä¾‹ç±»æ–¹æ³•ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Object</span>
  <span class="k">class</span> <span class="nc">AbstractObject</span>
    <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
      <span class="c1"># æ™®é€šå±æ€§å£°æ˜æ–¹æ³•</span>
      <span class="k">def</span> <span class="nf">attribute</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">default_value</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span> <span class="o">...</span> <span class="k">end</span>
       
      <span class="c1"># å•ä¸€å¼•ç”¨çš„å±æ€§å£°æ˜æ–¹æ³•</span>
      <span class="k">def</span> <span class="nf">has_one</span><span class="p">(</span><span class="n">singular_name</span><span class="p">,</span> <span class="n">isas</span><span class="p">)</span> <span class="o">...</span> <span class="k">end</span>
       
      <span class="c1"># å¤šå¼•ç”¨çš„å±æ€§å£°æ˜æ–¹æ³•</span>
      <span class="k">def</span> <span class="nf">has_many</span><span class="p">(</span><span class="n">plural_name</span><span class="p">,</span> <span class="n">isas</span><span class="p">)</span> <span class="o">...</span> <span class="k">end</span>
       
      <span class="c1"># å¤šå¼•ç”¨ä¸”ä¸åŒ key çš„å±æ€§å£°æ˜æ–¹æ³•</span>
      <span class="k">def</span> <span class="nf">has_many_references_by_keys</span><span class="p">(</span><span class="n">plural_name</span><span class="p">,</span> <span class="n">classes_by_key</span><span class="p">)</span> <span class="o">...</span> <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>ç›´æ¥çœ‹å¦‚ä½•ä½¿ç”¨ï¼Œå£°æ˜å±æ€§æ¯”è¾ƒç›´è§‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Object</span>
  <span class="k">class</span> <span class="nc">PBXProject</span> <span class="o">&lt;</span> <span class="no">AbstractObject</span>     
     
    <span class="c1"># å£°æ˜ä¸º [String] ç±»å‹çš„ project_dir_pathï¼Œé»˜è®¤å€¼ä¸ºç©º</span>
    <span class="n">attribute</span> <span class="ss">:project_dir_path</span><span class="p">,</span> <span class="nb">String</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
    
    <span class="c1"># å£°æ˜ä¸º [PBXGroup] ç±»å‹çš„ main_group</span>
    <span class="n">has_one</span> <span class="ss">:main_group</span><span class="p">,</span> <span class="no">PBXGroup</span>

    <span class="c1"># å£°æ˜ä¸º [ObjectList&lt;AbstractTarget&gt;] ç±»å‹çš„ targets</span>
    <span class="n">has_many</span> <span class="ss">:targets</span><span class="p">,</span> <span class="no">AbstractTarget</span>
     
    <span class="c1"># å£°æ˜ä¸º [Array&lt;ObjectDictionary&gt;] ç±»å‹çš„ project_references </span>
    <span class="n">has_many_references_by_keys</span> <span class="ss">:project_references</span><span class="p">,</span>
                                <span class="ss">:project_ref</span>   <span class="o">=&gt;</span> <span class="no">PBXFileReference</span><span class="p">,</span>
                                <span class="ss">:product_group</span> <span class="o">=&gt;</span> <span class="no">PBXGroup</span>
    <span class="o">...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>æ‰€è°“çš„å•ä¸€æˆ–è€…å¤šå¼•ç”¨æ˜¯æŒ‡<strong>Object ä¹‹é—´å¼•ç”¨å…³ç³»</strong>ã€‚ä»¥ <code>PBXProject</code> ä¸ºä¾‹ï¼Œä¸€ä¸ªé¡¹ç›®åªèƒ½æŒ‡å®šä¸€ä¸ª mainGroupï¼Œä½†å¯¹äº targets å¯ä»¥å­˜åœ¨å¤šä¸ªã€‚è¿™é‡Œä¸ç›´æ¥ä½¿ç”¨ <code>attribute</code> æ¥ä¿®é¥°æ˜¯å› ä¸ºï¼Œåƒ target è¿™ç§å­˜åœ¨äº¤å‰å¼•ç”¨çš„ Object è¢«åˆ é™¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“è°å¼•ç”¨äº†å®ƒï¼Œæ‰ä¿è¯æ‰€æœ‰çš„å¼•ç”¨éƒ½èƒ½è¢«æ¸…ç†å¹²å‡€ã€‚å› æ­¤ï¼Œ<strong>Xcodeproj å®ç°äº†ä¸€å¥—é’ˆå¯¹ Object çš„å¼•ç”¨è®¡æ•°ç®¡ç†</strong> (ä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´)ã€‚</p>
<h3 id="attribute">Attribute</h3>
<p>ä»Šå¤©å…ˆçœ‹æ™®é€šå±æ€§çš„ DSL å®ç°ï¼Œ<code>has_one</code> ä¸ <code>has_many</code> çš„å±æ€§ä¿®é¥°å°†åœ¨ä¸‹ç¯‡å±•å¼€ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># lib/xcodeproj/project/object_attributes.rb</span>

<span class="k">def</span> <span class="nf">attribute</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">default_value</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">)</span>
  <span class="c1"># 1. åˆå§‹åŒ– attributeï¼Œè®°å½•å±æ€§åï¼Œå±æ€§ç±»å‹åŠé»˜è®¤å€¼</span>
  <span class="n">attrb</span> <span class="o">=</span> <span class="no">AbstractObjectAttribute</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:simple</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="nb">self</span><span class="p">)</span>
  <span class="n">attrb</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="o">[</span><span class="n">klass</span><span class="o">]</span>
  <span class="n">attrb</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">default_value</span>
  <span class="c1"># 2. å°† attrb å­˜å…¥ @attributes</span>
  <span class="n">add_attribute</span><span class="p">(</span><span class="n">attrb</span><span class="p">)</span>
  
  <span class="c1"># 3. æ·»åŠ åä¸º name çš„ getter</span>
  <span class="n">define_method</span><span class="p">(</span><span class="n">attrb</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@simple_attributes_hash</span> <span class="o">||=</span> <span class="p">{}</span>
    <span class="vi">@simple_attributes_hash</span><span class="o">[</span><span class="n">attrb</span><span class="o">.</span><span class="n">plist_name</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="c1"># 4. æ·»åŠ åä¸º #{name}= çš„ setterï¼Œå¹¶å°†å€¼å­˜å…¥ @simple_attributes_hash å­—å…¸ä¸­</span>
  <span class="n">define_method</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">#{</span><span class="n">attrb</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">=&#34;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span>
    <span class="vi">@simple_attributes_hash</span> <span class="o">||=</span> <span class="p">{}</span>
    <span class="c1"># 5. æ£€æŸ¥ value æ˜¯å¦ä¸º klass æ”¯æŒçš„ç±»å‹</span>
    <span class="n">attrb</span><span class="o">.</span><span class="n">validate_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="n">existing</span> <span class="o">=</span> <span class="vi">@simple_attributes_hash</span><span class="o">[</span><span class="n">attrb</span><span class="o">.</span><span class="n">plist_name</span><span class="o">]</span>
    <span class="k">if</span> <span class="n">existing</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">value</span> <span class="k">if</span> <span class="n">existing</span><span class="o">.</span><span class="n">keys</span> <span class="o">==</span> <span class="n">value</span><span class="o">.</span><span class="n">keys</span> <span class="o">&amp;&amp;</span> <span class="n">existing</span> <span class="o">==</span> <span class="n">value</span>
    <span class="k">elsif</span> <span class="n">existing</span> <span class="o">==</span> <span class="n">value</span>
      <span class="k">return</span> <span class="n">value</span>
    <span class="k">end</span>
    <span class="n">mark_project_as_dirty!</span>
    <span class="vi">@simple_attributes_hash</span><span class="o">[</span><span class="n">attrb</span><span class="o">.</span><span class="n">plist_name</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>ä»£ç æ¯”è¾ƒé•¿æ ¸å¿ƒé€»è¾‘å°± 2 æ­¥ï¼š</p>
<ol>
<li>
<p>åˆå§‹åŒ– attributeï¼Œè®°å½•å±æ€§åï¼Œå±æ€§ç±»å‹åŠé»˜è®¤å€¼ï¼Œå°† attrb å­˜å…¥å¯¹è±¡çš„ <code>@attributes</code> ç”¨äºåç»­éå†ï¼›</p>
</li>
<li>
<p>åˆ©ç”¨ <code>define_method</code> ä¸ºä¿®é¥°çš„å¯¹è±¡æ·»åŠ å®ä¾‹å˜é‡å­˜å–æ–¹æ³•ã€‚</p>
<p>ç”±äºä¿®é¥°çš„å±æ€§ç±»å‹ä¸åŒï¼Œaccessor æ–¹æ³•ç›´æ¥ä½¿ç”¨ Hash å®¹å™¨æ¥ä¿å­˜å˜é‡å€¼ï¼Œkey ä¸º <code>attribute.name</code>ï¼Œä½¿ç”¨ Hash æ˜¯ä¸ºäº†é¿å…å—åˆ° Object å¼•ç”¨è®¡æ•°çš„å½±å“ã€‚</p>
</li>
</ol>
<p>æœ¬è´¨ä¸Š attribute ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ accessor å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">project_dir_path</span>
  <span class="vi">@simple_attributes_hash</span><span class="o">[</span><span class="n">projectDirPath</span><span class="o">]</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">project_dir_path</span><span class="o">=</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
  <span class="n">attribute</span><span class="o">.</span><span class="n">validate_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
  <span class="vi">@simple_attributes_hash</span><span class="o">[</span><span class="n">projectDirPath</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="xcode-object-1">Xcode Object</h2>
<p>æœ€åæˆ‘ä»¬æ¥èŠä¸¤ä¸ª <code>project.pbxproj</code> ä¸­çš„åŸºç¡€ Object ç±»å‹ï¼š<code>PBXFileReference</code> å’Œ <code>PBXGroup</code>ã€‚æ”¾åœ¨æ–‡ç« æœ«å°¾ï¼Œæ˜¯å¸Œæœ›çœ‹åˆ°è¿™é‡Œçš„åŒå­¦èƒ½ç†è§£Xcode è®¾è®¡çš„èƒŒåæ€æƒ³ã€‚</p>
<h3 id="pbxfilereference">PBXFileReference</h3>
<p><code>PBXFileReference</code> è®°å½•äº†æ„å»º Xcode é¡¹ç›®æ‰€éœ€è¦çš„çœŸå®æ–‡ä»¶ä¿¡æ¯ï¼Œ<strong>ä¸»è¦è®°å½•äº†æ–‡ä»¶è·¯å¾„</strong>ã€‚è¿™äº› <code>PBXFileReference</code> å°±æ˜¯æˆ‘ä»¬åœ¨ Xcode é¡¹ç›®çš„å·¦ä¾§è¾¹æ ä¸­æ‰€è§çš„æ–‡ä»¶ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="no">F8DA09E31396AC040057D0CC</span> <span class="sr">/* main.m */</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">isa</span> <span class="o">=</span> <span class="no">PBXFileReference</span><span class="p">;</span> 
  <span class="n">fileEncoding</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="n">lastKnownFileType</span> <span class="o">=</span> <span class="n">sourcecode</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">objc</span><span class="p">;</span> 
  <span class="n">path</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">m</span><span class="p">;</span> 
  <span class="n">sourceTree</span> <span class="o">=</span> <span class="no">SOURCE_ROOT</span><span class="p">;</span> 
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>å¯¹äº <code>PBXFileReference</code> è·¯å¾„ï¼Œé‡ç‚¹åœ¨äºç¡®è®¤è¯¥ path æ˜¯ç›¸å¯¹è·¯å¾„è¿˜æ˜¯ç»å¯¹è·¯å¾„ï¼Œ<code>sourceTree</code> å°±æ˜¯ç”¨æ¥æè¿°è¿™ä¸ªçš„ï¼Œå®ƒæœ‰å‡ ç§ç›¸å¯¹å…³ç³»ï¼š</p>
<ul>
<li>
<p><code>&lt;absolute&gt;</code>ï¼šç»å¯¹è·¯å¾„</p>
</li>
<li>
<p><code>&lt;group&gt;</code> åŸºäº PBXGroup çš„ç›¸å¯¹è·¯å¾„</p>
</li>
<li>
<p><code>SOURCE_ROOT</code> åŸºäº project çš„ç›¸å¯¹è·¯å¾„</p>
</li>
<li>
<p><code>DEVELOPER_DIR</code> åŸºäº developer directory çš„ç›¸å¯¹è·¯å¾„</p>
</li>
<li>
<p><code>BUILT_PRODUCTS_DIR</code> åŸºäº build  products directory çš„ç›¸å¯¹è·¯å¾„</p>
</li>
<li>
<p><code>SDKROOT</code> åŸºäº SDK directory çš„ç›¸å¯¹è·¯å¾„</p>
</li>
</ul>
<p><code>Xcodeproj</code> æä¾›äº† <code>GroupableHelper</code> ç”¨äºè·å–å„ç§çŠ¶æ€çš„æ–‡ä»¶ç›®å½•ï¼Œæ¯”å¦‚æ–‡ä»¶çš„ç»å¯¹ç›®å½•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">source_tree_real_path</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
  <span class="k">case</span> <span class="n">object</span><span class="o">.</span><span class="n">source_tree</span>
  <span class="k">when</span> <span class="s1">&#39;&lt;group&gt;&#39;</span>
    <span class="n">object_parent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">object_parent</span><span class="o">.</span><span class="n">isa</span> <span class="o">==</span> <span class="s1">&#39;PBXProject&#39;</span><span class="o">.</span><span class="n">freeze</span>
      <span class="n">object</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">+</span> <span class="n">object</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">root_object</span><span class="o">.</span><span class="n">project_dir_path</span>
    <span class="k">else</span>
      <span class="n">real_path</span><span class="p">(</span><span class="n">object_parent</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">when</span> <span class="s1">&#39;SOURCE_ROOT&#39;</span>
    <span class="n">object</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">project_dir</span>
  <span class="k">when</span> <span class="s1">&#39;&lt;absolute&gt;&#39;</span>
    <span class="kp">nil</span>
  <span class="k">else</span>
    <span class="no">Pathname</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&#34;${</span><span class="si">#{</span><span class="n">object</span><span class="o">.</span><span class="n">source_tree</span><span class="si">}</span><span class="s2">}&#34;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p><code>PBXFileReference</code> ä¸»è¦å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Object</span>
  <span class="k">class</span> <span class="nc">PBXFileReference</span> <span class="o">&lt;</span> <span class="no">AbstractObject</span>
    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
    <span class="n">attribute</span> <span class="ss">:path</span><span class="p">,</span> <span class="nb">String</span>
    <span class="n">attribute</span> <span class="ss">:source_tree</span><span class="p">,</span> <span class="nb">String</span><span class="p">,</span> <span class="s1">&#39;SOURCE_ROOT&#39;</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="pbxgroup">PBXGroup</h3>
<p>åŸºäº <code>PBXFileReference</code> ä¹‹ä¸Šçš„ä¸€å±‚æŠ½è±¡ï¼Œèƒ½æ›´å¥½çš„å¯¹ <code>PBXFileReference</code> è¿›è¡Œç®¡ç†å’Œåˆ†ç»„ã€‚<code>PBXGroup</code> èƒŒåå¹¶ä¸ä¸€å®šçœŸå®å­˜åœ¨å¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œå¦å¤– <code>PBXGroup</code> å¯ä»¥å¼•ç”¨å…¶ä»– <code>PBXGroup</code>ï¼Œè¿›è¡ŒåµŒå¥—ã€‚å®šä¹‰å¦‚ä¸‹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Object</span>
  <span class="k">class</span> <span class="nc">PBXGroup</span> <span class="o">&lt;</span> <span class="no">AbstractObject</span>
    <span class="c1"># group å¯åŒ…å«çš„ç±»å‹</span>
    <span class="n">has_many</span> <span class="ss">:children</span><span class="p">,</span> <span class="o">[</span><span class="no">PBXGroup</span><span class="p">,</span> <span class="no">PBXFileReference</span><span class="p">,</span> <span class="no">PBXReferenceProxy</span><span class="o">]</span>
    <span class="n">attribute</span> <span class="ss">:source_tree</span><span class="p">,</span> <span class="nb">String</span><span class="p">,</span> <span class="s1">&#39;&lt;group&gt;&#39;</span>
    <span class="c1"># è®°å½• group åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„</span>
    <span class="n">attribute</span> <span class="ss">:path</span><span class="p">,</span> <span class="nb">String</span>
		<span class="c1"># é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæŒ‡å®šäº†è·¯å¾„ï¼Œåˆ™æ­¤å±æ€§ä¸å­˜åœ¨ã€‚</span>
    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>å®ƒæä¾›äº†ä¸€ä¸ªä¾¿åˆ©çš„åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">new_group</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">source_tree</span> <span class="o">=</span> <span class="ss">:group</span><span class="p">)</span>
  <span class="n">group</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">PBXGroup</span><span class="p">)</span>
  <span class="n">children</span> <span class="o">&lt;&lt;</span> <span class="n">group</span>
  <span class="n">group</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="n">group</span><span class="o">.</span><span class="n">set_source_tree</span><span class="p">(</span><span class="n">source_tree</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">set_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="n">group</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„ name æ˜¯å¿…é¡»ä¼ çš„ï¼Œpath åˆ™å¯ä»¥ä¸ºç©ºã€‚è€Œæˆ‘ä»¬åœ¨ Xcode çš„å¯¼èˆªæ ä¸­æ‰€è§çš„å„ä¸ªåˆ†ç»„åç§°å’Œè·¯å¾„å°±æ˜¯ç”±è¿™ä¸¤ä¸ªå±æ€§æ¥å†³å®šçš„ã€‚æ²¡æœ‰ name çš„æƒ…å†µä¸‹åˆ™æ˜¯ä»¥ path çš„ basename ä½œä¸º display_name æ¥å‘ˆç°ã€‚</p>
<p>æœ€åæ¥çœ‹ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="no">F8E469631395739D00DB05C8</span> <span class="sr">/* Frameworks */</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">isa</span> <span class="o">=</span> <span class="no">PBXGroup</span><span class="p">;</span>
  <span class="n">children</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">50</span><span class="no">ABD6EC159FC2CE001BE42C</span> <span class="sr">/* MobileCoreServices.framework */</span><span class="p">,</span>
    <span class="o">...</span>
  <span class="p">);</span>
  <span class="nb">name</span> <span class="o">=</span> <span class="no">Frameworks</span><span class="p">;</span>
  <span class="n">sourceTree</span> <span class="o">=</span> <span class="s2">&#34;&lt;group&gt;&#34;</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>é¡¹ç›®ä¸­å¹¶ä¸å­˜åœ¨çœŸå®çš„ <code>Framework</code> æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥æ— éœ€æŒ‡å®š pathã€‚å¦å¤–æ³¨æ„ï¼ŒmainGroup æ—¢æ²¡æœ‰ name ä¹Ÿæ²¡æœ‰ pathï¼Œå¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹åŸå› ã€‚</p>
<h1 id="é€šè¿‡ä»£ç ç¼–è¾‘-xcode-å·¥ç¨‹">é€šè¿‡ä»£ç ç¼–è¾‘ Xcode å·¥ç¨‹</h1>
<p>æœ€åä¸€ç« ï¼Œä¸€èµ·æ¥å®è·µä¸€ä¸‹ç®€å•çš„åŠŸèƒ½ã€‚</p>
<h2 id="ä¸º-xcode-å·¥ç¨‹æ·»åŠ æ–‡ä»¶">ä¸º Xcode å·¥ç¨‹æ·»åŠ æ–‡ä»¶</h2>
<h3 id="0x01-æ·»åŠ æºæ–‡ä»¶">0x01 æ·»åŠ æºæ–‡ä»¶</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="n">project</span> <span class="o">=</span> <span class="no">Xcodeproj</span><span class="o">::</span><span class="no">Project</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">first</span>
<span class="n">group</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">main_group</span><span class="o">.</span><span class="n">find_subpath</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;Xcodeproj&#39;</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">),</span> <span class="kp">true</span><span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">set_source_tree</span><span class="p">(</span><span class="s1">&#39;SOURCE_ROOT&#39;</span><span class="p">)</span>
<span class="n">file_ref</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">new_reference</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
<span class="n">target</span><span class="o">.</span><span class="n">add_file_references</span><span class="p">(</span><span class="o">[</span><span class="n">file_ref</span><span class="o">]</span><span class="p">)</span>
<span class="n">project</span><span class="o">.</span><span class="n">save</span>
</code></pre></td></tr></table>
</div>
</div><p>ç»™ Xcode å·¥ç¨‹æ·»åŠ æ–‡ä»¶ç®—æ˜¯å¸¸è§„æ“ä½œã€‚è¿™æ®µä»£ç å¼•ç”¨è‡ª <a href="https://draveness.me/bei-xcodeproj-keng-de-zhe-ji-tian/">draveness çš„æ–‡ç« </a>ï¼Œä½œè€…å¯¹æ¯ä¸€æ­¥éƒ½åšäº†è¯¦ç»†çš„è§£é‡Šäº†ã€‚æˆ‘ä»¬ä»ä»£ç è§’åº¦é‡ç‚¹è¯´ä¸€ä¸‹ <code>new_reference</code> å’Œ <code>add_file_references</code>ã€‚</p>
<p><strong>PBXGroup::new_references</strong></p>
<p>Xcode å·¥ç¨‹ä¼šæŒ‡å®š main_group ä½œä¸ºé¡¹ç›®èµ„æºçš„å…¥å£ï¼Œæ‰€æ·»åŠ çš„æ–‡ä»¶èµ„æºéœ€è¦å…ˆåŠ å…¥ main_group å†…ï¼Œä»¥ç”Ÿæˆå¯¹åº”çš„ <code>PBXFileReference</code>ï¼Œè¿™æ · target ä»»åŠ¡å’Œ buildPhase ç­‰é…ç½®æ‰èƒ½è®¿é—®è¯¥èµ„æºã€‚å› æ­¤ï¼Œ<code>new_reference</code> æ ¸å¿ƒæ˜¯ <code>new_file_reference</code> ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">new_reference</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">source_tree</span><span class="p">)</span>
  <span class="n">ref</span> <span class="o">=</span> <span class="k">case</span> <span class="no">File</span><span class="o">.</span><span class="n">extname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span>
        <span class="k">when</span> <span class="s1">&#39;.xcdatamodeld&#39;</span>
          <span class="n">new_xcdatamodeld</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">source_tree</span><span class="p">)</span>
        <span class="k">when</span> <span class="s1">&#39;.xcodeproj&#39;</span>
          <span class="n">new_subproject</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">source_tree</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="n">new_file_reference</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">source_tree</span><span class="p">)</span>
        <span class="k">end</span>

  <span class="n">configure_defaults_for_file_reference</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
  <span class="n">ref</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">new_file_reference</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">source_tree</span><span class="p">)</span>
  <span class="n">path</span> <span class="o">=</span> <span class="no">Pathname</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="n">ref</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">PBXFileReference</span><span class="p">)</span>
  <span class="n">group</span><span class="o">.</span><span class="n">children</span> <span class="o">&lt;&lt;</span> <span class="n">ref</span>
  <span class="no">GroupableHelper</span><span class="o">.</span><span class="n">set_path_with_source_tree</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">source_tree</span><span class="p">)</span>
  <span class="n">ref</span><span class="o">.</span><span class="n">set_last_known_file_type</span>
  <span class="n">ref</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>PBXNativeTarget::add_file_references</strong></p>
<p>åŠ å…¥æ–‡ä»¶èµ„æºåï¼Œä¾¿å¯å°†å…¶åŠ å…¥å¯¹åº”çš„æ„å»ºä»»åŠ¡ä¸­å»ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">add_file_references</span><span class="p">(</span><span class="n">file_references</span><span class="p">,</span> <span class="n">compiler_flags</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="n">file_references</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
    <span class="n">extension</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">extname</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span>
    <span class="n">header_extensions</span> <span class="o">=</span> <span class="no">Constants</span><span class="o">::</span><span class="no">HEADER_FILES_EXTENSIONS</span>
    <span class="c1"># ä¾æ®èµ„æºç±»å‹åŒºåˆ†æ˜¯å¤´æ–‡ä»¶è¿˜æ˜¯æºæ–‡ä»¶ </span>
    <span class="n">is_header_phase</span> <span class="o">=</span> <span class="n">header_extensions</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">is_header_phase</span> <span class="p">?</span> <span class="n">headers_build_phase</span> <span class="p">:</span> <span class="n">source_build_phase</span>

    <span class="c1"># å°†æ–‡ä»¶èµ„æºä½œä¸ºç¼–è¯‘èµ„æºåŠ å…¥åˆ°ç¼–è¯‘æºä¸­</span>
    <span class="k">unless</span> <span class="n">build_file</span> <span class="o">=</span> <span class="n">phase</span><span class="o">.</span><span class="n">build_file</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
      <span class="n">build_file</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">PBXBuildFile</span><span class="p">)</span>
      <span class="n">build_file</span><span class="o">.</span><span class="n">file_ref</span> <span class="o">=</span> <span class="n">file</span>
      <span class="n">phase</span><span class="o">.</span><span class="n">files</span> <span class="o">&lt;&lt;</span> <span class="n">build_file</span>
    <span class="k">end</span>
	 <span class="o">...</span>
    <span class="k">yield</span> <span class="n">build_file</span> <span class="k">if</span> <span class="nb">block_given?</span>

    <span class="n">build_file</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="0x02-æ·»åŠ ç¼–è¯‘ä¾èµ–">0x02 æ·»åŠ ç¼–è¯‘ä¾èµ–</h3>
<p>è¿™é‡Œçš„ç¼–è¯‘ä¾èµ–æ˜¯æŒ‡ï¼Œä¾èµ–çš„ frameworkã€libraryã€bundleã€‚ä¸åŒäºæ–‡ä»¶ï¼Œä»–æœ‰å‡æœ‰å¯¹åº”çš„è™šæ‹Ÿ groupã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># æ·»åŠ  framework å¼•ç”¨</span>
<span class="n">file_ref</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">frameworks_group</span><span class="o">.</span><span class="n">new_file</span><span class="p">(</span><span class="s1">&#39;path/to/A.framework&#39;</span><span class="p">)</span>
<span class="n">target</span><span class="o">.</span><span class="n">frameworks_build_phases</span><span class="o">.</span><span class="n">add_file_reference</span><span class="p">(</span><span class="n">file_ref</span><span class="p">)</span>

<span class="c1"># æ·»åŠ  libA.a å¼•ç”¨</span>
<span class="n">file_ref</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">frameworks_group</span><span class="o">.</span><span class="n">new_file</span><span class="p">(</span><span class="s1">&#39;path/to/libA.a&#39;</span><span class="p">)</span>
<span class="n">target</span><span class="o">.</span><span class="n">frameworks_build_phases</span><span class="o">.</span><span class="n">add_file_reference</span><span class="p">(</span><span class="n">file_ref</span><span class="p">)</span>

<span class="c1"># æ·»åŠ  bundle å¼•ç”¨</span>
<span class="n">file_ref</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">frameworks_group</span><span class="o">.</span><span class="n">new_file</span><span class="p">(</span><span class="s1">&#39;path/to/xxx.bundle&#39;</span><span class="p">)</span>
<span class="n">target</span><span class="o">.</span><span class="n">resources_build_phase</span><span class="o">.</span><span class="n">add_file_reference</span><span class="p">(</span><span class="n">file_ref</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>å¤§å®¶æœ‰å…´è¶£å¯ä»¥çœ‹çœ‹ CocoaPods æ˜¯å¦‚ä½•é…ç½® <code>Pods.project</code>ï¼Œä¸º Pod  ç”Ÿæˆå¯¹åº” targetï¼Œå…¥å£åœ¨ <code>Installer::generate_pods_project</code> å¤„ã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p><strong>Xcode é€šè¿‡ project.pbxprojï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸ŠåˆæŠ½è±¡å‡ºåŸºäº <code>PBXFileReference</code> å’Œ <code>PBXGroup</code> çš„ä»»åŠ¡æ„å»ºç³»ç»Ÿ</strong>ã€‚å¯¹äºè¿™ä¸€æ“ä½œä¸€ç›´æ˜¯ä¸èƒ½ç†è§£çš„ã€‚ä¸ºä»€ä¹ˆä¸åƒå…¶ä»– IDE ä¸€æ ·ç›´æ¥ä½¿ç”¨é¡¹ç›®çš„æ–‡ä»¶ç›®å½•ï¼Œè€Œæ˜¯å¦èµ·ç‚‰ç¶æäº†ä¸€å¥—ä¼¼ä¹å¹¶ä¸å¥½ç”¨æ„å»ºä»¶ç³»ç»Ÿå‘¢ ï¼Ÿ</p>
<p>åœ¨äº†è§£å®Œ <code>project.pbxproj</code> å’Œ Xcodeproj åï¼Œä¼¼ä¹èƒ½ç†è§£ä¸€äº›è®¾è®¡è€…çš„æ„å›¾ã€‚</p>
<p>å‡è®¾ä½ å‚ä¸çš„æ˜¯ä¸€ä¸ªå¤šäººåˆä½œçš„è¶…å¤§å‹é¡¹ç›® (Project)ï¼Œå®ƒå°†åŒæ—¶å­˜åœ¨å¤šä¸ªå­ä»»åŠ¡ (Target)ï¼ŒåŒæ—¶è¿™äº›ä»»åŠ¡ä¹‹é—´å¯èƒ½å­˜åœ¨å¤§é‡äº¤å‰çš„èµ„æºä¾èµ–ã€‚è¿™äº›èµ„æºä¸é™äº  Fileã€Frameworkã€Targetã€Projectã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥åŸºäºæ–‡ä»¶è·¯å¾„æ¥è®°å½•è¿™äº›èµ„æºåŠå…¶ä¾èµ–å…³ç³»ï¼Œé‚£ä¹ˆå½“èµ„æºå‘ç”Ÿäº§ç”Ÿå˜åŒ–æ—¶ï¼Œå°†ä¼šäº§ç”Ÿå¤§é‡çš„ä¿®æ”¹ï¼Œä¾‹å¦‚æ–‡ä»¶è·¯å¾„å˜æ›´ã€‚</p>
<p>è¿™å…¶å®æ˜¯ä¸èƒ½æ¥å—çš„ã€‚è€Œæœ‰äº† <code>PBXFileReference</code> çš„å­˜åœ¨ï¼Œä»»åŠ¡æ„å»ºè€…åªéœ€å…³å¿ƒ <code>PBXFileReference</code> è¿™å”¯ä¸€å¼•ç”¨ï¼Œæ— éœ€åœ¨æ„å®ƒèƒŒåçš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œç”šè‡³æ˜¯å†…å®¹æ˜¯å¦å˜æ›´ï¼Œè¿™äº›éƒ½ä¸é‡è¦ã€‚<strong>é€šè¿‡ <code>PBXFileReference</code> è¿™å±‚éš”ç¦»ï¼Œå®ç°äº†ä»»åŠ¡çš„æ„å»ºè¡Œä¸ºåŠèµ„æºå…³ç³»çš„å›ºåŒ–ã€‚</strong></p>
<h1 id="çŸ¥è¯†ç‚¹é—®é¢˜æ¢³ç†">çŸ¥è¯†ç‚¹é—®é¢˜æ¢³ç†</h1>
<p>è¿™é‡Œç½—åˆ—äº†äº”ä¸ªé—®é¢˜ç”¨æ¥è€ƒå¯Ÿä½ æ˜¯å¦å·²ç»æŒæ¡äº†è¿™ç¯‡æ–‡ç« ï¼Œå¦‚æœæ²¡æœ‰å»ºè®®ä½ åŠ å…¥<strong>æ”¶è—</strong>å†æ¬¡é˜…è¯»ï¼š</p>
<ol>
<li>è¯´è¯´ <code>xcworkspace</code> å’Œ <code>xcodeproj</code> æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆåŒºåˆ« ï¼Ÿ</li>
<li><code>pbxproj</code> ä¸­ <code>isa</code> å…³é”®å­—çš„ä½œç”¨ï¼Œæœ‰å“ªäº›ç±»å‹ ï¼Ÿ</li>
<li>è¯´è¯´ <code>pbxproj</code> ä¸­æ˜¯å¦‚ä½•å®šä¹‰å’Œå¼•ç”¨æºæ–‡ä»¶çš„ ï¼Ÿ</li>
<li><code>pbxproj</code> å¦‚ä½•æ˜ å°„ä¸º Xcodeproj ä¸­çš„å¯¹è±¡çš„ ï¼Ÿ</li>
<li>è°ˆè°ˆä½ å¯¹ <code>PBXGroup</code> å’Œ <code>PBXFileReference</code> çš„ç†è§£ ï¼Ÿ</li>
</ol>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">åœŸåœŸEdmondæœ¨</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2021-05-16
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/cocoapods/">CocoaPods</a>
          <a href="/tags/ios/">iOS</a>
          <a href="/tags/ruby/">Ruby</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/wwdc/wwdc21/wwdc21-session-10019/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">WWDC21 - Discover concurrency in SwiftUI</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/post/sourcecode-cocoapods/07-cocoapods-molinillo/">
            <span class="next-text nav-default">7. Molinillo ä¾èµ–æ ¡éªŒ</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="looseyi/looseyi.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:chun574271939@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/looseyi" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/looseyi" class="iconfont icon-github" title="github"></a>
      <a href="https://www.weibo.com/foreverclp" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.zhihu.com/people/tu-tu-edmondmu" class="iconfont icon-zhihu" title="zhihu"></a>
  <a href="http://looseyi.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019-12-11 - 
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">åœŸåœŸEdmondæœ¨</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-62789092-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
